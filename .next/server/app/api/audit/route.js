(()=>{var e={};e.id=419,e.ids=[419,792],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},19771:e=>{"use strict";e.exports=require("process")},11997:e=>{"use strict";e.exports=require("punycode")},11723:e=>{"use strict";e.exports=require("querystring")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},83997:e=>{"use strict";e.exports=require("tty")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},4573:e=>{"use strict";e.exports=require("node:buffer")},73024:e=>{"use strict";e.exports=require("node:fs")},37067:e=>{"use strict";e.exports=require("node:http")},44708:e=>{"use strict";e.exports=require("node:https")},77030:e=>{"use strict";e.exports=require("node:net")},76760:e=>{"use strict";e.exports=require("node:path")},1708:e=>{"use strict";e.exports=require("node:process")},57075:e=>{"use strict";e.exports=require("node:stream")},37830:e=>{"use strict";e.exports=require("node:stream/web")},73136:e=>{"use strict";e.exports=require("node:url")},57975:e=>{"use strict";e.exports=require("node:util")},38522:e=>{"use strict";e.exports=require("node:zlib")},39727:()=>{},47990:()=>{},33489:(e,t,n)=>{"use strict";let r,i,o,s,a;n.r(t),n.d(t,{patchFetch:()=>id,routeModule:()=>ia,serverHooks:()=>ic,workAsyncStorage:()=>il,workUnitAsyncStorage:()=>iu});var l,u,c,d,p,h,f,g,m,y,v,E,_,A,T,S,b,C,O,I,w,R,N,k,P,x,U,D,M,j,L,G,F,q,H,B,V,$,J,K,z,W,Y,X,Q,Z,ee,et,en,er,ei,eo,es,ea,el,eu,ec,ed,ep={};n.r(ep),n.d(ep,{POST:()=>is});var eh=n(42706),ef=n(28203),eg=n(45994),em=n(39187),ey=n(30379);let ev=ey.z.object({brandName:ey.z.string().min(1,"Brand name is required"),industry:ey.z.string().min(1,"Industry is required"),websiteUrl:ey.z.string().min(1,"Website URL is required"),keywords:ey.z.string(),location:ey.z.string(),serviceCategories:ey.z.string()});var eE=n(70671),e_=n(29021);let eA=require("fs/promises");var eT=n(57075);let eS=require("node:stream/promises");var eb=n(62097),eC=n(33873);class eO{}function eI(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function ew(e,t,n){for(let r=0;r<t.length-1;r++){let i=t[r];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e)){if(Array.isArray(n))e[o]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`)}if(Array.isArray(e[o])){let i=e[o];if(Array.isArray(n))for(let e=0;e<i.length;e++)ew(i[e],t.slice(r+1),n[e]);else for(let e of i)ew(e,t.slice(r+1),n)}return}if(i.endsWith("[0]")){let o=i.slice(0,-3);o in e||(e[o]=[{}]),ew(e[o][0],t.slice(r+1),n);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let r=t[t.length-1],i=e[r];if(void 0!==i){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===i)return;if("object"==typeof i&&"object"==typeof n&&null!==i&&null!==n)Object.assign(i,n);else throw Error(`Cannot set value for an existing key. Key: ${r}`)}else"_self"!==r||"object"!=typeof n||null===n||Array.isArray(n)?e[r]=n:Object.assign(e,n)}function eR(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let r=0;r<t.length;r++){if("object"!=typeof e||null===e)return n;let i=t[r];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e))return n;{let i=e[o];if(!Array.isArray(i))return n;return i.map(e=>eR(e,t.slice(r+1),n))}}e=e[i]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function eN(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}function ek(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["name"],n);let r=eR(e,["metadata"]);null!=r&&ew(t,["metadata"],r);let i=eR(e,["done"]);null!=i&&ew(t,["done"],i);let o=eR(e,["error"]);null!=o&&ew(t,["error"],o);let s=eR(e,["response"]);return null!=s&&ew(t,["response"],function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["parent"]);null!=r&&ew(t,["parent"],r);let i=eR(e,["documentName"]);return null!=i&&ew(t,["documentName"],i),t}(s)),t}(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(l||(l={})),function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"}(u||(u={})),function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"}(c||(c={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"}(d||(d={})),function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"}(p||(p={})),function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"}(h||(h={})),function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"}(f||(f={})),function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"}(g||(g={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"}(m||(m={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(y||(y={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"}(v||(v={})),function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"}(E||(E={})),function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"}(_||(_={})),function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"}(A||(A={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"}(T||(T={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"}(S||(S={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(b||(b={})),function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"}(C||(C={})),function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"}(O||(O={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"}(I||(I={})),function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"}(w||(w={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"}(R||(R={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"}(N||(N={})),function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"}(k||(k={})),function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"}(P||(P={})),function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"}(x||(x={})),function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"}(U||(U={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"}(D||(D={})),(M||(M={})).COLLECTION="COLLECTION",function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"}(j||(j={})),function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"}(L||(L={})),function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(G||(G={})),function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"}(F||(F={})),function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"}(q||(q={})),function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"}(H||(H={})),function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"}(B||(B={})),function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"}(V||(V={})),function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"}($||($={})),function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"}(J||(J={})),function(e){e.ASSET="ASSET",e.STYLE="STYLE"}(K||(K={})),function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"}(z||(z={})),function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"}(W||(W={})),function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING",e.DISTILLATION="DISTILLATION"}(Y||(Y={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"}(X||(X={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"}(Q||(Q={})),function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED",e.REGISTERED="REGISTERED"}(Z||(Z={})),function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"}(ee||(ee={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"}(et||(et={})),function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"}(en||(en={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.ACTIVITY_START="ACTIVITY_START",e.ACTIVITY_END="ACTIVITY_END"}(er||(er={})),function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"}(ei||(ei={})),function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"}(eo||(eo={})),function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"}(es||(es={})),function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"}(ea||(ea={})),function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"}(el||(el={})),function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"}(eu||(eu={})),function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"}(ec||(ec={}));class eP{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class ex{get text(){var e,t,n,r,i,o,s,a;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1,c=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&"thoughtSignature"!==t&&(null!==n||void 0!==n)&&c.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,l+=e.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var e,t,n,r,i,o,s,a;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",u=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,n,r,i,o,s,a;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,n,r,i,o,s,a,l;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.code}get codeExecutionResult(){var e,t,n,r,i,o,s,a,l;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.output}}class eU{}class eD{}class eM{}class ej{}class eL{}class eG{}class eF{}class eq{}class eH{}class eB{}class eV{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new eV;return Object.assign(n,t?function(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["name"],n);let r=eR(e,["metadata"]);null!=r&&ew(t,["metadata"],r);let i=eR(e,["done"]);null!=i&&ew(t,["done"],i);let o=eR(e,["error"]);null!=o&&ew(t,["error"],o);let s=eR(e,["response"]);return null!=s&&ew(t,["response"],function(e){let t={},n=eR(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["_self"]);return null!=n&&ew(t,["video"],function(e){let t={},n=eR(e,["gcsUri"]);null!=n&&ew(t,["uri"],n);let r=eR(e,["bytesBase64Encoded"]);null!=r&&ew(t,["videoBytes"],eN(r));let i=eR(e,["mimeType"]);return null!=i&&ew(t,["mimeType"],i),t}(n)),t})(e))),ew(t,["generatedVideos"],e)}let r=eR(e,["raiMediaFilteredCount"]);null!=r&&ew(t,["raiMediaFilteredCount"],r);let i=eR(e,["raiMediaFilteredReasons"]);return null!=i&&ew(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e):function(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["name"],n);let r=eR(e,["metadata"]);null!=r&&ew(t,["metadata"],r);let i=eR(e,["done"]);null!=i&&ew(t,["done"],i);let o=eR(e,["error"]);null!=o&&ew(t,["error"],o);let s=eR(e,["response","generateVideoResponse"]);return null!=s&&ew(t,["response"],function(e){let t={},n=eR(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["video"]);return null!=n&&ew(t,["video"],function(e){let t={},n=eR(e,["uri"]);null!=n&&ew(t,["uri"],n);let r=eR(e,["encodedVideo"]);null!=r&&ew(t,["videoBytes"],eN(r));let i=eR(e,["encoding"]);return null!=i&&ew(t,["mimeType"],i),t}(n)),t})(e))),ew(t,["generatedVideos"],e)}let r=eR(e,["raiMediaFilteredCount"]);null!=r&&ew(t,["raiMediaFilteredCount"],r);let i=eR(e,["raiMediaFilteredReasons"]);return null!=i&&ew(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e)),n}}class e${}class eJ{}class eK{}class ez{}class eW{}class eY{}class eX{}class eQ{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new eQ;return Object.assign(n,function(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["name"],n);let r=eR(e,["metadata"]);null!=r&&ew(t,["metadata"],r);let i=eR(e,["done"]);null!=i&&ew(t,["done"],i);let o=eR(e,["error"]);null!=o&&ew(t,["error"],o);let s=eR(e,["response"]);return null!=s&&ew(t,["response"],function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["parent"]);null!=r&&ew(t,["parent"],r);let i=eR(e,["documentName"]);return null!=i&&ew(t,["documentName"],i),t}(s)),t}(e)),n}}class eZ{}class e0{}class e1{}class e2{}class e4{}class e3{get text(){var e,t,n;let r="",i=!1,o=[];for(let s of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(let[e,t]of Object.entries(s))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof s.text){if("boolean"==typeof s.thought&&s.thought)continue;i=!0,r+=s.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?r:void 0}get data(){var e,t,n;let r="",i=[];for(let o of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(let[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&i.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(r+=atob(o.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class e6{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class e9{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new e9;return Object.assign(n,ek(e)),n}}function e5(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;{let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function e8(e,t){let n=e5(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function e7(e){return Array.isArray(e)?e.map(e=>te(e)):[te(e)]}function te(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function tt(e){let t=te(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tn(e){let t=te(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tr(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function ti(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>tr(e)):[tr(e)]}function to(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function ts(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function ta(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function tl(e){if(null==e)throw Error("ContentUnion is required");return to(e)?e:{role:"user",parts:ti(e)}}function tu(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=tl(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=tl(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>tl(e)):[tl(t)]}function tc(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(ts(e)||ta(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[tl(e)]}let t=[],n=[],r=to(e[0]);for(let i of e){let e=to(i);if(e!=r)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(i);else if(ts(i)||ta(i))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(i)}return r||t.push({role:"user",parts:ti(n)}),t}function td(e){let t={},n=["items"],r=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let o=e.anyOf;for(let[s,a]of(null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(d).includes(n[0].toUpperCase())?n[0].toUpperCase():d.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(d).includes(e.toUpperCase())?e.toUpperCase():d.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a){if("type"==s){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(d).includes(a.toUpperCase())?a.toUpperCase():d.TYPE_UNSPECIFIED}else if(n.includes(s))t[s]=td(a);else if(r.includes(s)){let e=[];for(let n of a){if("null"==n.type){t.nullable=!0;continue}e.push(td(n))}t[s]=e}else if(i.includes(s)){let e={};for(let[t,n]of Object.entries(a))e[t]=td(n);t[s]=e}else{if("additionalProperties"===s)continue;t[s]=a}}return t}function tp(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function th(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function tf(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=td(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=td(t.response));return e}function tg(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function tm(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,r=1){let i=!t.startsWith(`${n}/`)&&t.split("/").length===r;if(e.isVertexAI())return t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:i?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t;return i?`${n}/${t}`:t}(e,t,"cachedContents")}function ty(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function tv(e){return null!=e&&"object"==typeof e&&"video"in e}function tE(e){return null!=e&&"object"==typeof e&&"uri"in e}function t_(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),!(tE(e)&&void 0===(n=e.uri)||tv(e)&&void 0===(n=null===(t=e.video)||void 0===t?void 0:t.uri))){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function tA(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function tT(e){for(let t of["models","tunedModels","publisherModels"]){if(null!==e&&"object"==typeof e&&t in e)return e[t]}return[]}function tS(e,t){let n;if("string"==typeof t){if(e.isVertexAI()){if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`)}else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`)}else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||1!==r)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||1!==i)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function tb(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let r=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function tC(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function tO(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function tI(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["name"],n);let r=eR(e,["metadata","displayName"]);null!=r&&ew(t,["displayName"],r);let i=eR(e,["metadata","state"]);null!=i&&ew(t,["state"],tO(i));let o=eR(e,["metadata","createTime"]);null!=o&&ew(t,["createTime"],o);let s=eR(e,["metadata","endTime"]);null!=s&&ew(t,["endTime"],s);let a=eR(e,["metadata","updateTime"]);null!=a&&ew(t,["updateTime"],a);let l=eR(e,["metadata","model"]);null!=l&&ew(t,["model"],l);let u=eR(e,["metadata","output"]);return null!=u&&ew(t,["dest"],function(e){let t={},n=eR(e,["responsesFile"]);null!=n&&ew(t,["fileName"],n);let r=eR(e,["inlinedResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["response"]);null!=n&&ew(t,["response"],function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["content"]);null!=n&&ew(t,["content"],n);let r=eR(e,["citationMetadata"]);null!=r&&ew(t,["citationMetadata"],function(e){let t={},n=eR(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["citations"],e)}return t}(r));let i=eR(e,["tokenCount"]);null!=i&&ew(t,["tokenCount"],i);let o=eR(e,["finishReason"]);null!=o&&ew(t,["finishReason"],o);let s=eR(e,["avgLogprobs"]);null!=s&&ew(t,["avgLogprobs"],s);let a=eR(e,["groundingMetadata"]);null!=a&&ew(t,["groundingMetadata"],a);let l=eR(e,["index"]);null!=l&&ew(t,["index"],l);let u=eR(e,["logprobsResult"]);null!=u&&ew(t,["logprobsResult"],u);let c=eR(e,["safetyRatings"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["safetyRatings"],e)}let d=eR(e,["urlContextMetadata"]);return null!=d&&ew(t,["urlContextMetadata"],d),t})(e))),ew(t,["candidates"],e)}let i=eR(e,["modelVersion"]);null!=i&&ew(t,["modelVersion"],i);let o=eR(e,["promptFeedback"]);null!=o&&ew(t,["promptFeedback"],o);let s=eR(e,["responseId"]);null!=s&&ew(t,["responseId"],s);let a=eR(e,["usageMetadata"]);return null!=a&&ew(t,["usageMetadata"],a),t}(n));let r=eR(e,["metadata"]);null!=r&&ew(t,["metadata"],r);let i=eR(e,["error"]);return null!=i&&ew(t,["error"],i),t})(e))),ew(t,["inlinedResponses"],e)}let i=eR(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["inlinedEmbedContentResponses"],e)}return t}(tb(u))),t}function tw(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["name"],n);let r=eR(e,["displayName"]);null!=r&&ew(t,["displayName"],r);let i=eR(e,["state"]);null!=i&&ew(t,["state"],tO(i));let o=eR(e,["error"]);null!=o&&ew(t,["error"],o);let s=eR(e,["createTime"]);null!=s&&ew(t,["createTime"],s);let a=eR(e,["startTime"]);null!=a&&ew(t,["startTime"],a);let l=eR(e,["endTime"]);null!=l&&ew(t,["endTime"],l);let u=eR(e,["updateTime"]);null!=u&&ew(t,["updateTime"],u);let c=eR(e,["model"]);null!=c&&ew(t,["model"],c);let d=eR(e,["inputConfig"]);null!=d&&ew(t,["src"],function(e){let t={},n=eR(e,["instancesFormat"]);null!=n&&ew(t,["format"],n);let r=eR(e,["gcsSource","uris"]);null!=r&&ew(t,["gcsUri"],r);let i=eR(e,["bigquerySource","inputUri"]);return null!=i&&ew(t,["bigqueryUri"],i),t}(d));let p=eR(e,["outputConfig"]);null!=p&&ew(t,["dest"],function(e){let t={},n=eR(e,["predictionsFormat"]);null!=n&&ew(t,["format"],n);let r=eR(e,["gcsDestination","outputUriPrefix"]);null!=r&&ew(t,["gcsUri"],r);let i=eR(e,["bigqueryDestination","outputUri"]);return null!=i&&ew(t,["bigqueryUri"],i),t}(tb(p)));let h=eR(e,["completionStats"]);return null!=h&&ew(t,["completionStats"],h),t}function tR(e){let t={},n=eR(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["mediaResolution"]);null!=n&&ew(t,["mediaResolution"],n);let r=eR(e,["codeExecutionResult"]);null!=r&&ew(t,["codeExecutionResult"],r);let i=eR(e,["executableCode"]);null!=i&&ew(t,["executableCode"],i);let o=eR(e,["fileData"]);null!=o&&ew(t,["fileData"],function(e){let t={};if(void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eR(e,["fileUri"]);null!=n&&ew(t,["fileUri"],n);let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}(o));let s=eR(e,["functionCall"]);null!=s&&ew(t,["functionCall"],function(e){let t={},n=eR(e,["id"]);null!=n&&ew(t,["id"],n);let r=eR(e,["args"]);null!=r&&ew(t,["args"],r);let i=eR(e,["name"]);if(null!=i&&ew(t,["name"],i),void 0!==eR(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==eR(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=eR(e,["functionResponse"]);null!=a&&ew(t,["functionResponse"],a);let l=eR(e,["inlineData"]);null!=l&&ew(t,["inlineData"],function(e){let t={},n=eR(e,["data"]);if(null!=n&&ew(t,["data"],n),void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}(l));let u=eR(e,["text"]);null!=u&&ew(t,["text"],u);let c=eR(e,["thought"]);null!=c&&ew(t,["thought"],c);let d=eR(e,["thoughtSignature"]);null!=d&&ew(t,["thoughtSignature"],d);let p=eR(e,["videoMetadata"]);return null!=p&&ew(t,["videoMetadata"],p),t})(e))),ew(t,["parts"],e)}let r=eR(e,["role"]);return null!=r&&ew(t,["role"],r),t}function tN(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["_url","model"],e5(e,r));let i=eR(t,["src"]);null!=i&&ew(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==eR(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==eR(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==eR(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let r=eR(t,["fileName"]);null!=r&&ew(n,["fileName"],r);let i=eR(t,["inlinedRequests"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["request","model"],e5(e,r));let i=eR(t,["contents"]);if(null!=i){let e=tc(i);Array.isArray(e)&&(e=e.map(e=>tR(e))),ew(n,["request","contents"],e)}let o=eR(t,["metadata"]);null!=o&&ew(n,["metadata"],o);let s=eR(t,["config"]);return null!=s&&ew(n,["request","generationConfig"],function(e,t,n){let r={},i=eR(t,["systemInstruction"]);void 0!==n&&null!=i&&ew(n,["systemInstruction"],tR(tl(i)));let o=eR(t,["temperature"]);null!=o&&ew(r,["temperature"],o);let s=eR(t,["topP"]);null!=s&&ew(r,["topP"],s);let a=eR(t,["topK"]);null!=a&&ew(r,["topK"],a);let l=eR(t,["candidateCount"]);null!=l&&ew(r,["candidateCount"],l);let u=eR(t,["maxOutputTokens"]);null!=u&&ew(r,["maxOutputTokens"],u);let c=eR(t,["stopSequences"]);null!=c&&ew(r,["stopSequences"],c);let d=eR(t,["responseLogprobs"]);null!=d&&ew(r,["responseLogprobs"],d);let p=eR(t,["logprobs"]);null!=p&&ew(r,["logprobs"],p);let h=eR(t,["presencePenalty"]);null!=h&&ew(r,["presencePenalty"],h);let f=eR(t,["frequencyPenalty"]);null!=f&&ew(r,["frequencyPenalty"],f);let g=eR(t,["seed"]);null!=g&&ew(r,["seed"],g);let m=eR(t,["responseMimeType"]);null!=m&&ew(r,["responseMimeType"],m);let y=eR(t,["responseSchema"]);null!=y&&ew(r,["responseSchema"],td(y));let v=eR(t,["responseJsonSchema"]);if(null!=v&&ew(r,["responseJsonSchema"],v),void 0!==eR(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==eR(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let E=eR(t,["safetySettings"]);if(void 0!==n&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["category"]);if(null!=n&&ew(t,["category"],n),void 0!==eR(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=eR(e,["threshold"]);return null!=r&&ew(t,["threshold"],r),t})(e))),ew(n,["safetySettings"],e)}let _=eR(t,["tools"]);if(void 0!==n&&null!=_){let e=tg(_);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==eR(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=eR(e,["computerUse"]);null!=n&&ew(t,["computerUse"],n);let r=eR(e,["fileSearch"]);null!=r&&ew(t,["fileSearch"],r);let i=eR(e,["codeExecution"]);if(null!=i&&ew(t,["codeExecution"],i),void 0!==eR(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=eR(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["functionDeclarations"],e)}let s=eR(e,["googleMaps"]);null!=s&&ew(t,["googleMaps"],function(e){let t={};if(void 0!==eR(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eR(e,["enableWidget"]);return null!=n&&ew(t,["enableWidget"],n),t}(s));let a=eR(e,["googleSearch"]);null!=a&&ew(t,["googleSearch"],function(e){let t={};if(void 0!==eR(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eR(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eR(e,["timeRangeFilter"]);return null!=n&&ew(t,["timeRangeFilter"],n),t}(a));let l=eR(e,["googleSearchRetrieval"]);null!=l&&ew(t,["googleSearchRetrieval"],l);let u=eR(e,["urlContext"]);return null!=u&&ew(t,["urlContext"],u),t})(tf(e)))),ew(n,["tools"],e)}let A=eR(t,["toolConfig"]);if(void 0!==n&&null!=A&&ew(n,["toolConfig"],function(e){let t={},n=eR(e,["retrievalConfig"]);null!=n&&ew(t,["retrievalConfig"],n);let r=eR(e,["functionCallingConfig"]);return null!=r&&ew(t,["functionCallingConfig"],function(e){let t={},n=eR(e,["allowedFunctionNames"]);null!=n&&ew(t,["allowedFunctionNames"],n);let r=eR(e,["mode"]);if(null!=r&&ew(t,["mode"],r),void 0!==eR(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(r)),t}(A)),void 0!==eR(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=eR(t,["cachedContent"]);void 0!==n&&null!=T&&ew(n,["cachedContent"],tm(e,T));let S=eR(t,["responseModalities"]);null!=S&&ew(r,["responseModalities"],S);let b=eR(t,["mediaResolution"]);null!=b&&ew(r,["mediaResolution"],b);let C=eR(t,["speechConfig"]);if(null!=C&&ew(r,["speechConfig"],tp(C)),void 0!==eR(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let O=eR(t,["thinkingConfig"]);null!=O&&ew(r,["thinkingConfig"],O);let I=eR(t,["imageConfig"]);null!=I&&ew(r,["imageConfig"],function(e){let t={},n=eR(e,["aspectRatio"]);null!=n&&ew(t,["aspectRatio"],n);let r=eR(e,["imageSize"]);if(null!=r&&ew(t,["imageSize"],r),void 0!==eR(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==eR(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==eR(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(I));let w=eR(t,["enableEnhancedCivicAnswers"]);if(null!=w&&ew(r,["enableEnhancedCivicAnswers"],w),void 0!==eR(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return r}(e,s,eR(n,["request"],{}))),n})(e,t))),ew(n,["requests","requests"],t)}return n}(e,tS(e,i)));let o=eR(t,["config"]);return null!=o&&function(e,t){let n=eR(e,["displayName"]);if(void 0!==t&&null!=n&&ew(t,["batch","displayName"],n),void 0!==eR(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(o,n),n}!function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"}(ed||(ed={}));class tk{constructor(e,t,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,r)}init(e,t,n){var r,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};(o=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!==(i=null===(r=o.config)||void 0===r?void 0:r.pageSize)&&void 0!==i?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return{value:void 0,done:!0};await this.nextPage()}let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null===(e=this.params.config)||void 0===e?void 0:e.pageToken)!==void 0}}class tP extends eO{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tk(ed.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(e){let t=tN(this.apiClient,e),n=eI("{model}:batchGenerateContent",t._url),r=t.batch.inputConfig.requests,i=r.requests,o=[];for(let e of i){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}o.push(t)}return r.requests=o,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},r=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${r}`),void 0===n.dest){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${r}`;else if(i)n.dest=`${i}_dest_${r}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["model"],e5(e,r));let i=eR(t,["src"]);null!=i&&ew(n,["inputConfig"],function(e){let t={},n=eR(e,["format"]);null!=n&&ew(t,["instancesFormat"],n);let r=eR(e,["gcsUri"]);null!=r&&ew(t,["gcsSource","uris"],r);let i=eR(e,["bigqueryUri"]);if(null!=i&&ew(t,["bigquerySource","inputUri"],i),void 0!==eR(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==eR(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(tS(e,i)));let o=eR(t,["config"]);return null!=o&&function(e,t){let n=eR(e,["displayName"]);void 0!==t&&null!=n&&ew(t,["displayName"],n);let r=eR(e,["dest"]);void 0!==t&&null!=r&&ew(t,["outputConfig"],function(e){let t={},n=eR(e,["format"]);null!=n&&ew(t,["predictionsFormat"],n);let r=eR(e,["gcsUri"]);null!=r&&ew(t,["gcsDestination","outputUriPrefix"],r);let i=eR(e,["bigqueryUri"]);if(null!=i&&ew(t,["bigqueryDestination","outputUri"],i),void 0!==eR(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==eR(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==eR(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(r)))}(o,n),n}(this.apiClient,e);return o=eI("batchPredictionJobs",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>tw(e))}{let t=tN(this.apiClient,e);return o=eI("{model}:batchGenerateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tI(e))}}async createEmbeddingsInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["_url","model"],e5(e,r));let i=eR(t,["src"]);null!=i&&ew(n,["batch","inputConfig"],function(e,t){let n={},r=eR(t,["fileName"]);null!=r&&ew(n,["file_name"],r);let i=eR(t,["inlinedRequests"]);return null!=i&&ew(n,["requests"],function(e,t){let n={},r=eR(t,["contents"]);if(null!=r){let t=tu(e,r);Array.isArray(t)&&(t=t.map(e=>e)),ew(n,["requests[]","request","content"],t)}let i=eR(t,["config"]);return null!=i&&(ew(n,["_self"],function(e,t){let n=eR(e,["taskType"]);void 0!==t&&null!=n&&ew(t,["requests[]","taskType"],n);let r=eR(e,["title"]);void 0!==t&&null!=r&&ew(t,["requests[]","title"],r);let i=eR(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&ew(t,["requests[]","outputDimensionality"],i),void 0!==eR(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==eR(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(i,n)),function(e,t){for(let[n,r]of Object.entries(t)){let t=n.split("."),i=r.split("."),o=new Set,s=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){s=e;break}if(-1!==s&&i.length>s)for(let e=s;e<i.length;e++){let t=i[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}(function e(t,n,r,i,o){if(i>=n.length||"object"!=typeof t||null===t)return;let s=n[i];if(s.endsWith("[]")){let a=s.slice(0,-2);if(a in t&&Array.isArray(t[a]))for(let s of t[a])e(s,n,r,i+1,o)}else if("*"===s){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!o.has(e)),n={};for(let r of e)n[r]=t[r];for(let[e,o]of Object.entries(n)){let n=[];for(let t of r.slice(i))"*"===t?n.push(e):n.push(t);ew(t,n,o)}for(let n of e)delete t[n]}}else s in t&&e(t[s],n,r,i+1,o)})(e,t,i,0,o)}}(n,{"requests[].*":"requests[].request.*"})),n}(e,i)),n}(e,i));let o=eR(t,["config"]);return null!=o&&function(e,t){let n=eR(e,["displayName"]);void 0!==t&&null!=n&&ew(t,["batch","displayName"],n)}(o,n),n}(this.apiClient,e);return r=eI("{model}:asyncBatchEmbedContent",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>tI(e))}}async get(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tC(e,r)),n}(this.apiClient,e);return o=eI("batchPredictionJobs/{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>tw(e))}{let t=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tC(e,r)),n}(this.apiClient,e);return o=eI("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tI(e))}}async cancel(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tC(e,r)),n}(this.apiClient,e);o=eI("batchPredictionJobs/{name}:cancel",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}else{let t=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tC(e,r)),n}(this.apiClient,e);o=eI("batches/{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal})}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e){let t={},n=eR(e,["config"]);return null!=n&&function(e,t){let n=eR(e,["pageSize"]);void 0!==t&&null!=n&&ew(t,["_query","pageSize"],n);let r=eR(e,["pageToken"]);void 0!==t&&null!=r&&ew(t,["_query","pageToken"],r);let i=eR(e,["filter"]);void 0!==t&&null!=i&&ew(t,["_query","filter"],i)}(n,t),t}(e);return o=eI("batchPredictionJobs",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["nextPageToken"]);null!=r&&ew(t,["nextPageToken"],r);let i=eR(e,["batchPredictionJobs"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tw(e))),ew(t,["batchJobs"],e)}return t}(e),n=new e4;return Object.assign(n,t),n})}{let t=function(e){let t={},n=eR(e,["config"]);return null!=n&&function(e,t){let n=eR(e,["pageSize"]);void 0!==t&&null!=n&&ew(t,["_query","pageSize"],n);let r=eR(e,["pageToken"]);if(void 0!==t&&null!=r&&ew(t,["_query","pageToken"],r),void 0!==eR(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t}(e);return o=eI("batches",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["nextPageToken"]);null!=r&&ew(t,["nextPageToken"],r);let i=eR(e,["operations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tI(e))),ew(t,["batchJobs"],e)}return t}(e),n=new e4;return Object.assign(n,t),n})}}async delete(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tC(e,r)),n}(this.apiClient,e);return o=eI("batchPredictionJobs/{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["name"]);null!=r&&ew(t,["name"],r);let i=eR(e,["done"]);null!=i&&ew(t,["done"],i);let o=eR(e,["error"]);return null!=o&&ew(t,["error"],o),t})(e))}{let t=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tC(e,r)),n}(this.apiClient,e);return o=eI("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["name"]);null!=r&&ew(t,["name"],r);let i=eR(e,["done"]);null!=i&&ew(t,["done"],i);let o=eR(e,["error"]);return null!=o&&ew(t,["error"],o),t})(e))}}}function tx(e){let t={},n=eR(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["mediaResolution"]);null!=n&&ew(t,["mediaResolution"],n);let r=eR(e,["codeExecutionResult"]);null!=r&&ew(t,["codeExecutionResult"],r);let i=eR(e,["executableCode"]);null!=i&&ew(t,["executableCode"],i);let o=eR(e,["fileData"]);null!=o&&ew(t,["fileData"],function(e){let t={};if(void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eR(e,["fileUri"]);null!=n&&ew(t,["fileUri"],n);let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}(o));let s=eR(e,["functionCall"]);null!=s&&ew(t,["functionCall"],function(e){let t={},n=eR(e,["id"]);null!=n&&ew(t,["id"],n);let r=eR(e,["args"]);null!=r&&ew(t,["args"],r);let i=eR(e,["name"]);if(null!=i&&ew(t,["name"],i),void 0!==eR(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==eR(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=eR(e,["functionResponse"]);null!=a&&ew(t,["functionResponse"],a);let l=eR(e,["inlineData"]);null!=l&&ew(t,["inlineData"],function(e){let t={},n=eR(e,["data"]);if(null!=n&&ew(t,["data"],n),void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}(l));let u=eR(e,["text"]);null!=u&&ew(t,["text"],u);let c=eR(e,["thought"]);null!=c&&ew(t,["thought"],c);let d=eR(e,["thoughtSignature"]);null!=d&&ew(t,["thoughtSignature"],d);let p=eR(e,["videoMetadata"]);return null!=p&&ew(t,["videoMetadata"],p),t})(e))),ew(t,["parts"],e)}let r=eR(e,["role"]);return null!=r&&ew(t,["role"],r),t}class tU extends eO{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tk(ed.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["model"],e8(e,r));let i=eR(t,["config"]);return null!=i&&function(e,t){let n=eR(e,["ttl"]);void 0!==t&&null!=n&&ew(t,["ttl"],n);let r=eR(e,["expireTime"]);void 0!==t&&null!=r&&ew(t,["expireTime"],r);let i=eR(e,["displayName"]);void 0!==t&&null!=i&&ew(t,["displayName"],i);let o=eR(e,["contents"]);if(void 0!==t&&null!=o){let e=tc(o);Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["contents"],e)}let s=eR(e,["systemInstruction"]);void 0!==t&&null!=s&&ew(t,["systemInstruction"],tl(s));let a=eR(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["retrieval"]);null!=n&&ew(t,["retrieval"],n);let r=eR(e,["computerUse"]);if(null!=r&&ew(t,["computerUse"],r),void 0!==eR(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=eR(e,["codeExecution"]);null!=i&&ew(t,["codeExecution"],i);let o=eR(e,["enterpriseWebSearch"]);null!=o&&ew(t,["enterpriseWebSearch"],o);let s=eR(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["description"]);null!=n&&ew(t,["description"],n);let r=eR(e,["name"]);null!=r&&ew(t,["name"],r);let i=eR(e,["parameters"]);null!=i&&ew(t,["parameters"],i);let o=eR(e,["parametersJsonSchema"]);null!=o&&ew(t,["parametersJsonSchema"],o);let s=eR(e,["response"]);null!=s&&ew(t,["response"],s);let a=eR(e,["responseJsonSchema"]);if(null!=a&&ew(t,["responseJsonSchema"],a),void 0!==eR(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),ew(t,["functionDeclarations"],e)}let a=eR(e,["googleMaps"]);null!=a&&ew(t,["googleMaps"],a);let l=eR(e,["googleSearch"]);null!=l&&ew(t,["googleSearch"],l);let u=eR(e,["googleSearchRetrieval"]);null!=u&&ew(t,["googleSearchRetrieval"],u);let c=eR(e,["urlContext"]);return null!=c&&ew(t,["urlContext"],c),t})(e))),ew(t,["tools"],e)}let l=eR(e,["toolConfig"]);void 0!==t&&null!=l&&ew(t,["toolConfig"],l);let u=eR(e,["kmsKeyName"]);void 0!==t&&null!=u&&ew(t,["encryption_spec","kmsKeyName"],u)}(i,n),n}(this.apiClient,e);return o=eI("cachedContents",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["model"],e8(e,r));let i=eR(t,["config"]);return null!=i&&function(e,t){let n=eR(e,["ttl"]);void 0!==t&&null!=n&&ew(t,["ttl"],n);let r=eR(e,["expireTime"]);void 0!==t&&null!=r&&ew(t,["expireTime"],r);let i=eR(e,["displayName"]);void 0!==t&&null!=i&&ew(t,["displayName"],i);let o=eR(e,["contents"]);if(void 0!==t&&null!=o){let e=tc(o);Array.isArray(e)&&(e=e.map(e=>tx(e))),ew(t,["contents"],e)}let s=eR(e,["systemInstruction"]);void 0!==t&&null!=s&&ew(t,["systemInstruction"],tx(tl(s)));let a=eR(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==eR(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=eR(e,["computerUse"]);null!=n&&ew(t,["computerUse"],n);let r=eR(e,["fileSearch"]);null!=r&&ew(t,["fileSearch"],r);let i=eR(e,["codeExecution"]);if(null!=i&&ew(t,["codeExecution"],i),void 0!==eR(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=eR(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["functionDeclarations"],e)}let s=eR(e,["googleMaps"]);null!=s&&ew(t,["googleMaps"],function(e){let t={};if(void 0!==eR(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eR(e,["enableWidget"]);return null!=n&&ew(t,["enableWidget"],n),t}(s));let a=eR(e,["googleSearch"]);null!=a&&ew(t,["googleSearch"],function(e){let t={};if(void 0!==eR(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eR(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eR(e,["timeRangeFilter"]);return null!=n&&ew(t,["timeRangeFilter"],n),t}(a));let l=eR(e,["googleSearchRetrieval"]);null!=l&&ew(t,["googleSearchRetrieval"],l);let u=eR(e,["urlContext"]);return null!=u&&ew(t,["urlContext"],u),t})(e))),ew(t,["tools"],e)}let l=eR(e,["toolConfig"]);if(void 0!==t&&null!=l&&ew(t,["toolConfig"],function(e){let t={},n=eR(e,["retrievalConfig"]);null!=n&&ew(t,["retrievalConfig"],n);let r=eR(e,["functionCallingConfig"]);return null!=r&&ew(t,["functionCallingConfig"],function(e){let t={},n=eR(e,["allowedFunctionNames"]);null!=n&&ew(t,["allowedFunctionNames"],n);let r=eR(e,["mode"]);if(null!=r&&ew(t,["mode"],r),void 0!==eR(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(r)),t}(l)),void 0!==eR(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(i,n),n}(this.apiClient,e);return o=eI("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tm(e,r)),n}(this.apiClient,e);return o=eI("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tm(e,r)),n}(this.apiClient,e);return o=eI("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tm(e,r)),n}(this.apiClient,e);return o=eI("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);return null!=n&&ew(t,["sdkHttpResponse"],n),t}(e),n=new eK;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eR(t,["name"]);return null!=r&&ew(n,["_url","name"],tm(e,r)),n}(this.apiClient,e);return o=eI("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);return null!=n&&ew(t,["sdkHttpResponse"],n),t}(e),n=new eK;return Object.assign(n,t),n})}}async update(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(t,["name"]);null!=r&&ew(n,["_url","name"],tm(e,r));let i=eR(t,["config"]);return null!=i&&function(e,t){let n=eR(e,["ttl"]);void 0!==t&&null!=n&&ew(t,["ttl"],n);let r=eR(e,["expireTime"]);void 0!==t&&null!=r&&ew(t,["expireTime"],r)}(i,n),n}(this.apiClient,e);return o=eI("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let n={},r=eR(t,["name"]);null!=r&&ew(n,["_url","name"],tm(e,r));let i=eR(t,["config"]);return null!=i&&function(e,t){let n=eR(e,["ttl"]);void 0!==t&&null!=n&&ew(t,["ttl"],n);let r=eR(e,["expireTime"]);void 0!==t&&null!=r&&ew(t,["expireTime"],r)}(i,n),n}(this.apiClient,e);return o=eI("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e){let t={},n=eR(e,["config"]);return null!=n&&function(e,t){let n=eR(e,["pageSize"]);void 0!==t&&null!=n&&ew(t,["_query","pageSize"],n);let r=eR(e,["pageToken"]);void 0!==t&&null!=r&&ew(t,["_query","pageToken"],r)}(n,t),t}(e);return o=eI("cachedContents",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["nextPageToken"]);null!=r&&ew(t,["nextPageToken"],r);let i=eR(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["cachedContents"],e)}return t}(e),n=new ez;return Object.assign(n,t),n})}{let t=function(e){let t={},n=eR(e,["config"]);return null!=n&&function(e,t){let n=eR(e,["pageSize"]);void 0!==t&&null!=n&&ew(t,["_query","pageSize"],n);let r=eR(e,["pageToken"]);void 0!==t&&null!=r&&ew(t,["_query","pageToken"],r)}(n,t),t}(e);return o=eI("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["nextPageToken"]);null!=r&&ew(t,["nextPageToken"],r);let i=eR(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["cachedContents"],e)}return t}(e),n=new ez;return Object.assign(n,t),n})}}}function tD(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function tM(e){return this instanceof tM?(this.v=e,this):new tM(e)}function tj(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{var n;(n=i[e](t)).value instanceof tM?Promise.resolve(n.value.v).then(l,u):c(o[0][2],n)}catch(e){c(o[0][3],e)}}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function tL(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}function tG(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function tF(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,r=0;for(;r<n;)if("user"===e[r].role)t.push(e[r]),r++;else{let i=[],o=!0;for(;r<n&&"model"===e[r].role;)i.push(e[r]),o&&!tG(e[r])&&(o=!1),r++;o?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class tq{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new tH(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class tH{constructor(e,t,n,r={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let n=tl(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let o=await r,s=null===(t=null===(e=o.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content,a=o.automaticFunctionCallingHistory,l=this.getHistory(!0).length,u=[];null!=a&&(u=null!==(i=a.slice(l))&&void 0!==i?i:[]),this.recordHistory(n,s?[s]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;let n=tl(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});this.sendPromise=r.then(()=>void 0).catch(()=>void 0);let i=await r;return this.processStreamResponse(i,n)}getHistory(e=!1){return structuredClone(e?tF(this.history):this.history)}processStreamResponse(e,t){return tj(this,arguments,function*(){let n=[];try{for(var r,i,o,s,a,l,u,c=!0,d=tL(e);!(r=(u=yield tM(d.next())).done);c=!0){if(s=u.value,c=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;return void 0!==n&&tG(n)}(s)){let e=null===(l=null===(a=s.candidates)||void 0===a?void 0:a[0])||void 0===l?void 0:l.content;void 0!==e&&n.push(e)}yield yield tM(s)}}catch(e){i={error:e}}finally{try{!c&&!r&&(o=d.return)&&(yield tM(o.call(d)))}finally{if(i)throw i.error}}this.recordHistory(t,n)})}recordHistory(e,t,n){let r=[];t.length>0&&t.every(e=>void 0!==e.role)?r=t:r.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...tF(n)):this.history.push(e),this.history.push(...r)}}class tB extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,tB.prototype)}}class tV extends eO{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tk(ed.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async registerFiles(e){throw Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(e){return this.registerFilesInternal(e)}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["config"]);return null!=n&&function(e,t){let n=eR(e,["pageSize"]);void 0!==t&&null!=n&&ew(t,["_query","pageSize"],n);let r=eR(e,["pageToken"]);void 0!==t&&null!=r&&ew(t,["_query","pageToken"],r)}(n,t),t}(e);return r=eI("files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["nextPageToken"]);null!=r&&ew(t,["nextPageToken"],r);let i=eR(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["files"],e)}return t}(e),n=new eZ;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["file"]);return null!=n&&ew(t,["file"],n),t}(e);return r=eI("upload/v1beta/files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);return null!=n&&ew(t,["sdkHttpResponse"],n),t}(e),n=new e0;return Object.assign(n,t),n})}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["name"]);return null!=n&&ew(t,["_url","file"],t_(n)),t}(e);return r=eI("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["name"]);return null!=n&&ew(t,["_url","file"],t_(n)),t}(e);return r=eI("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);return null!=n&&ew(t,["sdkHttpResponse"],n),t}(e),n=new e1;return Object.assign(n,t),n})}}async registerFilesInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["uris"]);return null!=n&&ew(t,["uris"],n),t}(e);return r=eI("files:register",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["files"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["files"],e)}return t}(e),n=new e2;return Object.assign(n,t),n})}}}function t$(e){let t={},n=eR(e,["data"]);if(null!=n&&ew(t,["data"],n),void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}function tJ(e,t){let n={},r=eR(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["mediaResolution"]);null!=r&&ew(n,["mediaResolution"],r);let i=eR(e,["codeExecutionResult"]);null!=i&&ew(n,["codeExecutionResult"],i);let o=eR(e,["executableCode"]);null!=o&&ew(n,["executableCode"],o);let s=eR(e,["fileData"]);null!=s&&ew(n,["fileData"],function(e,t){let n={};if(void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eR(e,["fileUri"]);null!=r&&ew(n,["fileUri"],r);let i=eR(e,["mimeType"]);return null!=i&&ew(n,["mimeType"],i),n}(s));let a=eR(e,["functionCall"]);null!=a&&ew(n,["functionCall"],function(e,t){let n={},r=eR(e,["id"]);null!=r&&ew(n,["id"],r);let i=eR(e,["args"]);null!=i&&ew(n,["args"],i);let o=eR(e,["name"]);if(null!=o&&ew(n,["name"],o),void 0!==eR(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==eR(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return n}(a));let l=eR(e,["functionResponse"]);null!=l&&ew(n,["functionResponse"],l);let u=eR(e,["inlineData"]);null!=u&&ew(n,["inlineData"],function(e,t){let n={},r=eR(e,["data"]);if(null!=r&&ew(n,["data"],r),void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=eR(e,["mimeType"]);return null!=i&&ew(n,["mimeType"],i),n}(u));let c=eR(e,["text"]);null!=c&&ew(n,["text"],c);let d=eR(e,["thought"]);null!=d&&ew(n,["thought"],d);let p=eR(e,["thoughtSignature"]);null!=p&&ew(n,["thoughtSignature"],p);let h=eR(e,["videoMetadata"]);return null!=h&&ew(n,["videoMetadata"],h),n})(e))),ew(n,["parts"],e)}let i=eR(e,["role"]);return null!=i&&ew(n,["role"],i),n}function tK(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["contents"]);if(null!=o){let e=tc(o);Array.isArray(e)&&(e=e.map(e=>tJ(e))),ew(r,["contents"],e)}let s=eR(t,["config"]);return null!=s&&ew(r,["generationConfig"],function(e,t,n,r){let i={},o=eR(t,["systemInstruction"]);void 0!==n&&null!=o&&ew(n,["systemInstruction"],tJ(tl(o)));let s=eR(t,["temperature"]);null!=s&&ew(i,["temperature"],s);let a=eR(t,["topP"]);null!=a&&ew(i,["topP"],a);let l=eR(t,["topK"]);null!=l&&ew(i,["topK"],l);let u=eR(t,["candidateCount"]);null!=u&&ew(i,["candidateCount"],u);let c=eR(t,["maxOutputTokens"]);null!=c&&ew(i,["maxOutputTokens"],c);let d=eR(t,["stopSequences"]);null!=d&&ew(i,["stopSequences"],d);let p=eR(t,["responseLogprobs"]);null!=p&&ew(i,["responseLogprobs"],p);let h=eR(t,["logprobs"]);null!=h&&ew(i,["logprobs"],h);let f=eR(t,["presencePenalty"]);null!=f&&ew(i,["presencePenalty"],f);let g=eR(t,["frequencyPenalty"]);null!=g&&ew(i,["frequencyPenalty"],g);let m=eR(t,["seed"]);null!=m&&ew(i,["seed"],m);let y=eR(t,["responseMimeType"]);null!=y&&ew(i,["responseMimeType"],y);let v=eR(t,["responseSchema"]);null!=v&&ew(i,["responseSchema"],td(v));let E=eR(t,["responseJsonSchema"]);if(null!=E&&ew(i,["responseJsonSchema"],E),void 0!==eR(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==eR(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=eR(t,["safetySettings"]);if(void 0!==n&&null!=_){let e=_;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["category"]);if(null!=r&&ew(n,["category"],r),void 0!==eR(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let i=eR(e,["threshold"]);return null!=i&&ew(n,["threshold"],i),n})(e))),ew(n,["safetySettings"],e)}let A=eR(t,["tools"]);if(void 0!==n&&null!=A){let e=tg(A);Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={};if(void 0!==eR(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=eR(e,["computerUse"]);null!=r&&ew(n,["computerUse"],r);let i=eR(e,["fileSearch"]);null!=i&&ew(n,["fileSearch"],i);let o=eR(e,["codeExecution"]);if(null!=o&&ew(n,["codeExecution"],o),void 0!==eR(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=eR(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["functionDeclarations"],e)}let a=eR(e,["googleMaps"]);null!=a&&ew(n,["googleMaps"],function(e,t){let n={};if(void 0!==eR(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=eR(e,["enableWidget"]);return null!=r&&ew(n,["enableWidget"],r),n}(a));let l=eR(e,["googleSearch"]);null!=l&&ew(n,["googleSearch"],function(e,t){let n={};if(void 0!==eR(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eR(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=eR(e,["timeRangeFilter"]);return null!=r&&ew(n,["timeRangeFilter"],r),n}(l));let u=eR(e,["googleSearchRetrieval"]);null!=u&&ew(n,["googleSearchRetrieval"],u);let c=eR(e,["urlContext"]);return null!=c&&ew(n,["urlContext"],c),n})(tf(e)))),ew(n,["tools"],e)}let T=eR(t,["toolConfig"]);if(void 0!==n&&null!=T&&ew(n,["toolConfig"],function(e,t){let n={},r=eR(e,["retrievalConfig"]);null!=r&&ew(n,["retrievalConfig"],r);let i=eR(e,["functionCallingConfig"]);return null!=i&&ew(n,["functionCallingConfig"],function(e,t){let n={},r=eR(e,["allowedFunctionNames"]);null!=r&&ew(n,["allowedFunctionNames"],r);let i=eR(e,["mode"]);if(null!=i&&ew(n,["mode"],i),void 0!==eR(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return n}(i)),n}(T)),void 0!==eR(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let S=eR(t,["cachedContent"]);void 0!==n&&null!=S&&ew(n,["cachedContent"],tm(e,S));let b=eR(t,["responseModalities"]);null!=b&&ew(i,["responseModalities"],b);let C=eR(t,["mediaResolution"]);null!=C&&ew(i,["mediaResolution"],C);let O=eR(t,["speechConfig"]);if(null!=O&&ew(i,["speechConfig"],tp(O)),void 0!==eR(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let I=eR(t,["thinkingConfig"]);null!=I&&ew(i,["thinkingConfig"],I);let w=eR(t,["imageConfig"]);null!=w&&ew(i,["imageConfig"],function(e,t){let n={},r=eR(e,["aspectRatio"]);null!=r&&ew(n,["aspectRatio"],r);let i=eR(e,["imageSize"]);if(null!=i&&ew(n,["imageSize"],i),void 0!==eR(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==eR(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==eR(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return n}(w));let R=eR(t,["enableEnhancedCivicAnswers"]);if(null!=R&&ew(i,["enableEnhancedCivicAnswers"],R),void 0!==eR(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return i}(e,s,r)),r}function tz(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["contents"]);if(null!=o){let e=tc(o);Array.isArray(e)&&(e=e.map(e=>e)),ew(r,["contents"],e)}let s=eR(t,["config"]);return null!=s&&ew(r,["generationConfig"],function(e,t,n,r){let i={},o=eR(t,["systemInstruction"]);void 0!==n&&null!=o&&ew(n,["systemInstruction"],tl(o));let s=eR(t,["temperature"]);null!=s&&ew(i,["temperature"],s);let a=eR(t,["topP"]);null!=a&&ew(i,["topP"],a);let l=eR(t,["topK"]);null!=l&&ew(i,["topK"],l);let u=eR(t,["candidateCount"]);null!=u&&ew(i,["candidateCount"],u);let c=eR(t,["maxOutputTokens"]);null!=c&&ew(i,["maxOutputTokens"],c);let d=eR(t,["stopSequences"]);null!=d&&ew(i,["stopSequences"],d);let p=eR(t,["responseLogprobs"]);null!=p&&ew(i,["responseLogprobs"],p);let h=eR(t,["logprobs"]);null!=h&&ew(i,["logprobs"],h);let f=eR(t,["presencePenalty"]);null!=f&&ew(i,["presencePenalty"],f);let g=eR(t,["frequencyPenalty"]);null!=g&&ew(i,["frequencyPenalty"],g);let m=eR(t,["seed"]);null!=m&&ew(i,["seed"],m);let y=eR(t,["responseMimeType"]);null!=y&&ew(i,["responseMimeType"],y);let v=eR(t,["responseSchema"]);null!=v&&ew(i,["responseSchema"],td(v));let E=eR(t,["responseJsonSchema"]);null!=E&&ew(i,["responseJsonSchema"],E);let _=eR(t,["routingConfig"]);null!=_&&ew(i,["routingConfig"],_);let A=eR(t,["modelSelectionConfig"]);null!=A&&ew(i,["modelConfig"],A);let T=eR(t,["safetySettings"]);if(void 0!==n&&null!=T){let e=T;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["safetySettings"],e)}let S=eR(t,["tools"]);if(void 0!==n&&null!=S){let e=tg(S);Array.isArray(e)&&(e=e.map(e=>t6(tf(e)))),ew(n,["tools"],e)}let b=eR(t,["toolConfig"]);void 0!==n&&null!=b&&ew(n,["toolConfig"],b);let C=eR(t,["labels"]);void 0!==n&&null!=C&&ew(n,["labels"],C);let O=eR(t,["cachedContent"]);void 0!==n&&null!=O&&ew(n,["cachedContent"],tm(e,O));let I=eR(t,["responseModalities"]);null!=I&&ew(i,["responseModalities"],I);let w=eR(t,["mediaResolution"]);null!=w&&ew(i,["mediaResolution"],w);let R=eR(t,["speechConfig"]);null!=R&&ew(i,["speechConfig"],tp(R));let N=eR(t,["audioTimestamp"]);null!=N&&ew(i,["audioTimestamp"],N);let k=eR(t,["thinkingConfig"]);null!=k&&ew(i,["thinkingConfig"],k);let P=eR(t,["imageConfig"]);if(null!=P&&ew(i,["imageConfig"],function(e,t){let n={},r=eR(e,["aspectRatio"]);null!=r&&ew(n,["aspectRatio"],r);let i=eR(e,["imageSize"]);null!=i&&ew(n,["imageSize"],i);let o=eR(e,["personGeneration"]);null!=o&&ew(n,["personGeneration"],o);let s=eR(e,["outputMimeType"]);null!=s&&ew(n,["imageOutputOptions","mimeType"],s);let a=eR(e,["outputCompressionQuality"]);return null!=a&&ew(n,["imageOutputOptions","compressionQuality"],a),n}(P)),void 0!==eR(t,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");let x=eR(t,["modelArmorConfig"]);return void 0!==n&&null!=x&&ew(n,["modelArmorConfig"],x),i}(e,s,r)),r}function tW(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["content"]);null!=r&&ew(n,["content"],r);let i=eR(e,["citationMetadata"]);null!=i&&ew(n,["citationMetadata"],function(e,t){let n={},r=eR(e,["citationSources"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["citations"],e)}return n}(i));let o=eR(e,["tokenCount"]);null!=o&&ew(n,["tokenCount"],o);let s=eR(e,["finishReason"]);null!=s&&ew(n,["finishReason"],s);let a=eR(e,["avgLogprobs"]);null!=a&&ew(n,["avgLogprobs"],a);let l=eR(e,["groundingMetadata"]);null!=l&&ew(n,["groundingMetadata"],l);let u=eR(e,["index"]);null!=u&&ew(n,["index"],u);let c=eR(e,["logprobsResult"]);null!=c&&ew(n,["logprobsResult"],c);let d=eR(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["safetyRatings"],e)}let p=eR(e,["urlContextMetadata"]);return null!=p&&ew(n,["urlContextMetadata"],p),n})(e))),ew(n,["candidates"],e)}let o=eR(e,["modelVersion"]);null!=o&&ew(n,["modelVersion"],o);let s=eR(e,["promptFeedback"]);null!=s&&ew(n,["promptFeedback"],s);let a=eR(e,["responseId"]);null!=a&&ew(n,["responseId"],a);let l=eR(e,["usageMetadata"]);return null!=l&&ew(n,["usageMetadata"],l),n}function tY(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["candidates"],e)}let o=eR(e,["createTime"]);null!=o&&ew(n,["createTime"],o);let s=eR(e,["modelVersion"]);null!=s&&ew(n,["modelVersion"],s);let a=eR(e,["promptFeedback"]);null!=a&&ew(n,["promptFeedback"],a);let l=eR(e,["responseId"]);null!=l&&ew(n,["responseId"],l);let u=eR(e,["usageMetadata"]);return null!=u&&ew(n,["usageMetadata"],u),n}function tX(e,t){let n={},r=eR(e,["_self"]);null!=r&&ew(n,["image"],tQ(r));let i=eR(e,["raiFilteredReason"]);null!=i&&ew(n,["raiFilteredReason"],i);let o=eR(e,["_self"]);null!=o&&ew(n,["safetyAttributes"],t3(o));let s=eR(e,["prompt"]);return null!=s&&ew(n,["enhancedPrompt"],s),n}function tQ(e,t){let n={},r=eR(e,["gcsUri"]);null!=r&&ew(n,["gcsUri"],r);let i=eR(e,["bytesBase64Encoded"]);null!=i&&ew(n,["imageBytes"],eN(i));let o=eR(e,["mimeType"]);return null!=o&&ew(n,["mimeType"],o),n}function tZ(e,t){let n={};if(void 0!==eR(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let r=eR(e,["imageBytes"]);null!=r&&ew(n,["bytesBase64Encoded"],eN(r));let i=eR(e,["mimeType"]);return null!=i&&ew(n,["mimeType"],i),n}function t0(e,t){let n={},r=eR(e,["gcsUri"]);null!=r&&ew(n,["gcsUri"],r);let i=eR(e,["imageBytes"]);null!=i&&ew(n,["bytesBase64Encoded"],eN(i));let o=eR(e,["mimeType"]);return null!=o&&ew(n,["mimeType"],o),n}function t1(e,t){let n={},r=eR(e,["name"]);null!=r&&ew(n,["name"],r);let i=eR(e,["displayName"]);null!=i&&ew(n,["displayName"],i);let o=eR(e,["description"]);null!=o&&ew(n,["description"],o);let s=eR(e,["version"]);null!=s&&ew(n,["version"],s);let a=eR(e,["_self"]);null!=a&&ew(n,["tunedModelInfo"],function(e,t){let n={},r=eR(e,["baseModel"]);null!=r&&ew(n,["baseModel"],r);let i=eR(e,["createTime"]);null!=i&&ew(n,["createTime"],i);let o=eR(e,["updateTime"]);return null!=o&&ew(n,["updateTime"],o),n}(a));let l=eR(e,["inputTokenLimit"]);null!=l&&ew(n,["inputTokenLimit"],l);let u=eR(e,["outputTokenLimit"]);null!=u&&ew(n,["outputTokenLimit"],u);let c=eR(e,["supportedGenerationMethods"]);null!=c&&ew(n,["supportedActions"],c);let d=eR(e,["temperature"]);null!=d&&ew(n,["temperature"],d);let p=eR(e,["maxTemperature"]);null!=p&&ew(n,["maxTemperature"],p);let h=eR(e,["topP"]);null!=h&&ew(n,["topP"],h);let f=eR(e,["topK"]);null!=f&&ew(n,["topK"],f);let g=eR(e,["thinking"]);return null!=g&&ew(n,["thinking"],g),n}function t2(e,t){let n={},r=eR(e,["name"]);null!=r&&ew(n,["name"],r);let i=eR(e,["displayName"]);null!=i&&ew(n,["displayName"],i);let o=eR(e,["description"]);null!=o&&ew(n,["description"],o);let s=eR(e,["versionId"]);null!=s&&ew(n,["version"],s);let a=eR(e,["deployedModels"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["endpoint"]);null!=r&&ew(n,["name"],r);let i=eR(e,["deployedModelId"]);return null!=i&&ew(n,["deployedModelId"],i),n})(e))),ew(n,["endpoints"],e)}let l=eR(e,["labels"]);null!=l&&ew(n,["labels"],l);let u=eR(e,["_self"]);null!=u&&ew(n,["tunedModelInfo"],function(e,t){let n={},r=eR(e,["labels","google-vertex-llm-tuning-base-model-id"]);null!=r&&ew(n,["baseModel"],r);let i=eR(e,["createTime"]);null!=i&&ew(n,["createTime"],i);let o=eR(e,["updateTime"]);return null!=o&&ew(n,["updateTime"],o),n}(u));let c=eR(e,["defaultCheckpointId"]);null!=c&&ew(n,["defaultCheckpointId"],c);let d=eR(e,["checkpoints"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["checkpoints"],e)}return n}function t4(e,t){let n={},r=eR(e,["safetyAttributes","categories"]);null!=r&&ew(n,["categories"],r);let i=eR(e,["safetyAttributes","scores"]);null!=i&&ew(n,["scores"],i);let o=eR(e,["contentType"]);return null!=o&&ew(n,["contentType"],o),n}function t3(e,t){let n={},r=eR(e,["safetyAttributes","categories"]);null!=r&&ew(n,["categories"],r);let i=eR(e,["safetyAttributes","scores"]);null!=i&&ew(n,["scores"],i);let o=eR(e,["contentType"]);return null!=o&&ew(n,["contentType"],o),n}function t6(e,t){let n={},r=eR(e,["retrieval"]);null!=r&&ew(n,["retrieval"],r);let i=eR(e,["computerUse"]);if(null!=i&&ew(n,["computerUse"],i),void 0!==eR(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let o=eR(e,["codeExecution"]);null!=o&&ew(n,["codeExecution"],o);let s=eR(e,["enterpriseWebSearch"]);null!=s&&ew(n,["enterpriseWebSearch"],s);let a=eR(e,["functionDeclarations"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["description"]);null!=r&&ew(n,["description"],r);let i=eR(e,["name"]);null!=i&&ew(n,["name"],i);let o=eR(e,["parameters"]);null!=o&&ew(n,["parameters"],o);let s=eR(e,["parametersJsonSchema"]);null!=s&&ew(n,["parametersJsonSchema"],s);let a=eR(e,["response"]);null!=a&&ew(n,["response"],a);let l=eR(e,["responseJsonSchema"]);if(null!=l&&ew(n,["responseJsonSchema"],l),void 0!==eR(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return n})(e))),ew(n,["functionDeclarations"],e)}let l=eR(e,["googleMaps"]);null!=l&&ew(n,["googleMaps"],l);let u=eR(e,["googleSearch"]);null!=u&&ew(n,["googleSearch"],u);let c=eR(e,["googleSearchRetrieval"]);null!=c&&ew(n,["googleSearchRetrieval"],c);let d=eR(e,["urlContext"]);return null!=d&&ew(n,["urlContext"],d),n}function t9(e,t){let n={},r=eR(e,["uri"]);null!=r&&ew(n,["uri"],r);let i=eR(e,["videoBytes"]);null!=i&&ew(n,["encodedVideo"],eN(i));let o=eR(e,["mimeType"]);return null!=o&&ew(n,["encoding"],o),n}function t5(e,t){let n={},r=eR(e,["uri"]);null!=r&&ew(n,["gcsUri"],r);let i=eR(e,["videoBytes"]);null!=i&&ew(n,["bytesBase64Encoded"],eN(i));let o=eR(e,["mimeType"]);return null!=o&&ew(n,["mimeType"],o),n}function t8(e,t){let n=eR(e,["mimeType"]);void 0!==t&&null!=n&&ew(t,["mimeType"],n);let r=eR(e,["displayName"]);void 0!==t&&null!=r&&ew(t,["displayName"],r);let i=eR(e,["customMetadata"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["customMetadata"],e)}let o=eR(e,["chunkingConfig"]);return void 0!==t&&null!=o&&ew(t,["chunkingConfig"],o),{}}let t7="x-goog-api-client";class ne{constructor(e){var t,n,r;this.clientOptions=Object.assign({},e),this.customBaseUrl=null===(t=e.httpOptions)||void 0===t?void 0:t.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));let i={};if(this.clientOptions.vertexai){if(this.clientOptions.location||this.clientOptions.apiKey||this.customBaseUrl||(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");let t=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!t?(i.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||"global"===this.clientOptions.location?i.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),i.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta1"}else{if(!this.clientOptions.apiKey)throw new tB({message:"API key must be set when using the Gemini API.",status:403});i.apiVersion=null!==(r=this.clientOptions.apiVersion)&&void 0!==r?r:"v1beta",i.baseUrl="https://generativelanguage.googleapis.com/"}i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}isVertexAI(){var e;return null!==(e=this.clientOptions.vertexai)&&void 0!==e&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let r=[this.getRequestUrlInternal(t)];return n&&r.push(this.getBaseResourcePath()),""!==e&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e,t){return!(t.baseUrl&&t.baseUrlResourceScope===M.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e,t),r=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))r.searchParams.append(t,String(n));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.unaryApiCall(r,i,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,r]of Object.entries(t))"object"==typeof r?n[e]=Object.assign(Object.assign({},n[e]),r):void 0!==r&&(n[e]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e,t),r=this.constructUrl(e.path,t,n);r.searchParams.has("alt")&&"sse"===r.searchParams.get("alt")||r.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.streamApiCall(r,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,r){if(t&&t.timeout||r){let n=new AbortController,i=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}r&&r.addEventListener("abort",()=>{n.abort()}),e.signal=i}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t)){console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}let r=function e(t,n){let r=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],o=r[t];i&&"object"==typeof i&&!Array.isArray(i)&&o&&"object"==typeof o&&!Array.isArray(o)?r[t]=e(o,i):(o&&i&&typeof o!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof o}, New type: ${typeof i}. Overwriting.`),r[t]=i)}return r}(n,t);e.body=JSON.stringify(r)}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nt(e),new eP(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nt(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){return tj(this,arguments,function*(){var t;let n=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="",i="data:",o=["\n\n","\r\r","\r\n\r\n"];for(;;){let{done:s,value:a}=yield tM(n.read());if(s){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let l=r.decode(a,{stream:!0});try{let e=JSON.parse(l);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,r=t.code,i=`got status: ${n}. ${JSON.stringify(e)}`;if(r>=400&&r<600)throw new tB({message:i,status:r})}}catch(e){if("ApiError"===e.name)throw e}t+=l;let u=-1,c=0;for(;;){for(let e of(u=-1,c=0,o)){let n=t.indexOf(e);-1!==n&&(-1===u||n<u)&&(u=n,c=e.length)}if(-1===u)break;let n=t.substring(0,u);t=t.substring(u+c);let r=n.trim();if(r.startsWith(i)){let t=r.substring(i.length).trim();try{let n=new Response(t,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield tM(new eP(n))}catch(e){throw Error(`exception parsing stream chunk ${t}. ${e}`)}}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.40.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[t7]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,r]of Object.entries(e.headers))n.append(t,r);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return"string"==typeof e&&(n=null!==(t=(n=e.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())&&void 0!==t?t:""),n}async uploadFile(e,t){var n;let r={};null!=t&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let i=this.clientOptions.uploader,o=await i.stat(e);r.sizeBytes=String(o.size);let s=null!==(n=null==t?void 0:t.mimeType)&&void 0!==n?n:o.type;if(void 0===s||""===s)throw Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=s;let a={file:r},l=this.getFileName(e),u=eI("upload/v1beta/files",a._url),c=await this.fetchUploadUrl(u,r.sizeBytes,r.mimeType,l,a,null==t?void 0:t.httpOptions);return i.upload(e,c,this)}async uploadFileToFileSearchStore(e,t,n){var r;let i=this.clientOptions.uploader,o=await i.stat(t),s=String(o.size),a=null!==(r=null==n?void 0:n.mimeType)&&void 0!==r?r:o.type;if(void 0===a||""===a)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let l=`upload/v1beta/${e}:uploadToFileSearchStore`,u=this.getFileName(t),c={};null!=n&&t8(n,c);let d=await this.fetchUploadUrl(l,s,a,u,c,null==n?void 0:n.httpOptions);return i.uploadToFileSearchStore(t,d,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,n,r,i,o){var s;let a={};a=o||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},r?{"X-Goog-Upload-File-Name":r}:{})};let l=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:a});if(!l||!(null==l?void 0:l.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let u=null===(s=null==l?void 0:l.headers)||void 0===s?void 0:s["x-goog-upload-url"];if(void 0===u)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function nt(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,r=JSON.stringify((null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new tB({message:r,status:n});throw Error(r)}}function nn(e){for(let t of e){if(null!==t&&"object"==typeof t&&t instanceof ni||"object"==typeof t&&"inputSchema"in t)return!0}return!1}function nr(e){var t;let n=null!==(t=e[t7])&&void 0!==t?t:"";e[t7]=(n+" mcp_used/unknown").trimStart()}class ni{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new ni(e,t)}async initialize(){var e,t,n,r;if(this.mcpTools.length>0)return;let i={},o=[];for(let u of this.mcpClients)try{for(var s,a=!0,l=(t=void 0,tL(function(e){return tj(this,arguments,function*(e,t=100){let n;let r=0;for(;r<t;){let t=yield tM(e.listTools({cursor:n}));for(let e of t.tools)yield yield tM(e),r++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(s=await l.next()).done);a=!0){r=s.value,a=!1,o.push(r);let e=r.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=u}}catch(e){t={error:e}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let n=[],r=new Set;for(let i of e){let e=i.name;if(r.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r.add(e);let o=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(i,t);o.functionDeclarations&&n.push(...o.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e;let r=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await r.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:i.isError?{error:i}:i}})}return t}}async function no(e,t,n){let r;let i=new e6;n.data instanceof Blob?r=JSON.parse(await n.data.text()):r=JSON.parse(n.data),Object.assign(i,r),t(i)}class ns{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),o=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(this.apiClient.getDefaultHeaders()),s=this.apiClient.getApiKey(),a=`${r}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${s}`,l=()=>{},u=new Promise(e=>{l=e}),c=e.callbacks,d=this.apiClient,p={onopen:function(){l({})},onmessage:e=>{no(d,c.onmessage,e)},onerror:null!==(t=null==c?void 0:c.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==c?void 0:c.onclose)&&void 0!==n?n:function(e){}},h=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}(o),p);h.connect(),await u;let f=e5(this.apiClient,e.model);return h.send(JSON.stringify({setup:{model:f}})),new na(h,this.apiClient)}}class na{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=eR(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=function(e){let t={},n=eR(e,["musicGenerationConfig"]);return null!=n&&ew(t,["musicGenerationConfig"],n),t}(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(ec.PLAY)}pause(){this.sendPlaybackControl(ec.PAUSE)}stop(){this.sendPlaybackControl(ec.STOP)}resetContext(){this.sendPlaybackControl(ec.RESET_CONTEXT)}close(){this.conn.close()}}async function nl(e,t,n){let r;let i=new e3;n.data instanceof Blob?r=await n.data.text():r=n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data;let o=JSON.parse(r);e.isVertexAI()?Object.assign(i,function(e){let t={},n=eR(e,["setupComplete"]);null!=n&&ew(t,["setupComplete"],n);let r=eR(e,["serverContent"]);null!=r&&ew(t,["serverContent"],r);let i=eR(e,["toolCall"]);null!=i&&ew(t,["toolCall"],i);let o=eR(e,["toolCallCancellation"]);null!=o&&ew(t,["toolCallCancellation"],o);let s=eR(e,["usageMetadata"]);null!=s&&ew(t,["usageMetadata"],function(e){let t={},n=eR(e,["promptTokenCount"]);null!=n&&ew(t,["promptTokenCount"],n);let r=eR(e,["cachedContentTokenCount"]);null!=r&&ew(t,["cachedContentTokenCount"],r);let i=eR(e,["candidatesTokenCount"]);null!=i&&ew(t,["responseTokenCount"],i);let o=eR(e,["toolUsePromptTokenCount"]);null!=o&&ew(t,["toolUsePromptTokenCount"],o);let s=eR(e,["thoughtsTokenCount"]);null!=s&&ew(t,["thoughtsTokenCount"],s);let a=eR(e,["totalTokenCount"]);null!=a&&ew(t,["totalTokenCount"],a);let l=eR(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["promptTokensDetails"],e)}let u=eR(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["cacheTokensDetails"],e)}let c=eR(e,["candidatesTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["responseTokensDetails"],e)}let d=eR(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["toolUsePromptTokensDetails"],e)}let p=eR(e,["trafficType"]);return null!=p&&ew(t,["trafficType"],p),t}(s));let a=eR(e,["goAway"]);null!=a&&ew(t,["goAway"],a);let l=eR(e,["sessionResumptionUpdate"]);null!=l&&ew(t,["sessionResumptionUpdate"],l);let u=eR(e,["voiceActivityDetectionSignal"]);null!=u&&ew(t,["voiceActivityDetectionSignal"],u);let c=eR(e,["voiceActivity"]);return null!=c&&ew(t,["voiceActivity"],function(e){let t={},n=eR(e,["type"]);return null!=n&&ew(t,["voiceActivityType"],n),t}(c)),t}(o)):Object.assign(i,o),t(i)}class nu{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new ns(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,r,i,o,s;let a;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),c=this.apiClient.getHeaders();e.config&&e.config.tools&&nn(e.config.tools)&&nr(c);let d=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(c);if(this.apiClient.isVertexAI()){let e=this.apiClient.getProject(),t=this.apiClient.getLocation(),n=this.apiClient.getApiKey();this.apiClient.getCustomBaseUrl()&&!(e&&t||n)?a=l:(a=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(d,a))}else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==u&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),a=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${t}?${n}=${e}`}let p=()=>{},h=new Promise(e=>{p=e}),f=e.callbacks,g=this.apiClient,m={onopen:function(){var e;null===(e=null==f?void 0:f.onopen)||void 0===e||e.call(f),p({})},onmessage:e=>{nl(g,f.onmessage,e)},onerror:null!==(t=null==f?void 0:f.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==f?void 0:f.onclose)&&void 0!==n?n:function(e){}},y=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}(d),m);y.connect(),await h;let v=e5(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&v.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();e&&t&&(v=`projects/${e}/locations/${t}/`+v)}let E={};this.apiClient.isVertexAI()&&(null===(r=e.config)||void 0===r?void 0:r.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[R.AUDIO]}:e.config.responseModalities=[R.AUDIO]),(null===(i=e.config)||void 0===i?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let _=null!==(s=null===(o=e.config)||void 0===o?void 0:o.tools)&&void 0!==s?s:[],A=[];for(let e of _)this.isCallableTool(e)?A.push(await e.tool()):A.push(e);A.length>0&&(e.config.tools=A);let T={model:v,config:e.config,callbacks:e.callbacks};return E=this.apiClient.isVertexAI()?function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["setup","model"],e5(e,r));let i=eR(t,["config"]);return null!=i&&ew(n,["config"],function(e,t){let n=eR(e,["generationConfig"]);void 0!==t&&null!=n&&ew(t,["setup","generationConfig"],function(e){let t={},n=eR(e,["modelSelectionConfig"]);null!=n&&ew(t,["modelConfig"],n);let r=eR(e,["responseJsonSchema"]);null!=r&&ew(t,["responseJsonSchema"],r);let i=eR(e,["audioTimestamp"]);null!=i&&ew(t,["audioTimestamp"],i);let o=eR(e,["candidateCount"]);null!=o&&ew(t,["candidateCount"],o);let s=eR(e,["enableAffectiveDialog"]);null!=s&&ew(t,["enableAffectiveDialog"],s);let a=eR(e,["frequencyPenalty"]);null!=a&&ew(t,["frequencyPenalty"],a);let l=eR(e,["logprobs"]);null!=l&&ew(t,["logprobs"],l);let u=eR(e,["maxOutputTokens"]);null!=u&&ew(t,["maxOutputTokens"],u);let c=eR(e,["mediaResolution"]);null!=c&&ew(t,["mediaResolution"],c);let d=eR(e,["presencePenalty"]);null!=d&&ew(t,["presencePenalty"],d);let p=eR(e,["responseLogprobs"]);null!=p&&ew(t,["responseLogprobs"],p);let h=eR(e,["responseMimeType"]);null!=h&&ew(t,["responseMimeType"],h);let f=eR(e,["responseModalities"]);null!=f&&ew(t,["responseModalities"],f);let g=eR(e,["responseSchema"]);null!=g&&ew(t,["responseSchema"],g);let m=eR(e,["routingConfig"]);null!=m&&ew(t,["routingConfig"],m);let y=eR(e,["seed"]);null!=y&&ew(t,["seed"],y);let v=eR(e,["speechConfig"]);null!=v&&ew(t,["speechConfig"],v);let E=eR(e,["stopSequences"]);null!=E&&ew(t,["stopSequences"],E);let _=eR(e,["temperature"]);null!=_&&ew(t,["temperature"],_);let A=eR(e,["thinkingConfig"]);null!=A&&ew(t,["thinkingConfig"],A);let T=eR(e,["topK"]);null!=T&&ew(t,["topK"],T);let S=eR(e,["topP"]);if(null!=S&&ew(t,["topP"],S),void 0!==eR(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let r=eR(e,["responseModalities"]);void 0!==t&&null!=r&&ew(t,["setup","generationConfig","responseModalities"],r);let i=eR(e,["temperature"]);void 0!==t&&null!=i&&ew(t,["setup","generationConfig","temperature"],i);let o=eR(e,["topP"]);void 0!==t&&null!=o&&ew(t,["setup","generationConfig","topP"],o);let s=eR(e,["topK"]);void 0!==t&&null!=s&&ew(t,["setup","generationConfig","topK"],s);let a=eR(e,["maxOutputTokens"]);void 0!==t&&null!=a&&ew(t,["setup","generationConfig","maxOutputTokens"],a);let l=eR(e,["mediaResolution"]);void 0!==t&&null!=l&&ew(t,["setup","generationConfig","mediaResolution"],l);let u=eR(e,["seed"]);void 0!==t&&null!=u&&ew(t,["setup","generationConfig","seed"],u);let c=eR(e,["speechConfig"]);void 0!==t&&null!=c&&ew(t,["setup","generationConfig","speechConfig"],th(c));let d=eR(e,["thinkingConfig"]);void 0!==t&&null!=d&&ew(t,["setup","generationConfig","thinkingConfig"],d);let p=eR(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&ew(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=eR(e,["systemInstruction"]);void 0!==t&&null!=h&&ew(t,["setup","systemInstruction"],tl(h));let f=eR(e,["tools"]);if(void 0!==t&&null!=f){let e=tg(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["retrieval"]);null!=n&&ew(t,["retrieval"],n);let r=eR(e,["computerUse"]);if(null!=r&&ew(t,["computerUse"],r),void 0!==eR(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=eR(e,["codeExecution"]);null!=i&&ew(t,["codeExecution"],i);let o=eR(e,["enterpriseWebSearch"]);null!=o&&ew(t,["enterpriseWebSearch"],o);let s=eR(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["description"]);null!=n&&ew(t,["description"],n);let r=eR(e,["name"]);null!=r&&ew(t,["name"],r);let i=eR(e,["parameters"]);null!=i&&ew(t,["parameters"],i);let o=eR(e,["parametersJsonSchema"]);null!=o&&ew(t,["parametersJsonSchema"],o);let s=eR(e,["response"]);null!=s&&ew(t,["response"],s);let a=eR(e,["responseJsonSchema"]);if(null!=a&&ew(t,["responseJsonSchema"],a),void 0!==eR(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),ew(t,["functionDeclarations"],e)}let a=eR(e,["googleMaps"]);null!=a&&ew(t,["googleMaps"],a);let l=eR(e,["googleSearch"]);null!=l&&ew(t,["googleSearch"],l);let u=eR(e,["googleSearchRetrieval"]);null!=u&&ew(t,["googleSearchRetrieval"],u);let c=eR(e,["urlContext"]);return null!=c&&ew(t,["urlContext"],c),t})(tf(e)))),ew(t,["setup","tools"],e)}let g=eR(e,["sessionResumption"]);void 0!==t&&null!=g&&ew(t,["setup","sessionResumption"],g);let m=eR(e,["inputAudioTranscription"]);void 0!==t&&null!=m&&ew(t,["setup","inputAudioTranscription"],m);let y=eR(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&ew(t,["setup","outputAudioTranscription"],y);let v=eR(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&ew(t,["setup","realtimeInputConfig"],v);let E=eR(e,["contextWindowCompression"]);void 0!==t&&null!=E&&ew(t,["setup","contextWindowCompression"],E);let _=eR(e,["proactivity"]);void 0!==t&&null!=_&&ew(t,["setup","proactivity"],_);let A=eR(e,["explicitVadSignal"]);return void 0!==t&&null!=A&&ew(t,["setup","explicitVadSignal"],A),{}}(i,n)),n}(this.apiClient,T):function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["setup","model"],e5(e,r));let i=eR(t,["config"]);return null!=i&&ew(n,["config"],function(e,t){let n=eR(e,["generationConfig"]);void 0!==t&&null!=n&&ew(t,["setup","generationConfig"],n);let r=eR(e,["responseModalities"]);void 0!==t&&null!=r&&ew(t,["setup","generationConfig","responseModalities"],r);let i=eR(e,["temperature"]);void 0!==t&&null!=i&&ew(t,["setup","generationConfig","temperature"],i);let o=eR(e,["topP"]);void 0!==t&&null!=o&&ew(t,["setup","generationConfig","topP"],o);let s=eR(e,["topK"]);void 0!==t&&null!=s&&ew(t,["setup","generationConfig","topK"],s);let a=eR(e,["maxOutputTokens"]);void 0!==t&&null!=a&&ew(t,["setup","generationConfig","maxOutputTokens"],a);let l=eR(e,["mediaResolution"]);void 0!==t&&null!=l&&ew(t,["setup","generationConfig","mediaResolution"],l);let u=eR(e,["seed"]);void 0!==t&&null!=u&&ew(t,["setup","generationConfig","seed"],u);let c=eR(e,["speechConfig"]);void 0!==t&&null!=c&&ew(t,["setup","generationConfig","speechConfig"],th(c));let d=eR(e,["thinkingConfig"]);void 0!==t&&null!=d&&ew(t,["setup","generationConfig","thinkingConfig"],d);let p=eR(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&ew(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=eR(e,["systemInstruction"]);void 0!==t&&null!=h&&ew(t,["setup","systemInstruction"],function(e){let t={},n=eR(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["mediaResolution"]);null!=n&&ew(t,["mediaResolution"],n);let r=eR(e,["codeExecutionResult"]);null!=r&&ew(t,["codeExecutionResult"],r);let i=eR(e,["executableCode"]);null!=i&&ew(t,["executableCode"],i);let o=eR(e,["fileData"]);null!=o&&ew(t,["fileData"],function(e){let t={};if(void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eR(e,["fileUri"]);null!=n&&ew(t,["fileUri"],n);let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}(o));let s=eR(e,["functionCall"]);null!=s&&ew(t,["functionCall"],function(e){let t={},n=eR(e,["id"]);null!=n&&ew(t,["id"],n);let r=eR(e,["args"]);null!=r&&ew(t,["args"],r);let i=eR(e,["name"]);if(null!=i&&ew(t,["name"],i),void 0!==eR(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==eR(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=eR(e,["functionResponse"]);null!=a&&ew(t,["functionResponse"],a);let l=eR(e,["inlineData"]);null!=l&&ew(t,["inlineData"],t$(l));let u=eR(e,["text"]);null!=u&&ew(t,["text"],u);let c=eR(e,["thought"]);null!=c&&ew(t,["thought"],c);let d=eR(e,["thoughtSignature"]);null!=d&&ew(t,["thoughtSignature"],d);let p=eR(e,["videoMetadata"]);return null!=p&&ew(t,["videoMetadata"],p),t})(e))),ew(t,["parts"],e)}let r=eR(e,["role"]);return null!=r&&ew(t,["role"],r),t}(tl(h)));let f=eR(e,["tools"]);if(void 0!==t&&null!=f){let e=tg(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==eR(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=eR(e,["computerUse"]);null!=n&&ew(t,["computerUse"],n);let r=eR(e,["fileSearch"]);null!=r&&ew(t,["fileSearch"],r);let i=eR(e,["codeExecution"]);if(null!=i&&ew(t,["codeExecution"],i),void 0!==eR(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=eR(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["functionDeclarations"],e)}let s=eR(e,["googleMaps"]);null!=s&&ew(t,["googleMaps"],function(e){let t={};if(void 0!==eR(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eR(e,["enableWidget"]);return null!=n&&ew(t,["enableWidget"],n),t}(s));let a=eR(e,["googleSearch"]);null!=a&&ew(t,["googleSearch"],function(e){let t={};if(void 0!==eR(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eR(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eR(e,["timeRangeFilter"]);return null!=n&&ew(t,["timeRangeFilter"],n),t}(a));let l=eR(e,["googleSearchRetrieval"]);null!=l&&ew(t,["googleSearchRetrieval"],l);let u=eR(e,["urlContext"]);return null!=u&&ew(t,["urlContext"],u),t})(tf(e)))),ew(t,["setup","tools"],e)}let g=eR(e,["sessionResumption"]);void 0!==t&&null!=g&&ew(t,["setup","sessionResumption"],function(e){let t={},n=eR(e,["handle"]);if(null!=n&&ew(t,["handle"],n),void 0!==eR(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(g));let m=eR(e,["inputAudioTranscription"]);void 0!==t&&null!=m&&ew(t,["setup","inputAudioTranscription"],m);let y=eR(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&ew(t,["setup","outputAudioTranscription"],y);let v=eR(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&ew(t,["setup","realtimeInputConfig"],v);let E=eR(e,["contextWindowCompression"]);void 0!==t&&null!=E&&ew(t,["setup","contextWindowCompression"],E);let _=eR(e,["proactivity"]);if(void 0!==t&&null!=_&&ew(t,["setup","proactivity"],_),void 0!==eR(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(i,n)),n}(this.apiClient,T),delete E.config,y.send(JSON.stringify(E)),new nd(y,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let nc={turnComplete:!0};class nd{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=tc(t.turns),e.isVertexAI()||(n=n.map(e=>tJ(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},nc),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=eR(e,["media"]);if(null!=n){let e=e7(n);Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["mediaChunks"],e)}let r=eR(e,["audio"]);null!=r&&ew(t,["audio"],tn(r));let i=eR(e,["audioStreamEnd"]);null!=i&&ew(t,["audioStreamEnd"],i);let o=eR(e,["video"]);null!=o&&ew(t,["video"],tt(o));let s=eR(e,["text"]);null!=s&&ew(t,["text"],s);let a=eR(e,["activityStart"]);null!=a&&ew(t,["activityStart"],a);let l=eR(e,["activityEnd"]);return null!=l&&ew(t,["activityEnd"],l),t}(e)}:{realtimeInput:function(e){let t={},n=eR(e,["media"]);if(null!=n){let e=e7(n);Array.isArray(e)&&(e=e.map(e=>t$(e))),ew(t,["mediaChunks"],e)}let r=eR(e,["audio"]);null!=r&&ew(t,["audio"],t$(tn(r)));let i=eR(e,["audioStreamEnd"]);null!=i&&ew(t,["audioStreamEnd"],i);let o=eR(e,["video"]);null!=o&&ew(t,["video"],t$(tt(o)));let s=eR(e,["text"]);null!=s&&ew(t,["text"],s);let a=eR(e,["activityStart"]);null!=a&&ew(t,["activityStart"],a);let l=eR(e,["activityEnd"]);return null!=l&&ew(t,["activityEnd"],l),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function np(e){var t,n,r;if(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.disable)return!0;let i=!1;for(let t of null!==(n=null==e?void 0:e.tools)&&void 0!==n?n:[])if(nh(t)){i=!0;break}if(!i)return!0;let o=null===(r=null==e?void 0:e.automaticFunctionCalling)||void 0===r?void 0:r.maximumRemoteCalls;return(!!o&&(o<0||!Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function nh(e){return"callTool"in e&&"function"==typeof e.callTool}function nf(e){var t;let n=[];return(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.tools)&&e.config.tools.forEach((e,t)=>{!nh(e)&&e.functionDeclarations&&e.functionDeclarations.length>0&&n.push(t)}),n}function ng(e){var t;return!(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.ignoreCallHistory)}class nm extends eO{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,r,i,o;let s,a;let l=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!function(e){var t,n,r;return null!==(r=null===(n=null===(t=e.config)||void 0===t?void 0:t.tools)||void 0===n?void 0:n.some(e=>nh(e)))&&void 0!==r&&r}(e)||np(e.config))return await this.generateContentInternal(l);let u=nf(e);if(u.length>0){let e=u.map(e=>`tools[${e}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let c=tc(l.contents),d=null!==(r=null===(n=null===(t=l.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==r?r:10,p=0;for(;p<d&&(s=await this.generateContentInternal(l)).functionCalls&&0!==s.functionCalls.length;){let t=s.candidates[0].content,n=[];for(let t of null!==(o=null===(i=e.config)||void 0===i?void 0:i.tools)&&void 0!==o?o:[])if(nh(t)){let e=await t.callTool(s.functionCalls);n.push(...e)}p++,a={role:"user",parts:n},l.contents=tc(l.contents),l.contents.push(t),l.contents.push(a),ng(l.config)&&(c.push(t),c.push(a))}return ng(l.config)&&(s.automaticFunctionCallingHistory=c),s},this.generateContentStream=async e=>{var t,n,r,i,o;if(this.maybeMoveToResponseJsonSchem(e),np(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let s=nf(e);if(s.length>0){let e=s.map(e=>`tools[${e}]`).join(", ");throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let a=null===(r=null===(n=null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.toolConfig)||void 0===n?void 0:n.functionCallingConfig)||void 0===r?void 0:r.streamFunctionCallArguments,l=null===(o=null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.automaticFunctionCalling)||void 0===o?void 0:o.disable;if(a&&!l)throw Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n;let r=[];if(null==e?void 0:e.generatedImages)for(let i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&(null===(t=null==i?void 0:i.safetyAttributes)||void 0===t?void 0:t.contentType)==="Positive Prompt"?n=null==i?void 0:i.safetyAttributes:r.push(i);return n?{generatedImages:r,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:r,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase){if(null===(t=n.config)||void 0===t?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");n.config.filter="labels.tune-type:*"}return new tk(ed.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,r,i,o,s;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null===(t=e.video)||void 0===t?void 0:t.uri)&&(null===(n=e.video)||void 0===n?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null===(i=null===(r=e.source)||void 0===r?void 0:r.video)||void 0===i?void 0:i.uri)&&(null===(s=null===(o=e.source)||void 0===o?void 0:o.video)||void 0===s?void 0:s.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,r;let i=null===(t=e.config)||void 0===t?void 0:t.tools;if(!i)return e;let o=await Promise.all(i.map(async e=>nh(e)?await e.tool():e)),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(s.config.tools=o,e.config&&e.config.tools&&nn(e.config.tools)){let t=Object.assign({},null!==(r=null===(n=e.config.httpOptions)||void 0===n?void 0:n.headers)&&void 0!==r?r:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),nr(t),s.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return s}async initAfcToolsMap(e){var t,n,r;let i=new Map;for(let o of null!==(n=null===(t=e.config)||void 0===t?void 0:t.tools)&&void 0!==n?n:[])if(nh(o))for(let e of null!==(r=(await o.tool()).functionDeclarations)&&void 0!==r?r:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,o)}return i}async processAfcStream(e){var t,n,r;let i=null!==(r=null===(n=null===(t=e.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==r?r:10,o=!1,s=0;return function(e,t,n){return tj(this,arguments,function*(){for(;s<i;){o&&(s++,o=!1);let g=yield tM(e.processParamsMaybeAddMcpUsage(n)),m=yield tM(e.generateContentStreamInternal(g)),y=[],v=[];try{for(var r,a,l,u,c,d,p,h=!0,f=(a=void 0,tL(m));!(r=(p=yield tM(f.next())).done);h=!0)if(u=p.value,h=!1,yield yield tM(u),u.candidates&&(null===(c=u.candidates[0])||void 0===c?void 0:c.content)){for(let e of(v.push(u.candidates[0].content),null!==(d=u.candidates[0].content.parts)&&void 0!==d?d:[]))if(s<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield tM(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){a={error:e}}finally{try{!h&&!r&&(l=f.return)&&(yield tM(l.call(f)))}finally{if(a)throw a.error}}if(y.length>0){o=!0;let e=new ex;e.candidates=[{content:{role:"user",parts:y}}],yield yield tM(e);let t=[];t.push(...v),t.push({role:"user",parts:y});let r=tc(n.contents).concat(t);n.contents=r}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=tz(this.apiClient,e);return o=eI("{model}:generateContent",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tY(e),n=new ex;return Object.assign(n,t),n})}{let t=tK(this.apiClient,e);return o=eI("{model}:generateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tW(e),n=new ex;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=tz(this.apiClient,e);return o=eI("{model}:streamGenerateContent?alt=sse",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(function(t){return tj(this,arguments,function*(){var n,r,i,o;try{for(var s,a=!0,l=tL(t);!(n=(s=yield tM(l.next())).done);a=!0){o=s.value,a=!1;let t=tY((yield tM(o.json())),e);t.sdkHttpResponse={headers:o.headers};let n=new ex;Object.assign(n,t),yield yield tM(n)}}catch(e){r={error:e}}finally{try{!a&&!n&&(i=l.return)&&(yield tM(i.call(l)))}finally{if(r)throw r.error}}})})}{let t=tK(this.apiClient,e);return o=eI("{model}:streamGenerateContent?alt=sse",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(function(t){return tj(this,arguments,function*(){var n,r,i,o;try{for(var s,a=!0,l=tL(t);!(n=(s=yield tM(l.next())).done);a=!0){o=s.value,a=!1;let t=tW((yield tM(o.json())),e);t.sdkHttpResponse={headers:o.headers};let n=new ex;Object.assign(n,t),yield yield tM(n)}}catch(e){r={error:e}}finally{try{!a&&!n&&(i=l.return)&&(yield tM(i.call(l)))}finally{if(r)throw r.error}}})})}}async embedContent(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["contents"]);if(null!=o){let t=tu(e,o);Array.isArray(t)&&(t=t.map(e=>e)),ew(r,["instances[]","content"],t)}let s=eR(t,["config"]);return null!=s&&function(e,t,n){let r=eR(e,["taskType"]);void 0!==t&&null!=r&&ew(t,["instances[]","task_type"],r);let i=eR(e,["title"]);void 0!==t&&null!=i&&ew(t,["instances[]","title"],i);let o=eR(e,["outputDimensionality"]);void 0!==t&&null!=o&&ew(t,["parameters","outputDimensionality"],o);let s=eR(e,["mimeType"]);void 0!==t&&null!=s&&ew(t,["instances[]","mimeType"],s);let a=eR(e,["autoTruncate"]);void 0!==t&&null!=a&&ew(t,["parameters","autoTruncate"],a)}(s,r),r}(this.apiClient,e);return o=eI("{model}:predict",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["predictions[]","embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["values"]);null!=r&&ew(n,["values"],r);let i=eR(e,["statistics"]);return null!=i&&ew(n,["statistics"],function(e,t){let n={},r=eR(e,["truncated"]);null!=r&&ew(n,["truncated"],r);let i=eR(e,["token_count"]);return null!=i&&ew(n,["tokenCount"],i),n}(i)),n})(e))),ew(n,["embeddings"],e)}let o=eR(e,["metadata"]);return null!=o&&ew(n,["metadata"],o),n}(e),n=new eU;return Object.assign(n,t),n})}{let t=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["contents"]);if(null!=o){let t=tu(e,o);Array.isArray(t)&&(t=t.map(e=>e)),ew(r,["requests[]","content"],t)}let s=eR(t,["config"]);null!=s&&function(e,t,n){let r=eR(e,["taskType"]);void 0!==t&&null!=r&&ew(t,["requests[]","taskType"],r);let i=eR(e,["title"]);void 0!==t&&null!=i&&ew(t,["requests[]","title"],i);let o=eR(e,["outputDimensionality"]);if(void 0!==t&&null!=o&&ew(t,["requests[]","outputDimensionality"],o),void 0!==eR(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==eR(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(s,r);let a=eR(t,["model"]);return void 0!==a&&ew(r,["requests[]","model"],e5(e,a)),r}(this.apiClient,e);return o=eI("{model}:batchEmbedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["embeddings"],e)}let o=eR(e,["metadata"]);return null!=o&&ew(n,["metadata"],o),n}(e),n=new eU;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["prompt"]);null!=o&&ew(r,["instances[0]","prompt"],o);let s=eR(t,["config"]);return null!=s&&function(e,t,n){let r=eR(e,["outputGcsUri"]);void 0!==t&&null!=r&&ew(t,["parameters","storageUri"],r);let i=eR(e,["negativePrompt"]);void 0!==t&&null!=i&&ew(t,["parameters","negativePrompt"],i);let o=eR(e,["numberOfImages"]);void 0!==t&&null!=o&&ew(t,["parameters","sampleCount"],o);let s=eR(e,["aspectRatio"]);void 0!==t&&null!=s&&ew(t,["parameters","aspectRatio"],s);let a=eR(e,["guidanceScale"]);void 0!==t&&null!=a&&ew(t,["parameters","guidanceScale"],a);let l=eR(e,["seed"]);void 0!==t&&null!=l&&ew(t,["parameters","seed"],l);let u=eR(e,["safetyFilterLevel"]);void 0!==t&&null!=u&&ew(t,["parameters","safetySetting"],u);let c=eR(e,["personGeneration"]);void 0!==t&&null!=c&&ew(t,["parameters","personGeneration"],c);let d=eR(e,["includeSafetyAttributes"]);void 0!==t&&null!=d&&ew(t,["parameters","includeSafetyAttributes"],d);let p=eR(e,["includeRaiReason"]);void 0!==t&&null!=p&&ew(t,["parameters","includeRaiReason"],p);let h=eR(e,["language"]);void 0!==t&&null!=h&&ew(t,["parameters","language"],h);let f=eR(e,["outputMimeType"]);void 0!==t&&null!=f&&ew(t,["parameters","outputOptions","mimeType"],f);let g=eR(e,["outputCompressionQuality"]);void 0!==t&&null!=g&&ew(t,["parameters","outputOptions","compressionQuality"],g);let m=eR(e,["addWatermark"]);void 0!==t&&null!=m&&ew(t,["parameters","addWatermark"],m);let y=eR(e,["labels"]);void 0!==t&&null!=y&&ew(t,["labels"],y);let v=eR(e,["imageSize"]);void 0!==t&&null!=v&&ew(t,["parameters","sampleImageSize"],v);let E=eR(e,["enhancePrompt"]);void 0!==t&&null!=E&&ew(t,["parameters","enhancePrompt"],E)}(s,r),r}(this.apiClient,e);return o=eI("{model}:predict",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tX(e))),ew(n,["generatedImages"],e)}let o=eR(e,["positivePromptSafetyAttributes"]);return null!=o&&ew(n,["positivePromptSafetyAttributes"],t3(o)),n}(e),n=new eD;return Object.assign(n,t),n})}{let t=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["prompt"]);null!=o&&ew(r,["instances[0]","prompt"],o);let s=eR(t,["config"]);return null!=s&&function(e,t,n){if(void 0!==eR(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==eR(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let r=eR(e,["numberOfImages"]);void 0!==t&&null!=r&&ew(t,["parameters","sampleCount"],r);let i=eR(e,["aspectRatio"]);void 0!==t&&null!=i&&ew(t,["parameters","aspectRatio"],i);let o=eR(e,["guidanceScale"]);if(void 0!==t&&null!=o&&ew(t,["parameters","guidanceScale"],o),void 0!==eR(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let s=eR(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&ew(t,["parameters","safetySetting"],s);let a=eR(e,["personGeneration"]);void 0!==t&&null!=a&&ew(t,["parameters","personGeneration"],a);let l=eR(e,["includeSafetyAttributes"]);void 0!==t&&null!=l&&ew(t,["parameters","includeSafetyAttributes"],l);let u=eR(e,["includeRaiReason"]);void 0!==t&&null!=u&&ew(t,["parameters","includeRaiReason"],u);let c=eR(e,["language"]);void 0!==t&&null!=c&&ew(t,["parameters","language"],c);let d=eR(e,["outputMimeType"]);void 0!==t&&null!=d&&ew(t,["parameters","outputOptions","mimeType"],d);let p=eR(e,["outputCompressionQuality"]);if(void 0!==t&&null!=p&&ew(t,["parameters","outputOptions","compressionQuality"],p),void 0!==eR(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==eR(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let h=eR(e,["imageSize"]);if(void 0!==t&&null!=h&&ew(t,["parameters","sampleImageSize"],h),void 0!==eR(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(s,r),r}(this.apiClient,e);return o=eI("{model}:predict",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["_self"]);null!=r&&ew(n,["image"],function(e,t){let n={},r=eR(e,["bytesBase64Encoded"]);null!=r&&ew(n,["imageBytes"],eN(r));let i=eR(e,["mimeType"]);return null!=i&&ew(n,["mimeType"],i),n}(r));let i=eR(e,["raiFilteredReason"]);null!=i&&ew(n,["raiFilteredReason"],i);let o=eR(e,["_self"]);return null!=o&&ew(n,["safetyAttributes"],t4(o)),n})(e))),ew(n,["generatedImages"],e)}let o=eR(e,["positivePromptSafetyAttributes"]);return null!=o&&ew(n,["positivePromptSafetyAttributes"],t4(o)),n}(e),n=new eD;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["prompt"]);null!=o&&ew(r,["instances[0]","prompt"],o);let s=eR(t,["referenceImages"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["referenceImage"]);null!=r&&ew(n,["referenceImage"],t0(r));let i=eR(e,["referenceId"]);null!=i&&ew(n,["referenceId"],i);let o=eR(e,["referenceType"]);null!=o&&ew(n,["referenceType"],o);let s=eR(e,["maskImageConfig"]);null!=s&&ew(n,["maskImageConfig"],function(e,t){let n={},r=eR(e,["maskMode"]);null!=r&&ew(n,["maskMode"],r);let i=eR(e,["segmentationClasses"]);null!=i&&ew(n,["maskClasses"],i);let o=eR(e,["maskDilation"]);return null!=o&&ew(n,["dilation"],o),n}(s));let a=eR(e,["controlImageConfig"]);null!=a&&ew(n,["controlImageConfig"],function(e,t){let n={},r=eR(e,["controlType"]);null!=r&&ew(n,["controlType"],r);let i=eR(e,["enableControlImageComputation"]);return null!=i&&ew(n,["computeControl"],i),n}(a));let l=eR(e,["styleImageConfig"]);null!=l&&ew(n,["styleImageConfig"],l);let u=eR(e,["subjectImageConfig"]);return null!=u&&ew(n,["subjectImageConfig"],u),n})(e))),ew(r,["instances[0]","referenceImages"],e)}let a=eR(t,["config"]);return null!=a&&function(e,t,n){let r=eR(e,["outputGcsUri"]);void 0!==t&&null!=r&&ew(t,["parameters","storageUri"],r);let i=eR(e,["negativePrompt"]);void 0!==t&&null!=i&&ew(t,["parameters","negativePrompt"],i);let o=eR(e,["numberOfImages"]);void 0!==t&&null!=o&&ew(t,["parameters","sampleCount"],o);let s=eR(e,["aspectRatio"]);void 0!==t&&null!=s&&ew(t,["parameters","aspectRatio"],s);let a=eR(e,["guidanceScale"]);void 0!==t&&null!=a&&ew(t,["parameters","guidanceScale"],a);let l=eR(e,["seed"]);void 0!==t&&null!=l&&ew(t,["parameters","seed"],l);let u=eR(e,["safetyFilterLevel"]);void 0!==t&&null!=u&&ew(t,["parameters","safetySetting"],u);let c=eR(e,["personGeneration"]);void 0!==t&&null!=c&&ew(t,["parameters","personGeneration"],c);let d=eR(e,["includeSafetyAttributes"]);void 0!==t&&null!=d&&ew(t,["parameters","includeSafetyAttributes"],d);let p=eR(e,["includeRaiReason"]);void 0!==t&&null!=p&&ew(t,["parameters","includeRaiReason"],p);let h=eR(e,["language"]);void 0!==t&&null!=h&&ew(t,["parameters","language"],h);let f=eR(e,["outputMimeType"]);void 0!==t&&null!=f&&ew(t,["parameters","outputOptions","mimeType"],f);let g=eR(e,["outputCompressionQuality"]);void 0!==t&&null!=g&&ew(t,["parameters","outputOptions","compressionQuality"],g);let m=eR(e,["addWatermark"]);void 0!==t&&null!=m&&ew(t,["parameters","addWatermark"],m);let y=eR(e,["labels"]);void 0!==t&&null!=y&&ew(t,["labels"],y);let v=eR(e,["editMode"]);void 0!==t&&null!=v&&ew(t,["parameters","editMode"],v);let E=eR(e,["baseSteps"]);void 0!==t&&null!=E&&ew(t,["parameters","editConfig","baseSteps"],E)}(a,r),r}(this.apiClient,e);return r=eI("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tX(e))),ew(n,["generatedImages"],e)}return n}(e),n=new eM;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["image"]);null!=o&&ew(r,["instances[0]","image"],t0(o));let s=eR(t,["upscaleFactor"]);null!=s&&ew(r,["parameters","upscaleConfig","upscaleFactor"],s);let a=eR(t,["config"]);return null!=a&&function(e,t,n){let r=eR(e,["outputGcsUri"]);void 0!==t&&null!=r&&ew(t,["parameters","storageUri"],r);let i=eR(e,["safetyFilterLevel"]);void 0!==t&&null!=i&&ew(t,["parameters","safetySetting"],i);let o=eR(e,["personGeneration"]);void 0!==t&&null!=o&&ew(t,["parameters","personGeneration"],o);let s=eR(e,["includeRaiReason"]);void 0!==t&&null!=s&&ew(t,["parameters","includeRaiReason"],s);let a=eR(e,["outputMimeType"]);void 0!==t&&null!=a&&ew(t,["parameters","outputOptions","mimeType"],a);let l=eR(e,["outputCompressionQuality"]);void 0!==t&&null!=l&&ew(t,["parameters","outputOptions","compressionQuality"],l);let u=eR(e,["enhanceInputImage"]);void 0!==t&&null!=u&&ew(t,["parameters","upscaleConfig","enhanceInputImage"],u);let c=eR(e,["imagePreservationFactor"]);void 0!==t&&null!=c&&ew(t,["parameters","upscaleConfig","imagePreservationFactor"],c);let d=eR(e,["labels"]);void 0!==t&&null!=d&&ew(t,["labels"],d);let p=eR(e,["numberOfImages"]);void 0!==t&&null!=p&&ew(t,["parameters","sampleCount"],p);let h=eR(e,["mode"]);void 0!==t&&null!=h&&ew(t,["parameters","mode"],h)}(a,r),r}(this.apiClient,e);return r=eI("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tX(e))),ew(n,["generatedImages"],e)}return n}(e),n=new ej;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["source"]);null!=o&&function(e,t,n){let r=eR(e,["prompt"]);void 0!==t&&null!=r&&ew(t,["instances[0]","prompt"],r);let i=eR(e,["personImage"]);void 0!==t&&null!=i&&ew(t,["instances[0]","personImage","image"],t0(i));let o=eR(e,["productImages"]);if(void 0!==t&&null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["productImage"]);return null!=r&&ew(n,["image"],t0(r)),n})(e))),ew(t,["instances[0]","productImages"],e)}}(o,r);let s=eR(t,["config"]);return null!=s&&function(e,t,n){let r=eR(e,["numberOfImages"]);void 0!==t&&null!=r&&ew(t,["parameters","sampleCount"],r);let i=eR(e,["baseSteps"]);void 0!==t&&null!=i&&ew(t,["parameters","baseSteps"],i);let o=eR(e,["outputGcsUri"]);void 0!==t&&null!=o&&ew(t,["parameters","storageUri"],o);let s=eR(e,["seed"]);void 0!==t&&null!=s&&ew(t,["parameters","seed"],s);let a=eR(e,["safetyFilterLevel"]);void 0!==t&&null!=a&&ew(t,["parameters","safetySetting"],a);let l=eR(e,["personGeneration"]);void 0!==t&&null!=l&&ew(t,["parameters","personGeneration"],l);let u=eR(e,["addWatermark"]);void 0!==t&&null!=u&&ew(t,["parameters","addWatermark"],u);let c=eR(e,["outputMimeType"]);void 0!==t&&null!=c&&ew(t,["parameters","outputOptions","mimeType"],c);let d=eR(e,["outputCompressionQuality"]);void 0!==t&&null!=d&&ew(t,["parameters","outputOptions","compressionQuality"],d);let p=eR(e,["enhancePrompt"]);void 0!==t&&null!=p&&ew(t,["parameters","enhancePrompt"],p);let h=eR(e,["labels"]);void 0!==t&&null!=h&&ew(t,["labels"],h)}(s,r),r}(this.apiClient,e);return r=eI("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=eR(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tX(e))),ew(n,["generatedImages"],e)}return n}(e),n=new eL;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["source"]);null!=o&&function(e,t,n){let r=eR(e,["prompt"]);void 0!==t&&null!=r&&ew(t,["instances[0]","prompt"],r);let i=eR(e,["image"]);void 0!==t&&null!=i&&ew(t,["instances[0]","image"],t0(i));let o=eR(e,["scribbleImage"]);void 0!==t&&null!=o&&ew(t,["instances[0]","scribble"],function(e,t){let n={},r=eR(e,["image"]);return null!=r&&ew(n,["image"],t0(r)),n}(o))}(o,r);let s=eR(t,["config"]);return null!=s&&function(e,t,n){let r=eR(e,["mode"]);void 0!==t&&null!=r&&ew(t,["parameters","mode"],r);let i=eR(e,["maxPredictions"]);void 0!==t&&null!=i&&ew(t,["parameters","maxPredictions"],i);let o=eR(e,["confidenceThreshold"]);void 0!==t&&null!=o&&ew(t,["parameters","confidenceThreshold"],o);let s=eR(e,["maskDilation"]);void 0!==t&&null!=s&&ew(t,["parameters","maskDilation"],s);let a=eR(e,["binaryColorThreshold"]);void 0!==t&&null!=a&&ew(t,["parameters","binaryColorThreshold"],a);let l=eR(e,["labels"]);void 0!==t&&null!=l&&ew(t,["labels"],l)}(s,r),r}(this.apiClient,e);return r=eI("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=eR(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["_self"]);null!=r&&ew(n,["mask"],tQ(r));let i=eR(e,["labels"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["labels"],e)}return n})(e))),ew(n,["generatedMasks"],e)}return n}(e),n=new eG;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["model"]);return null!=i&&ew(r,["_url","name"],e5(e,i)),r}(this.apiClient,e);return o=eI("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>t2(e))}{let t=function(e,t,n){let r={},i=eR(t,["model"]);return null!=i&&ew(r,["_url","name"],e5(e,i)),r}(this.apiClient,e);return o=eI("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>t1(e))}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["config"]);return null!=i&&function(e,t,n,r){let i=eR(t,["pageSize"]);void 0!==n&&null!=i&&ew(n,["_query","pageSize"],i);let o=eR(t,["pageToken"]);void 0!==n&&null!=o&&ew(n,["_query","pageToken"],o);let s=eR(t,["filter"]);void 0!==n&&null!=s&&ew(n,["_query","filter"],s);let a=eR(t,["queryBase"]);void 0!==n&&null!=a&&ew(n,["_url","models_url"],tA(e,a))}(e,i,r),r}(this.apiClient,e);return o=eI("{models_url}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["nextPageToken"]);null!=i&&ew(n,["nextPageToken"],i);let o=eR(e,["_self"]);if(null!=o){let e=tT(o);Array.isArray(e)&&(e=e.map(e=>t2(e))),ew(n,["models"],e)}return n}(e),n=new eF;return Object.assign(n,t),n})}{let t=function(e,t,n){let r={},i=eR(t,["config"]);return null!=i&&function(e,t,n,r){let i=eR(t,["pageSize"]);void 0!==n&&null!=i&&ew(n,["_query","pageSize"],i);let o=eR(t,["pageToken"]);void 0!==n&&null!=o&&ew(n,["_query","pageToken"],o);let s=eR(t,["filter"]);void 0!==n&&null!=s&&ew(n,["_query","filter"],s);let a=eR(t,["queryBase"]);void 0!==n&&null!=a&&ew(n,["_url","models_url"],tA(e,a))}(e,i,r),r}(this.apiClient,e);return o=eI("{models_url}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["nextPageToken"]);null!=i&&ew(n,["nextPageToken"],i);let o=eR(e,["_self"]);if(null!=o){let e=tT(o);Array.isArray(e)&&(e=e.map(e=>t1(e))),ew(n,["models"],e)}return n}(e),n=new eF;return Object.assign(n,t),n})}}async update(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["config"]);return null!=o&&function(e,t,n){let r=eR(e,["displayName"]);void 0!==t&&null!=r&&ew(t,["displayName"],r);let i=eR(e,["description"]);void 0!==t&&null!=i&&ew(t,["description"],i);let o=eR(e,["defaultCheckpointId"]);void 0!==t&&null!=o&&ew(t,["defaultCheckpointId"],o)}(o,r),r}(this.apiClient,e);return o=eI("{model}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>t2(e))}{let t=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","name"],e5(e,i));let o=eR(t,["config"]);return null!=o&&function(e,t,n){let r=eR(e,["displayName"]);void 0!==t&&null!=r&&ew(t,["displayName"],r);let i=eR(e,["description"]);void 0!==t&&null!=i&&ew(t,["description"],i);let o=eR(e,["defaultCheckpointId"]);void 0!==t&&null!=o&&ew(t,["defaultCheckpointId"],o)}(o,r),r}(this.apiClient,e);return o=eI("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>t1(e))}}async delete(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["model"]);return null!=i&&ew(r,["_url","name"],e5(e,i)),r}(this.apiClient,e);return o=eI("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);return null!=r&&ew(n,["sdkHttpResponse"],r),n}(e),n=new eq;return Object.assign(n,t),n})}{let t=function(e,t,n){let r={},i=eR(t,["model"]);return null!=i&&ew(r,["_url","name"],e5(e,i)),r}(this.apiClient,e);return o=eI("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);return null!=r&&ew(n,["sdkHttpResponse"],r),n}(e),n=new eq;return Object.assign(n,t),n})}}async countTokens(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["contents"]);if(null!=o){let e=tc(o);Array.isArray(e)&&(e=e.map(e=>e)),ew(r,["contents"],e)}let s=eR(t,["config"]);return null!=s&&function(e,t,n){let r=eR(e,["systemInstruction"]);void 0!==t&&null!=r&&ew(t,["systemInstruction"],tl(r));let i=eR(e,["tools"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>t6(e))),ew(t,["tools"],e)}let o=eR(e,["generationConfig"]);void 0!==t&&null!=o&&ew(t,["generationConfig"],function(e,t){let n={},r=eR(e,["modelSelectionConfig"]);null!=r&&ew(n,["modelConfig"],r);let i=eR(e,["responseJsonSchema"]);null!=i&&ew(n,["responseJsonSchema"],i);let o=eR(e,["audioTimestamp"]);null!=o&&ew(n,["audioTimestamp"],o);let s=eR(e,["candidateCount"]);null!=s&&ew(n,["candidateCount"],s);let a=eR(e,["enableAffectiveDialog"]);null!=a&&ew(n,["enableAffectiveDialog"],a);let l=eR(e,["frequencyPenalty"]);null!=l&&ew(n,["frequencyPenalty"],l);let u=eR(e,["logprobs"]);null!=u&&ew(n,["logprobs"],u);let c=eR(e,["maxOutputTokens"]);null!=c&&ew(n,["maxOutputTokens"],c);let d=eR(e,["mediaResolution"]);null!=d&&ew(n,["mediaResolution"],d);let p=eR(e,["presencePenalty"]);null!=p&&ew(n,["presencePenalty"],p);let h=eR(e,["responseLogprobs"]);null!=h&&ew(n,["responseLogprobs"],h);let f=eR(e,["responseMimeType"]);null!=f&&ew(n,["responseMimeType"],f);let g=eR(e,["responseModalities"]);null!=g&&ew(n,["responseModalities"],g);let m=eR(e,["responseSchema"]);null!=m&&ew(n,["responseSchema"],m);let y=eR(e,["routingConfig"]);null!=y&&ew(n,["routingConfig"],y);let v=eR(e,["seed"]);null!=v&&ew(n,["seed"],v);let E=eR(e,["speechConfig"]);null!=E&&ew(n,["speechConfig"],E);let _=eR(e,["stopSequences"]);null!=_&&ew(n,["stopSequences"],_);let A=eR(e,["temperature"]);null!=A&&ew(n,["temperature"],A);let T=eR(e,["thinkingConfig"]);null!=T&&ew(n,["thinkingConfig"],T);let S=eR(e,["topK"]);null!=S&&ew(n,["topK"],S);let b=eR(e,["topP"]);if(null!=b&&ew(n,["topP"],b),void 0!==eR(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}(o))}(s,r),r}(this.apiClient,e);return o=eI("{model}:countTokens",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["totalTokens"]);return null!=i&&ew(n,["totalTokens"],i),n}(e),n=new eH;return Object.assign(n,t),n})}{let t=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["contents"]);if(null!=o){let e=tc(o);Array.isArray(e)&&(e=e.map(e=>tJ(e))),ew(r,["contents"],e)}let s=eR(t,["config"]);return null!=s&&function(e,t){if(void 0!==eR(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==eR(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==eR(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(s),r}(this.apiClient,e);return o=eI("{model}:countTokens",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["totalTokens"]);null!=i&&ew(n,["totalTokens"],i);let o=eR(e,["cachedContentTokenCount"]);return null!=o&&ew(n,["cachedContentTokenCount"],o),n}(e),n=new eH;return Object.assign(n,t),n})}}async computeTokens(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["contents"]);if(null!=o){let e=tc(o);Array.isArray(e)&&(e=e.map(e=>e)),ew(r,["contents"],e)}return r}(this.apiClient,e);return r=eI("{model}:computeTokens",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["tokensInfo"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(n,["tokensInfo"],e)}return n}(e),n=new eB;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["prompt"]);null!=o&&ew(r,["instances[0]","prompt"],o);let s=eR(t,["image"]);null!=s&&ew(r,["instances[0]","image"],t0(s));let a=eR(t,["video"]);null!=a&&ew(r,["instances[0]","video"],t5(a));let l=eR(t,["source"]);null!=l&&function(e,t,n){let r=eR(e,["prompt"]);void 0!==t&&null!=r&&ew(t,["instances[0]","prompt"],r);let i=eR(e,["image"]);void 0!==t&&null!=i&&ew(t,["instances[0]","image"],t0(i));let o=eR(e,["video"]);void 0!==t&&null!=o&&ew(t,["instances[0]","video"],t5(o))}(l,r);let u=eR(t,["config"]);return null!=u&&function(e,t,n){let r=eR(e,["numberOfVideos"]);void 0!==t&&null!=r&&ew(t,["parameters","sampleCount"],r);let i=eR(e,["outputGcsUri"]);void 0!==t&&null!=i&&ew(t,["parameters","storageUri"],i);let o=eR(e,["fps"]);void 0!==t&&null!=o&&ew(t,["parameters","fps"],o);let s=eR(e,["durationSeconds"]);void 0!==t&&null!=s&&ew(t,["parameters","durationSeconds"],s);let a=eR(e,["seed"]);void 0!==t&&null!=a&&ew(t,["parameters","seed"],a);let l=eR(e,["aspectRatio"]);void 0!==t&&null!=l&&ew(t,["parameters","aspectRatio"],l);let u=eR(e,["resolution"]);void 0!==t&&null!=u&&ew(t,["parameters","resolution"],u);let c=eR(e,["personGeneration"]);void 0!==t&&null!=c&&ew(t,["parameters","personGeneration"],c);let d=eR(e,["pubsubTopic"]);void 0!==t&&null!=d&&ew(t,["parameters","pubsubTopic"],d);let p=eR(e,["negativePrompt"]);void 0!==t&&null!=p&&ew(t,["parameters","negativePrompt"],p);let h=eR(e,["enhancePrompt"]);void 0!==t&&null!=h&&ew(t,["parameters","enhancePrompt"],h);let f=eR(e,["generateAudio"]);void 0!==t&&null!=f&&ew(t,["parameters","generateAudio"],f);let g=eR(e,["lastFrame"]);void 0!==t&&null!=g&&ew(t,["instances[0]","lastFrame"],t0(g));let m=eR(e,["referenceImages"]);if(void 0!==t&&null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["image"]);null!=r&&ew(n,["image"],t0(r));let i=eR(e,["referenceType"]);return null!=i&&ew(n,["referenceType"],i),n})(e))),ew(t,["instances[0]","referenceImages"],e)}let y=eR(e,["mask"]);void 0!==t&&null!=y&&ew(t,["instances[0]","mask"],function(e,t){let n={},r=eR(e,["image"]);null!=r&&ew(n,["_self"],t0(r));let i=eR(e,["maskMode"]);return null!=i&&ew(n,["maskMode"],i),n}(y));let v=eR(e,["compressionQuality"]);void 0!==t&&null!=v&&ew(t,["parameters","compressionQuality"],v)}(u,r),r}(this.apiClient,e);return o=eI("{model}:predictLongRunning",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=eR(e,["name"]);null!=r&&ew(n,["name"],r);let i=eR(e,["metadata"]);null!=i&&ew(n,["metadata"],i);let o=eR(e,["done"]);null!=o&&ew(n,["done"],o);let s=eR(e,["error"]);null!=s&&ew(n,["error"],s);let a=eR(e,["response"]);return null!=a&&ew(n,["response"],function(e,t){let n={},r=eR(e,["videos"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["_self"]);return null!=r&&ew(n,["video"],function(e,t){let n={},r=eR(e,["gcsUri"]);null!=r&&ew(n,["uri"],r);let i=eR(e,["bytesBase64Encoded"]);null!=i&&ew(n,["videoBytes"],eN(i));let o=eR(e,["mimeType"]);return null!=o&&ew(n,["mimeType"],o),n}(r)),n})(e))),ew(n,["generatedVideos"],e)}let i=eR(e,["raiMediaFilteredCount"]);null!=i&&ew(n,["raiMediaFilteredCount"],i);let o=eR(e,["raiMediaFilteredReasons"]);return null!=o&&ew(n,["raiMediaFilteredReasons"],o),n}(a)),n}(e),n=new eV;return Object.assign(n,t),n})}{let t=function(e,t,n){let r={},i=eR(t,["model"]);null!=i&&ew(r,["_url","model"],e5(e,i));let o=eR(t,["prompt"]);null!=o&&ew(r,["instances[0]","prompt"],o);let s=eR(t,["image"]);null!=s&&ew(r,["instances[0]","image"],tZ(s));let a=eR(t,["video"]);null!=a&&ew(r,["instances[0]","video"],t9(a));let l=eR(t,["source"]);null!=l&&function(e,t,n){let r=eR(e,["prompt"]);void 0!==t&&null!=r&&ew(t,["instances[0]","prompt"],r);let i=eR(e,["image"]);void 0!==t&&null!=i&&ew(t,["instances[0]","image"],tZ(i));let o=eR(e,["video"]);void 0!==t&&null!=o&&ew(t,["instances[0]","video"],t9(o))}(l,r);let u=eR(t,["config"]);return null!=u&&function(e,t,n){let r=eR(e,["numberOfVideos"]);if(void 0!==t&&null!=r&&ew(t,["parameters","sampleCount"],r),void 0!==eR(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==eR(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let i=eR(e,["durationSeconds"]);if(void 0!==t&&null!=i&&ew(t,["parameters","durationSeconds"],i),void 0!==eR(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=eR(e,["aspectRatio"]);void 0!==t&&null!=o&&ew(t,["parameters","aspectRatio"],o);let s=eR(e,["resolution"]);void 0!==t&&null!=s&&ew(t,["parameters","resolution"],s);let a=eR(e,["personGeneration"]);if(void 0!==t&&null!=a&&ew(t,["parameters","personGeneration"],a),void 0!==eR(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let l=eR(e,["negativePrompt"]);void 0!==t&&null!=l&&ew(t,["parameters","negativePrompt"],l);let u=eR(e,["enhancePrompt"]);if(void 0!==t&&null!=u&&ew(t,["parameters","enhancePrompt"],u),void 0!==eR(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let c=eR(e,["lastFrame"]);void 0!==t&&null!=c&&ew(t,["instances[0]","lastFrame"],tZ(c));let d=eR(e,["referenceImages"]);if(void 0!==t&&null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["image"]);null!=r&&ew(n,["image"],tZ(r));let i=eR(e,["referenceType"]);return null!=i&&ew(n,["referenceType"],i),n})(e))),ew(t,["instances[0]","referenceImages"],e)}if(void 0!==eR(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==eR(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(u,r),r}(this.apiClient,e);return o=eI("{model}:predictLongRunning",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=eR(e,["name"]);null!=r&&ew(n,["name"],r);let i=eR(e,["metadata"]);null!=i&&ew(n,["metadata"],i);let o=eR(e,["done"]);null!=o&&ew(n,["done"],o);let s=eR(e,["error"]);null!=s&&ew(n,["error"],s);let a=eR(e,["response","generateVideoResponse"]);return null!=a&&ew(n,["response"],function(e,t){let n={},r=eR(e,["generatedSamples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=eR(e,["video"]);return null!=r&&ew(n,["video"],function(e,t){let n={},r=eR(e,["uri"]);null!=r&&ew(n,["uri"],r);let i=eR(e,["encodedVideo"]);null!=i&&ew(n,["videoBytes"],eN(i));let o=eR(e,["encoding"]);return null!=o&&ew(n,["mimeType"],o),n}(r)),n})(e))),ew(n,["generatedVideos"],e)}let i=eR(e,["raiMediaFilteredCount"]);null!=i&&ew(n,["raiMediaFilteredCount"],i);let o=eR(e,["raiMediaFilteredReasons"]);return null!=o&&ew(n,["raiMediaFilteredReasons"],o),n}(a)),n}(e),n=new eV;return Object.assign(n,t),n})}}}class ny extends eO{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e){let t={},n=eR(e,["operationName"]);return null!=n&&ew(t,["_url","operationName"],n),t}(e);return o=eI("{operationName}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json())}{let t=function(e){let t={},n=eR(e,["operationName"]);return null!=n&&ew(t,["_url","operationName"],n),t}(e);return o=eI("{operationName}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e){let t={},n=eR(e,["operationName"]);null!=n&&ew(t,["operationName"],n);let r=eR(e,["resourceName"]);return null!=r&&ew(t,["_url","resourceName"],r),t}(e);return r=eI("{resourceName}:fetchPredictOperation",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class nv extends eO{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let o=function(e,t){let n={},r=eR(t,["config"]);return null!=r&&ew(n,["config"],function(e,t,n){let r=eR(t,["expireTime"]);void 0!==n&&null!=r&&ew(n,["expireTime"],r);let i=eR(t,["newSessionExpireTime"]);void 0!==n&&null!=i&&ew(n,["newSessionExpireTime"],i);let o=eR(t,["uses"]);void 0!==n&&null!=o&&ew(n,["uses"],o);let s=eR(t,["liveConnectConstraints"]);void 0!==n&&null!=s&&ew(n,["bidiGenerateContentSetup"],function(e,t){let n={},r=eR(t,["model"]);null!=r&&ew(n,["setup","model"],e5(e,r));let i=eR(t,["config"]);return null!=i&&ew(n,["config"],function(e,t){let n=eR(e,["generationConfig"]);void 0!==t&&null!=n&&ew(t,["setup","generationConfig"],n);let r=eR(e,["responseModalities"]);void 0!==t&&null!=r&&ew(t,["setup","generationConfig","responseModalities"],r);let i=eR(e,["temperature"]);void 0!==t&&null!=i&&ew(t,["setup","generationConfig","temperature"],i);let o=eR(e,["topP"]);void 0!==t&&null!=o&&ew(t,["setup","generationConfig","topP"],o);let s=eR(e,["topK"]);void 0!==t&&null!=s&&ew(t,["setup","generationConfig","topK"],s);let a=eR(e,["maxOutputTokens"]);void 0!==t&&null!=a&&ew(t,["setup","generationConfig","maxOutputTokens"],a);let l=eR(e,["mediaResolution"]);void 0!==t&&null!=l&&ew(t,["setup","generationConfig","mediaResolution"],l);let u=eR(e,["seed"]);void 0!==t&&null!=u&&ew(t,["setup","generationConfig","seed"],u);let c=eR(e,["speechConfig"]);void 0!==t&&null!=c&&ew(t,["setup","generationConfig","speechConfig"],th(c));let d=eR(e,["thinkingConfig"]);void 0!==t&&null!=d&&ew(t,["setup","generationConfig","thinkingConfig"],d);let p=eR(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&ew(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=eR(e,["systemInstruction"]);void 0!==t&&null!=h&&ew(t,["setup","systemInstruction"],function(e){let t={},n=eR(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eR(e,["mediaResolution"]);null!=n&&ew(t,["mediaResolution"],n);let r=eR(e,["codeExecutionResult"]);null!=r&&ew(t,["codeExecutionResult"],r);let i=eR(e,["executableCode"]);null!=i&&ew(t,["executableCode"],i);let o=eR(e,["fileData"]);null!=o&&ew(t,["fileData"],function(e){let t={};if(void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eR(e,["fileUri"]);null!=n&&ew(t,["fileUri"],n);let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}(o));let s=eR(e,["functionCall"]);null!=s&&ew(t,["functionCall"],function(e){let t={},n=eR(e,["id"]);null!=n&&ew(t,["id"],n);let r=eR(e,["args"]);null!=r&&ew(t,["args"],r);let i=eR(e,["name"]);if(null!=i&&ew(t,["name"],i),void 0!==eR(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==eR(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=eR(e,["functionResponse"]);null!=a&&ew(t,["functionResponse"],a);let l=eR(e,["inlineData"]);null!=l&&ew(t,["inlineData"],function(e){let t={},n=eR(e,["data"]);if(null!=n&&ew(t,["data"],n),void 0!==eR(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eR(e,["mimeType"]);return null!=r&&ew(t,["mimeType"],r),t}(l));let u=eR(e,["text"]);null!=u&&ew(t,["text"],u);let c=eR(e,["thought"]);null!=c&&ew(t,["thought"],c);let d=eR(e,["thoughtSignature"]);null!=d&&ew(t,["thoughtSignature"],d);let p=eR(e,["videoMetadata"]);return null!=p&&ew(t,["videoMetadata"],p),t})(e))),ew(t,["parts"],e)}let r=eR(e,["role"]);return null!=r&&ew(t,["role"],r),t}(tl(h)));let f=eR(e,["tools"]);if(void 0!==t&&null!=f){let e=tg(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==eR(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=eR(e,["computerUse"]);null!=n&&ew(t,["computerUse"],n);let r=eR(e,["fileSearch"]);null!=r&&ew(t,["fileSearch"],r);let i=eR(e,["codeExecution"]);if(null!=i&&ew(t,["codeExecution"],i),void 0!==eR(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=eR(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["functionDeclarations"],e)}let s=eR(e,["googleMaps"]);null!=s&&ew(t,["googleMaps"],function(e){let t={};if(void 0!==eR(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eR(e,["enableWidget"]);return null!=n&&ew(t,["enableWidget"],n),t}(s));let a=eR(e,["googleSearch"]);null!=a&&ew(t,["googleSearch"],function(e){let t={};if(void 0!==eR(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eR(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eR(e,["timeRangeFilter"]);return null!=n&&ew(t,["timeRangeFilter"],n),t}(a));let l=eR(e,["googleSearchRetrieval"]);null!=l&&ew(t,["googleSearchRetrieval"],l);let u=eR(e,["urlContext"]);return null!=u&&ew(t,["urlContext"],u),t})(tf(e)))),ew(t,["setup","tools"],e)}let g=eR(e,["sessionResumption"]);void 0!==t&&null!=g&&ew(t,["setup","sessionResumption"],function(e){let t={},n=eR(e,["handle"]);if(null!=n&&ew(t,["handle"],n),void 0!==eR(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(g));let m=eR(e,["inputAudioTranscription"]);void 0!==t&&null!=m&&ew(t,["setup","inputAudioTranscription"],m);let y=eR(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&ew(t,["setup","outputAudioTranscription"],y);let v=eR(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&ew(t,["setup","realtimeInputConfig"],v);let E=eR(e,["contextWindowCompression"]);void 0!==t&&null!=E&&ew(t,["setup","contextWindowCompression"],E);let _=eR(e,["proactivity"]);if(void 0!==t&&null!=_&&ew(t,["setup","proactivity"],_),void 0!==eR(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(i,n)),n}(e,s));let a=eR(t,["lockAdditionalFields"]);return void 0!==n&&null!=a&&ew(n,["fieldMask"],a),{}}(e,r,n)),n}(this.apiClient,e);r=eI("auth_tokens",o._url),i=o._query,delete o.config,delete o._url,delete o._query;let s=function(e,t){let n=null,r=e.bidiGenerateContentSetup;if("object"==typeof r&&null!==r&&"setup"in r){let t=r.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==r&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(n){let r=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];if("object"==typeof r&&null!=r&&Object.keys(r).length>0){let e=Object.keys(r).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)r?e.fieldMask=r:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];i.length>0&&(n=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let o=[];r&&o.push(r),n.length>0&&o.push(...n),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(o,e.config);return this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}class nE extends eO{constructor(e){super(),this.apiClient=e,this.list=async e=>new tk(ed.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["name"]);return null!=n&&ew(t,["_url","name"],n),t}(e);return r=eI("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["_url","name"],n);let r=eR(e,["config"]);return null!=r&&function(e,t){let n=eR(e,["force"]);void 0!==t&&null!=n&&ew(t,["_query","force"],n)}(r,t),t}(e);r=eI("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["parent"]);null!=n&&ew(t,["_url","parent"],n);let r=eR(e,["config"]);return null!=r&&function(e,t){let n=eR(e,["pageSize"]);void 0!==t&&null!=n&&ew(t,["_query","pageSize"],n);let r=eR(e,["pageToken"]);void 0!==t&&null!=r&&ew(t,["_query","pageToken"],r)}(r,t),t}(e);return r=eI("{parent}/documents",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["nextPageToken"]);null!=r&&ew(t,["nextPageToken"],r);let i=eR(e,["documents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["documents"],e)}return t}(e),n=new eW;return Object.assign(n,t),n})}}}class n_ extends eO{constructor(e,t=new nE(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new tk(ed.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["config"]);return null!=n&&function(e,t){let n=eR(e,["displayName"]);void 0!==t&&null!=n&&ew(t,["displayName"],n)}(n,t),t}(e);return r=eI("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["name"]);return null!=n&&ew(t,["_url","name"],n),t}(e);return r=eI("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["_url","name"],n);let r=eR(e,["config"]);return null!=r&&function(e,t){let n=eR(e,["force"]);void 0!==t&&null!=n&&ew(t,["_query","force"],n)}(r,t),t}(e);r=eI("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["config"]);return null!=n&&function(e,t){let n=eR(e,["pageSize"]);void 0!==t&&null!=n&&ew(t,["_query","pageSize"],n);let r=eR(e,["pageToken"]);void 0!==t&&null!=r&&ew(t,["_query","pageToken"],r)}(n,t),t}(e);return r=eI("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["nextPageToken"]);null!=r&&ew(t,["nextPageToken"],r);let i=eR(e,["fileSearchStores"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["fileSearchStores"],e)}return t}(e),n=new eY;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["fileSearchStoreName"]);null!=n&&ew(t,["_url","file_search_store_name"],n);let r=eR(e,["config"]);return null!=r&&t8(r,t),t}(e);return r=eI("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eR(e,["sdkHttpResponse"]);return null!=n&&ew(t,["sdkHttpResponse"],n),t}(e),n=new eX;return Object.assign(n,t),n})}}async importFile(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eR(e,["fileSearchStoreName"]);null!=n&&ew(t,["_url","file_search_store_name"],n);let r=eR(e,["fileName"]);null!=r&&ew(t,["fileName"],r);let i=eR(e,["config"]);return null!=i&&function(e,t){let n=eR(e,["customMetadata"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ew(t,["customMetadata"],e)}let r=eR(e,["chunkingConfig"]);void 0!==t&&null!=r&&ew(t,["chunkingConfig"],r)}(i,t),t}(e);return r=eI("{file_search_store_name}:importFile",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eR(e,["name"]);null!=n&&ew(t,["name"],n);let r=eR(e,["metadata"]);null!=r&&ew(t,["metadata"],r);let i=eR(e,["done"]);null!=i&&ew(t,["done"],i);let o=eR(e,["error"]);null!=o&&ew(t,["error"],o);let s=eR(e,["response"]);return null!=s&&ew(t,["response"],function(e){let t={},n=eR(e,["sdkHttpResponse"]);null!=n&&ew(t,["sdkHttpResponse"],n);let r=eR(e,["parent"]);null!=r&&ew(t,["parent"],r);let i=eR(e,["documentName"]);return null!=i&&ew(t,["documentName"],i),t}(s)),t}(e),n=new eQ;return Object.assign(n,t),n})}}}let nA=function(){let{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return nA=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))},nT=()=>nA();function nS(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let nb=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(e){}try{return Error(JSON.stringify(e))}catch(e){}}return Error(e)};class nC extends Error{}class nO extends nC{constructor(e,t,n,r){super(`${nO.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.error=t}static makeMessage(e,t,n){let r=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){return e&&r?400===e?new nN(e,t,n,r):401===e?new nk(e,t,n,r):403===e?new nP(e,t,n,r):404===e?new nx(e,t,n,r):409===e?new nU(e,t,n,r):422===e?new nD(e,t,n,r):429===e?new nM(e,t,n,r):e>=500?new nj(e,t,n,r):new nO(e,t,n,r):new nw({message:n,cause:nb(t)})}}class nI extends nO{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class nw extends nO{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class nR extends nw{constructor({message:e}={}){super({message:null!=e?e:"Request timed out."})}}class nN extends nO{}class nk extends nO{}class nP extends nO{}class nx extends nO{}class nU extends nO{}class nD extends nO{}class nM extends nO{}class nj extends nO{}let nL=/^[a-z][a-z0-9+.-]*:/i,nG=e=>nL.test(e),nF=e=>(nF=Array.isArray)(e),nq=nF,nH=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new nC(`${e} must be an integer`);if(t<0)throw new nC(`${e} must be a positive integer`);return t},nB=e=>{try{return JSON.parse(e)}catch(e){return}},nV=e=>new Promise(t=>setTimeout(t,e)),n$="0.0.1",nJ=()=>{var e,t,n,r,i;let o="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n$,"X-Stainless-OS":nz(Deno.build.os),"X-Stainless-Arch":nK(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:null!==(t=null===(e=Deno.version)||void 0===e?void 0:e.deno)&&void 0!==t?t:"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n$,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n$,"X-Stainless-OS":nz(null!==(n=globalThis.process.platform)&&void 0!==n?n:"unknown"),"X-Stainless-Arch":nK(null!==(r=globalThis.process.arch)&&void 0!==r?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!==(i=globalThis.process.version)&&void 0!==i?i:"unknown"};let s=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n){let t=n[1]||0,r=n[2]||0,i=n[3]||0;return{browser:e,version:`${t}.${r}.${i}`}}}return null}();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n$,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n$,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},nK=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",nz=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",nW=()=>null!=r?r:r=nJ();function nY(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function nX(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function nQ(e){var t,n;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await (null===(n=(t=e[Symbol.asyncIterator]()).return)||void 0===n?void 0:n.call(t));return}let r=e.getReader(),i=r.cancel();r.releaseLock(),await i}let nZ=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),n0=()=>{var e;if("undefined"==typeof File){let{process:t}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof(null===(e=null==t?void 0:t.versions)||void 0===e?void 0:e.node)&&20>parseInt(t.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function n1(e,t,n){return n0(),new File(e,null!=t?t:"unknown_file",n)}let n2=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],n4=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,n3=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&n4(e),n6=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function n9(e,t,n){var r;if(n0(),n3(e=await e))return e instanceof File?e:n1([await e.arrayBuffer()],e.name);if(n6(e)){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),n1(await n5(r),t,n)}let i=await n5(e);if(t||(t=("object"==typeof(r=e)&&null!==r&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0),!(null==n?void 0:n.type)){let e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n=Object.assign(Object.assign({},n),{type:e}))}return n1(i,t,n)}async function n5(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(n4(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(n2(e))try{for(var n,r,i,o,s,a,l=!0,u=tL(e);!(n=(a=await u.next()).done);l=!0)o=a.value,l=!1,t.push(...await n5(o))}catch(e){r={error:e}}finally{try{!l&&!n&&(i=u.return)&&await i.call(u)}finally{if(r)throw r.error}}else{let t=null===(s=null==e?void 0:e.constructor)||void 0===s?void 0:s.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class n8{constructor(e){this._client=e}}function n7(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}n8._key=[];let re=Object.freeze(Object.create(null)),rt=((e=n7)=>function(t,...n){let r;if(1===t.length)return t[0];let i=!1,o=[],s=t.reduce((t,r,s)=>{var a,l,u;/[?#]/.test(r)&&(i=!0);let c=n[s],d=(i?encodeURIComponent:e)(""+c);return s!==n.length&&(null==c||"object"==typeof c&&c.toString===(null===(u=Object.getPrototypeOf(null!==(l=Object.getPrototypeOf(null!==(a=c.hasOwnProperty)&&void 0!==a?a:re))&&void 0!==l?l:re))||void 0===u?void 0:u.toString))&&(d=c+"",o.push({start:t.length+r.length,length:d.length,error:`Value of type ${Object.prototype.toString.call(c).slice(8,-1)} is not a valid path parameter`})),t+r+(s===n.length?"":d)},""),a=s.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(a));)o.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(o.sort((e,t)=>e.start-t.start),o.length>0){let e=0,t=o.reduce((t,n)=>{let r=" ".repeat(n.start-e),i="^".repeat(n.length);return e=n.start+n.length,t+r+i},"");throw new nC(`Path parameters result in path with invalid segments:
${o.map(e=>e.error).join("\n")}
${s}
${t}`)}return s})(n7);class rn extends n8{create(e,t){var n;let{api_version:r=this._client.apiVersion}=e,i=tD(e,["api_version"]);if("model"in i&&"agent_config"in i)throw new nC("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new nC("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(rt`/${r}/interactions`,Object.assign(Object.assign({body:i},t),{stream:null!==(n=e.stream)&&void 0!==n&&n}))}delete(e,t={},n){let{api_version:r=this._client.apiVersion}=null!=t?t:{};return this._client.delete(rt`/${r}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:r=this._client.apiVersion}=null!=t?t:{};return this._client.post(rt`/${r}/interactions/${e}/cancel`,n)}get(e,t={},n){var r;let i=null!=t?t:{},{api_version:o=this._client.apiVersion}=i,s=tD(i,["api_version"]);return this._client.get(rt`/${o}/interactions/${e}`,Object.assign(Object.assign({query:s},n),{stream:null!==(r=null==t?void 0:t.stream)&&void 0!==r&&r}))}}rn._key=Object.freeze(["interactions"]);class rr extends rn{}function ri(e){let t;return(null!=i?i:i=(t=new globalThis.TextEncoder).encode.bind(t))(e)}function ro(e){let t;return(null!=o?o:o=(t=new globalThis.TextDecoder).decode.bind(t))(e)}class rs{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){let t;if(null==e)return[];let n=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?ri(e):e;this.buffer=function(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}([this.buffer,n]);let r=[];for(;null!=(t=function(e,t){for(let n=null!=t?t:0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}(this.buffer,this.carriageReturnIndex));){if(t.carriage&&null==this.carriageReturnIndex){this.carriageReturnIndex=t.index;continue}if(null!=this.carriageReturnIndex&&(t.index!==this.carriageReturnIndex+1||t.carriage)){r.push(ro(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let e=null!==this.carriageReturnIndex?t.preceding-1:t.preceding,n=ro(this.buffer.subarray(0,e));r.push(n),this.buffer=this.buffer.subarray(t.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode("\n"):[]}}rs.NEWLINE_CHARS=new Set(["\n","\r"]),rs.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ra={off:0,error:200,warn:300,info:400,debug:500},rl=(e,t,n)=>{if(e){if(Object.prototype.hasOwnProperty.call(ra,e))return e;rh(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ra))}`)}};function ru(){}function rc(e,t,n){return!t||ra[e]>ra[n]?ru:t[e].bind(t)}let rd={error:ru,warn:ru,info:ru,debug:ru},rp=new WeakMap;function rh(e){var t;let n=e.logger,r=null!==(t=e.logLevel)&&void 0!==t?t:"off";if(!n)return rd;let i=rp.get(n);if(i&&i[0]===r)return i[1];let o={error:rc("error",n,r),warn:rc("warn",n,r),info:rc("info",n,r),debug:rc("debug",n,r)};return rp.set(n,[r,o]),o}let rf=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-goog-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class rg{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let r=!1,i=n?rh(n):console;return new rg(function(){return tj(this,arguments,function*(){var n,o,s,a;if(r)throw new nC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let l=!1;try{try{for(var u,c=!0,d=tL(function(e,t){return tj(this,arguments,function*(){var n,r,i,o;if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new nC("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new nC("Attempted to iterate over a response with no body")}let s=new rm,a=new rs,l=nX(e.body);try{for(var u,c=!0,d=tL(function(e){return tj(this,arguments,function*(){var t,n,r,i;let o=new Uint8Array;try{for(var s,a=!0,l=tL(e);!(t=(s=yield tM(l.next())).done);a=!0){let e;if(i=s.value,a=!1,null==i)continue;let t=i instanceof ArrayBuffer?new Uint8Array(i):"string"==typeof i?ri(i):i,n=new Uint8Array(o.length+t.length);for(n.set(o),n.set(t,o.length),o=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(o));)yield yield tM(o.slice(0,e)),o=o.slice(e)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=l.return)&&(yield tM(r.call(l)))}finally{if(n)throw n.error}}o.length>0&&(yield yield tM(o))})}(l));!(n=(u=yield tM(d.next())).done);c=!0)for(let e of(o=u.value,c=!1,a.decode(o))){let t=s.decode(e);t&&(yield yield tM(t))}}catch(e){r={error:e}}finally{try{!c&&!n&&(i=d.return)&&(yield tM(i.call(d)))}finally{if(r)throw r.error}}for(let e of a.flush()){let t=s.decode(e);t&&(yield yield tM(t))}})}(e,t));!(n=(u=yield tM(d.next())).done);c=!0)if(a=u.value,c=!1,!l){if(a.data.startsWith("[DONE]")){l=!0;continue}try{yield yield tM(JSON.parse(a.data))}catch(e){throw i.error("Could not parse message into JSON:",a.data),i.error("From chunk:",a.raw),e}}}catch(e){o={error:e}}finally{try{!c&&!n&&(s=d.return)&&(yield tM(s.call(d)))}finally{if(o)throw o.error}}l=!0}catch(e){if(nS(e))return yield tM(void 0);throw e}finally{l||t.abort()}})},t,n)}static fromReadableStream(e,t,n){let r=!1;return new rg(function(){return tj(this,arguments,function*(){var n,i,o,s;if(r)throw new nC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{try{for(var l,u=!0,c=tL(function(){return tj(this,arguments,function*(){var t,n,r,i;let o=new rs,s=nX(e);try{for(var a,l=!0,u=tL(s);!(t=(a=yield tM(u.next())).done);l=!0)for(let e of(i=a.value,l=!1,o.decode(i)))yield yield tM(e)}catch(e){n={error:e}}finally{try{!l&&!t&&(r=u.return)&&(yield tM(r.call(u)))}finally{if(n)throw n.error}}for(let e of o.flush())yield yield tM(e)})}());!(n=(l=yield tM(c.next())).done);u=!0)s=l.value,u=!1,!a&&s&&(yield yield tM(JSON.parse(s)))}catch(e){i={error:e}}finally{try{!u&&!n&&(o=c.return)&&(yield tM(o.call(c)))}finally{if(i)throw i.error}}a=!0}catch(e){if(nS(e))return yield tM(void 0);throw e}finally{a||t.abort()}})},t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new rg(()=>r(e),this.controller,this.client),new rg(()=>r(t),this.controller,this.client)]}toReadableStream(){let e;let t=this;return nY({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:r}=await e.next();if(r)return t.close();let i=ri(JSON.stringify(n)+"\n");t.enqueue(i)}catch(e){t.error(e)}},async cancel(){var t;await (null===(t=e.return)||void 0===t?void 0:t.call(e))}})}}class rm{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){let n=e.indexOf(":");return -1!==n?[e.substring(0,n),":",e.substring(n+t.length)]:[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function ry(e,t){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:o}=t,s=await (async()=>{var r;if(t.options.stream)return(rh(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(n,t.controller,e):rg.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;let i=n.headers.get("content-type"),o=null===(r=null==i?void 0:i.split(";")[0])||void 0===r?void 0:r.trim();if((null==o?void 0:o.includes("application/json"))||(null==o?void 0:o.endsWith("+json"))){if("0"===n.headers.get("content-length"))return;return await n.json()}return await n.text()})();return rh(e).debug(`[${r}] response parsed`,rf({retryOfRequestLogID:i,url:n.url,status:n.status,body:s,durationMs:Date.now()-o})),s}class rv extends Promise{constructor(e,t,n=ry){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new rv(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}let rE=Symbol("brand.privateNullableHeaders"),r_=e=>{let t=new Headers,n=new Set;for(let r of e){let e=new Set;for(let[i,o]of function*(e){let t;if(!e)return;if(rE in e){let{values:t,nulls:n}=e;for(let e of(yield*t.entries(),n))yield[e,null];return}let n=!1;for(let r of(e instanceof Headers?t=e.entries():nq(e)?t=e:(n=!0,t=Object.entries(null!=e?e:{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=nq(r[1])?r[1]:[r[1]],i=!1;for(let r of t)void 0!==r&&(n&&!i&&(i=!0,yield[e,null]),yield[e,r])}}(r)){let r=i.toLowerCase();e.has(r)||(t.delete(i),e.add(r)),null===o?(t.delete(i),n.add(r)):(t.append(i,o),n.delete(r))}}return{[rE]:!0,values:t,nulls:n}},rA=e=>{var t,n,r,i,o,s;return void 0!==globalThis.process?null!==(r=null===(n=null===(t=globalThis.process.env)||void 0===t?void 0:t[e])||void 0===n?void 0:n.trim())&&void 0!==r?r:void 0:void 0!==globalThis.Deno?null===(s=null===(o=null===(i=globalThis.Deno.env)||void 0===i?void 0:i.get)||void 0===o?void 0:o.call(i,e))||void 0===s?void 0:s.trim():void 0};class rT{constructor(e){var t,n,r,i,o,s,a,{baseURL:l=rA("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:u=null!==(t=rA("GEMINI_API_KEY"))&&void 0!==t?t:null,apiVersion:c="v1beta"}=e;let d=Object.assign(Object.assign({apiKey:u,apiVersion:c},tD(e,["baseURL","apiKey","apiVersion"])),{baseURL:l||"https://generativelanguage.googleapis.com"});this.baseURL=d.baseURL,this.timeout=null!==(n=d.timeout)&&void 0!==n?n:rT.DEFAULT_TIMEOUT,this.logger=null!==(r=d.logger)&&void 0!==r?r:console;let p="warn";this.logLevel=p,this.logLevel=null!==(o=null!==(i=rl(d.logLevel,"ClientOptions.logLevel",this))&&void 0!==i?i:rl(rA("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))&&void 0!==o?o:p,this.fetchOptions=d.fetchOptions,this.maxRetries=null!==(s=d.maxRetries)&&void 0!==s?s:2,this.fetch=null!==(a=d.fetch)&&void 0!==a?a:function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),this.encoder=nZ,this._options=d,this.apiKey=u,this.apiVersion=c,this.clientAdapter=d.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return"https://generativelanguage.googleapis.com"!==this.baseURL}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key")||this.apiKey&&e.get("x-goog-api-key")||t.has("x-goog-api-key")))throw Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=r_([e.headers]);return t.values.has("authorization")||t.values.has("x-goog-api-key")?void 0:this.apiKey?r_([{"x-goog-api-key":this.apiKey}]):this.clientAdapter.isVertexAI()?r_([await this.clientAdapter.getAuthHeaders()]):void 0}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new nC(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${n$}`}defaultIdempotencyKey(){return`stainless-node-retry-${nT()}`}makeStatusError(e,t,n,r){return nO.generate(e,t,n,r)}buildURL(e,t,n){let r=!this.baseURLOverridden()&&n||this.baseURL,i=new URL(nG(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(o)&&(t=Object.assign(Object.assign({},o),t)),"object"==typeof t&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>Object.assign({method:e,path:t},n)))}request(e,t=null){return new rv(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var r,i,o;let s=await e,a=null!==(r=s.maxRetries)&&void 0!==r?r:this.maxRetries;null==t&&(t=a),await this.prepareOptions(s);let{req:l,url:u,timeout:c}=await this.buildRequest(s,{retryCount:a-t});await this.prepareRequest(l,{url:u,options:s});let d="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),p=void 0===n?"":`, retryOf: ${n}`,h=Date.now();if(rh(this).debug(`[${d}] sending request`,rf({retryOfRequestLogID:n,method:s.method,url:u,options:s,headers:l.headers})),null===(i=s.signal)||void 0===i?void 0:i.aborted)throw new nI;let f=new AbortController,g=await this.fetchWithTimeout(u,l,c,f).catch(nb),m=Date.now();if(g instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(null===(o=s.signal)||void 0===o?void 0:o.aborted)throw new nI;let r=nS(g)||/timed? ?out/i.test(String(g)+("cause"in g?String(g.cause):""));if(t)return rh(this).info(`[${d}] connection ${r?"timed out":"failed"} - ${e}`),rh(this).debug(`[${d}] connection ${r?"timed out":"failed"} (${e})`,rf({retryOfRequestLogID:n,url:u,durationMs:m-h,message:g.message})),this.retryRequest(s,t,null!=n?n:d);if(rh(this).info(`[${d}] connection ${r?"timed out":"failed"} - error; no more retries left`),rh(this).debug(`[${d}] connection ${r?"timed out":"failed"} (error; no more retries left)`,rf({retryOfRequestLogID:n,url:u,durationMs:m-h,message:g.message})),r)throw new nR;throw new nw({cause:g})}let y=`[${d}${p}] ${l.method} ${u} ${g.ok?"succeeded":"failed"} with status ${g.status} in ${m-h}ms`;if(!g.ok){let e=await this.shouldRetry(g);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await nQ(g.body),rh(this).info(`${y} - ${e}`),rh(this).debug(`[${d}] response error (${e})`,rf({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:m-h})),this.retryRequest(s,t,null!=n?n:d,g.headers)}let r=e?"error; no more retries left":"error; not retryable";rh(this).info(`${y} - ${r}`);let i=await g.text().catch(e=>nb(e).message),o=nB(i),a=o?void 0:i;throw rh(this).debug(`[${d}] response error (${r})`,rf({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,message:a,durationMs:Date.now()-h})),this.makeStatusError(g.status,o,a,g.headers)}return rh(this).info(y),rh(this).debug(`[${d}] response start`,rf({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:m-h})),{response:g,options:s,controller:f,requestLogID:d,retryOfRequestLogID:n,startTime:h}}async fetchWithTimeout(e,t,n,r){let i=t||{},{signal:o,method:s}=i,a=tD(i,["signal","method"]),l=r.abort.bind(r);o&&o.addEventListener("abort",l,{once:!0});let u=setTimeout(l,n),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,d=Object.assign(Object.assign(Object.assign({signal:r.signal},c?{duplex:"half"}:{}),{method:"GET"}),a);s&&(d.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(u)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,n,r){var i;let o;let s=null==r?void 0:r.get("retry-after-ms");if(s){let e=parseFloat(s);Number.isNaN(e)||(o=e)}let a=null==r?void 0:r.get("retry-after");if(a&&!o){let e=parseFloat(a);o=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(o&&0<=o&&o<6e4)){let n=null!==(i=e.maxRetries)&&void 0!==i?i:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,n)}return await nV(o),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,r,i;let o=Object.assign({},e),{method:s,path:a,query:l,defaultBaseURL:u}=o,c=this.buildURL(a,l,u);"timeout"in o&&nH("timeout",o.timeout),o.timeout=null!==(n=o.timeout)&&void 0!==n?n:this.timeout;let{bodyHeaders:d,body:p}=this.buildBody({options:o}),h=await this.buildHeaders({options:e,method:s,bodyHeaders:d,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:s,headers:h},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"}),p&&{body:p}),null!==(r=this.fetchOptions)&&void 0!==r?r:{}),null!==(i=o.fetchOptions)&&void 0!==i?i:{}),url:c,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let i={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),s=r_([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),nW()),this._options.defaultHeaders,n,e.headers,o]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=r_([t]);if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream)return{bodyHeaders:void 0,body:e};if("object"!=typeof e||!(Symbol.asyncIterator in e)&&(!(Symbol.iterator in e)||!("next"in e)||"function"!=typeof e.next))return this.encoder({body:e,headers:n});{let t;return{bodyHeaders:void 0,body:(t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator](),nY({start(){},async pull(e){let{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){var e;await (null===(e=t.return)||void 0===e?void 0:e.call(t))}}))}}}}rT.DEFAULT_TIMEOUT=6e4;class rS extends rT{constructor(){super(...arguments),this.interactions=new rr(this)}}rS.GeminiNextGenAPIClient=rS,rS.GeminiNextGenAPIClientError=nC,rS.APIError=nO,rS.APIConnectionError=nw,rS.APIConnectionTimeoutError=nR,rS.APIUserAbortError=nI,rS.NotFoundError=nx,rS.ConflictError=nU,rS.RateLimitError=nM,rS.BadRequestError=nN,rS.AuthenticationError=nk,rS.InternalServerError=nj,rS.PermissionDeniedError=nP,rS.UnprocessableEntityError=nD,rS.toFile=n9,rS.Interactions=rr;let rb="x-goog-api-key",rC="https://www.googleapis.com/auth/cloud-platform";class rO{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}let t=function(e){if(!e)return{scopes:[rC]};if(e.scopes){if("string"==typeof e.scopes&&e.scopes!==rC||Array.isArray(e.scopes)&&0>e.scopes.indexOf(rC))throw Error(`Invalid auth scopes. Scopes must include: ${rC}`)}else e.scopes=[rC];return e}(e.googleAuthOptions);this.googleAuth=new eE.kF(t)}async addAuthHeaders(e,t){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(null===e.get(rb)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(rb,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[n,r]of(await this.googleAuth.getRequestHeaders(t)))null===e.get(n)&&e.append(n,r)}}class rI{async download(e,t){if(e.downloadPath){let n=await rw(e,t);if(n instanceof eP){let t=(0,e_.createWriteStream)(e.downloadPath);eT.Readable.fromWeb(n.responseInternal.body).pipe(t),await (0,eS.finished)(t)}else try{await (0,eA.writeFile)(e.downloadPath,n,{encoding:"base64"})}catch(t){throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)}}}}async function rw(e,t){var n,r,i;let o=t_(e.file);if(void 0!==o)return await t.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal});if(tv(e.file)){let t=null===(i=e.file.video)||void 0===i?void 0:i.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(tE(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}class rR{create(e,t,n){return new rN(e,t,n)}}class rN{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new eb.WebSocket(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function rk(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["name"]);null!=i&&ew(n,["name"],i);let o=eR(e,["state"]);null!=o&&ew(n,["state"],ty(o));let s=eR(e,["createTime"]);null!=s&&ew(n,["createTime"],s);let a=eR(e,["tuningTask","startTime"]);null!=a&&ew(n,["startTime"],a);let l=eR(e,["tuningTask","completeTime"]);null!=l&&ew(n,["endTime"],l);let u=eR(e,["updateTime"]);null!=u&&ew(n,["updateTime"],u);let c=eR(e,["description"]);null!=c&&ew(n,["description"],c);let d=eR(e,["baseModel"]);null!=d&&ew(n,["baseModel"],d);let p=eR(e,["_self"]);return null!=p&&ew(n,["tunedModel"],function(e,t){let n={},r=eR(e,["name"]);null!=r&&ew(n,["model"],r);let i=eR(e,["name"]);return null!=i&&ew(n,["endpoint"],i),n}(p)),n}function rP(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["name"]);null!=i&&ew(n,["name"],i);let o=eR(e,["state"]);null!=o&&ew(n,["state"],ty(o));let s=eR(e,["createTime"]);null!=s&&ew(n,["createTime"],s);let a=eR(e,["startTime"]);null!=a&&ew(n,["startTime"],a);let l=eR(e,["endTime"]);null!=l&&ew(n,["endTime"],l);let u=eR(e,["updateTime"]);null!=u&&ew(n,["updateTime"],u);let c=eR(e,["error"]);null!=c&&ew(n,["error"],c);let d=eR(e,["description"]);null!=d&&ew(n,["description"],d);let p=eR(e,["baseModel"]);null!=p&&ew(n,["baseModel"],p);let h=eR(e,["tunedModel"]);null!=h&&ew(n,["tunedModel"],h);let f=eR(e,["preTunedModel"]);null!=f&&ew(n,["preTunedModel"],f);let g=eR(e,["supervisedTuningSpec"]);null!=g&&ew(n,["supervisedTuningSpec"],g);let m=eR(e,["preferenceOptimizationSpec"]);null!=m&&ew(n,["preferenceOptimizationSpec"],m);let y=eR(e,["distillationSpec"]);null!=y&&ew(n,["distillationSpec"],y);let v=eR(e,["tuningDataStats"]);null!=v&&ew(n,["tuningDataStats"],v);let E=eR(e,["encryptionSpec"]);null!=E&&ew(n,["encryptionSpec"],E);let _=eR(e,["partnerModelTuningSpec"]);null!=_&&ew(n,["partnerModelTuningSpec"],_);let A=eR(e,["customBaseModel"]);null!=A&&ew(n,["customBaseModel"],A);let T=eR(e,["experiment"]);null!=T&&ew(n,["experiment"],T);let S=eR(e,["labels"]);null!=S&&ew(n,["labels"],S);let b=eR(e,["outputUri"]);null!=b&&ew(n,["outputUri"],b);let C=eR(e,["pipelineJob"]);null!=C&&ew(n,["pipelineJob"],C);let O=eR(e,["serviceAccount"]);null!=O&&ew(n,["serviceAccount"],O);let I=eR(e,["tunedModelDisplayName"]);null!=I&&ew(n,["tunedModelDisplayName"],I);let w=eR(e,["veoTuningSpec"]);return null!=w&&ew(n,["veoTuningSpec"],w),n}function rx(e,t){let n={},r=eR(e,["gcsUri"]);null!=r&&ew(n,["validationDatasetUri"],r);let i=eR(e,["vertexDatasetResource"]);return null!=i&&ew(n,["validationDatasetUri"],i),n}class rU extends eO{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tk(ed.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI()){if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null===(t=e.config)||void 0===t?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},e),{preTunedModel:n});return r.baseModel=void 0,await this.tuneInternal(r)}{let t=Object.assign({},e);return await this.tuneInternal(t)}}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),r="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?r=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(r=n.name.split("/operations/")[0]),{name:r,state:x.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(e,["name"]);return null!=r&&ew(n,["_url","name"],r),n}(e);return o=eI("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>rP(e))}{let t=function(e,t){let n={},r=eR(e,["name"]);return null!=r&&ew(n,["_url","name"],r),n}(e);return o=eI("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>rk(e))}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(e,["config"]);return null!=r&&function(e,t,n){let r=eR(e,["pageSize"]);void 0!==t&&null!=r&&ew(t,["_query","pageSize"],r);let i=eR(e,["pageToken"]);void 0!==t&&null!=i&&ew(t,["_query","pageToken"],i);let o=eR(e,["filter"]);void 0!==t&&null!=o&&ew(t,["_query","filter"],o)}(r,n),n}(e);return o=eI("tuningJobs",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["nextPageToken"]);null!=i&&ew(n,["nextPageToken"],i);let o=eR(e,["tuningJobs"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>rP(e))),ew(n,["tuningJobs"],e)}return n}(e),n=new e$;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eR(e,["config"]);return null!=r&&function(e,t,n){let r=eR(e,["pageSize"]);void 0!==t&&null!=r&&ew(t,["_query","pageSize"],r);let i=eR(e,["pageToken"]);void 0!==t&&null!=i&&ew(t,["_query","pageToken"],i);let o=eR(e,["filter"]);void 0!==t&&null!=o&&ew(t,["_query","filter"],o)}(r,n),n}(e);return o=eI("tunedModels",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["nextPageToken"]);null!=i&&ew(n,["nextPageToken"],i);let o=eR(e,["tunedModels"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>rk(e))),ew(n,["tuningJobs"],e)}return n}(e),n=new e$;return Object.assign(n,t),n})}}async cancel(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eR(e,["name"]);return null!=r&&ew(n,["_url","name"],r),n}(e);return o=eI("{name}:cancel",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);return null!=r&&ew(n,["sdkHttpResponse"],r),n}(e),n=new eJ;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eR(e,["name"]);return null!=r&&ew(n,["_url","name"],r),n}(e);return o=eI("{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);return null!=r&&ew(n,["sdkHttpResponse"],r),n}(e),n=new eJ;return Object.assign(n,t),n})}}async tuneInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},r=eR(e,["baseModel"]);null!=r&&ew(n,["baseModel"],r);let i=eR(e,["preTunedModel"]);null!=i&&ew(n,["preTunedModel"],i);let o=eR(e,["trainingDataset"]);null!=o&&function(e,t,n){let r=eR(n,["config","method"]);if(void 0===r&&(r="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===r){let n=eR(e,["gcsUri"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===r){let n=eR(e,["gcsUri"]);void 0!==t&&null!=n&&ew(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}else if("DISTILLATION"===r){let n=eR(e,["gcsUri"]);void 0!==t&&null!=n&&ew(t,["distillationSpec","promptDatasetUri"],n)}let i=eR(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let n=eR(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===i){let n=eR(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&ew(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}else if("DISTILLATION"===i){let n=eR(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&ew(t,["distillationSpec","promptDatasetUri"],n)}if(void 0!==eR(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(o,n,t);let s=eR(e,["config"]);return null!=s&&function(e,t,n){let r=eR(n,["config","method"]);if(void 0===r&&(r="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===r){let n=eR(e,["validationDataset"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec"],rx(n))}else if("PREFERENCE_TUNING"===r){let n=eR(e,["validationDataset"]);void 0!==t&&null!=n&&ew(t,["preferenceOptimizationSpec"],rx(n))}else if("DISTILLATION"===r){let n=eR(e,["validationDataset"]);void 0!==t&&null!=n&&ew(t,["distillationSpec"],rx(n))}let i=eR(e,["tunedModelDisplayName"]);void 0!==t&&null!=i&&ew(t,["tunedModelDisplayName"],i);let o=eR(e,["description"]);void 0!==t&&null!=o&&ew(t,["description"],o);let s=eR(n,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){let n=eR(e,["epochCount"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===s){let n=eR(e,["epochCount"]);void 0!==t&&null!=n&&ew(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}else if("DISTILLATION"===s){let n=eR(e,["epochCount"]);void 0!==t&&null!=n&&ew(t,["distillationSpec","hyperParameters","epochCount"],n)}let a=eR(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){let n=eR(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===a){let n=eR(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&ew(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}else if("DISTILLATION"===a){let n=eR(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&ew(t,["distillationSpec","hyperParameters","learningRateMultiplier"],n)}let l=eR(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){let n=eR(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===l){let n=eR(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&ew(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}else if("DISTILLATION"===l){let n=eR(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&ew(t,["distillationSpec","exportLastCheckpointOnly"],n)}let u=eR(n,["config","method"]);if(void 0===u&&(u="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===u){let n=eR(e,["adapterSize"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===u){let n=eR(e,["adapterSize"]);void 0!==t&&null!=n&&ew(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}else if("DISTILLATION"===u){let n=eR(e,["adapterSize"]);void 0!==t&&null!=n&&ew(t,["distillationSpec","hyperParameters","adapterSize"],n)}let c=eR(n,["config","method"]);if(void 0===c&&(c="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===c){let n=eR(e,["tuningMode"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","tuningMode"],n)}let d=eR(e,["customBaseModel"]);void 0!==t&&null!=d&&ew(t,["customBaseModel"],d);let p=eR(n,["config","method"]);if(void 0===p&&(p="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===p){let n=eR(e,["batchSize"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","hyperParameters","batchSize"],n)}let h=eR(n,["config","method"]);if(void 0===h&&(h="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===h){let n=eR(e,["learningRate"]);void 0!==t&&null!=n&&ew(t,["supervisedTuningSpec","hyperParameters","learningRate"],n)}let f=eR(e,["labels"]);void 0!==t&&null!=f&&ew(t,["labels"],f);let g=eR(e,["beta"]);void 0!==t&&null!=g&&ew(t,["preferenceOptimizationSpec","hyperParameters","beta"],g);let m=eR(e,["baseTeacherModel"]);void 0!==t&&null!=m&&ew(t,["distillationSpec","baseTeacherModel"],m);let y=eR(e,["tunedTeacherModelSource"]);void 0!==t&&null!=y&&ew(t,["distillationSpec","tunedTeacherModelSource"],y);let v=eR(e,["sftLossWeightMultiplier"]);void 0!==t&&null!=v&&ew(t,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],v);let E=eR(e,["outputUri"]);void 0!==t&&null!=E&&ew(t,["outputUri"],E)}(s,n,t),n}(e,e);return r=eI("tuningJobs",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>rP(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let n={},r=eR(e,["baseModel"]);null!=r&&ew(n,["baseModel"],r);let i=eR(e,["preTunedModel"]);null!=i&&ew(n,["preTunedModel"],i);let o=eR(e,["trainingDataset"]);null!=o&&function(e,t){if(void 0!==eR(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==eR(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=eR(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),ew({},["examples","examples"],e)}}(o);let s=eR(e,["config"]);return null!=s&&function(e,t,n){if(void 0!==eR(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let r=eR(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=r&&ew(t,["displayName"],r),void 0!==eR(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=eR(e,["epochCount"]);void 0!==t&&null!=i&&ew(t,["tuningTask","hyperparameters","epochCount"],i);let o=eR(e,["learningRateMultiplier"]);if(null!=o&&ew({},["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==eR(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==eR(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==eR(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");if(void 0!==eR(e,["tuningMode"]))throw Error("tuningMode parameter is not supported in Gemini API.");if(void 0!==eR(e,["customBaseModel"]))throw Error("customBaseModel parameter is not supported in Gemini API.");let s=eR(e,["batchSize"]);void 0!==t&&null!=s&&ew(t,["tuningTask","hyperparameters","batchSize"],s);let a=eR(e,["learningRate"]);if(void 0!==t&&null!=a&&ew(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==eR(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==eR(e,["beta"]))throw Error("beta parameter is not supported in Gemini API.");if(void 0!==eR(e,["baseTeacherModel"]))throw Error("baseTeacherModel parameter is not supported in Gemini API.");if(void 0!==eR(e,["tunedTeacherModelSource"]))throw Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(void 0!==eR(e,["sftLossWeightMultiplier"]))throw Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(void 0!==eR(e,["outputUri"]))throw Error("outputUri parameter is not supported in Gemini API.")}(s,n),n}(e);return r=eI("tunedModels",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e,t){let n={},r=eR(e,["sdkHttpResponse"]);null!=r&&ew(n,["sdkHttpResponse"],r);let i=eR(e,["name"]);null!=i&&ew(n,["name"],i);let o=eR(e,["metadata"]);null!=o&&ew(n,["metadata"],o);let s=eR(e,["done"]);null!=s&&ew(n,["done"],s);let a=eR(e,["error"]);return null!=a&&ew(n,["error"],a),n})(e))}}}let rD="x-goog-upload-status";async function rM(e,t,n){var r;let i=await rL(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[rD])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async function rj(e,t,n){var r;let i=await rL(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[rD])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=ek(o),a=new e9;return Object.assign(a,s),a}async function rL(e,t,n){var r,i;let o=0,s=0,a=new eP(new Response),l="upload";for(o=e.size;s<o;){let u=Math.min(8388608,o-s),c=e.slice(s,s+u);s+u>=o&&(l+=", finalize");let d=0,p=1e3;for(;d<3&&(null===(r=null==(a=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(s),"Content-Length":String(u)}}}))?void 0:a.headers)||void 0===r||!r[rD]);)d++,await rF(p),p*=2;if(s+=u,(null===(i=null==a?void 0:a.headers)||void 0===i?void 0:i[rD])!=="active")break;if(o<=s)throw Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function rG(e){return{size:e.size,type:e.type}}function rF(e){return new Promise(t=>setTimeout(t,e))}class rq{async stat(e){let t={size:0,type:void 0};if("string"!=typeof e)return await rG(e);{let n=await eA.stat(e);return t.size=n.size,t.type=this.inferMimeType(e),t}}async upload(e,t,n){return"string"==typeof e?await this.uploadFileFromPath(e,t,n):rM(e,t,n)}async uploadToFileSearchStore(e,t,n){return"string"==typeof e?await this.uploadFileToFileSearchStoreFromPath(e,t,n):rj(e,t,n)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,n){var r;let i=await this.uploadFileFromPathInternal(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[rD])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async uploadFileToFileSearchStoreFromPath(e,t,n){var r;let i=await this.uploadFileFromPathInternal(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[rD])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=ek(o),a=new e9;return Object.assign(a,s),a}async uploadFileFromPathInternal(e,t,n){var r,i;let o;let s=0,a=0,l=new eP(new Response),u="upload",c=eC.basename(e);try{if(!(o=await eA.open(e,"r")))throw Error("Failed to open file");for(s=(await o.stat()).size;a<s;){let e=Math.min(8388608,s-a);a+e>=s&&(u+=", finalize");let d=new Uint8Array(e),{bytesRead:p}=await o.read(d,0,e,a);if(p!==e)throw Error(`Failed to read ${e} bytes from file at offset ${a}. bytes actually read: ${p}`);let h=new Blob([d]),f=0,g=1e3;for(;f<3&&(l=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(p),"X-Goog-Upload-File-Name":c}}}),null===(r=null==l?void 0:l.headers)||void 0===r||!r[rD]);)f++,await rF(g),g*=2;if(a+=p,(null===(i=null==l?void 0:l.headers)||void 0===i?void 0:i[rD])!=="active")break;if(s<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}return l}finally{o&&await o.close()}}}class rH extends tV{async registerFiles(e){if("undefined"==typeof process||!process.versions||!process.versions.node)throw Error("registerFiles is only supported in Node.js environments.");let t=e.auth,n=await t.getRequestHeaders(),r=e.config||{},i=r.httpOptions||{},o=Object.assign({},i.headers||{});if(n){if("function"==typeof n[Symbol.iterator])for(let[e,t]of n)o[e]=t;else for(let[e,t]of Object.entries(n))o[e]=t}return this._registerFiles({uris:e.uris,config:Object.assign(Object.assign({},r),{httpOptions:Object.assign(Object.assign({},i),{headers:o})})})}}class rB{get interactions(){if(void 0!==this._interactions)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;(null==e?void 0:e.extraBody)&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new rS({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:null==e?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t,n,r,i,o,l;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!==(n=null!==(t=e.vertexai)&&void 0!==t?t:function(e){var t;return void 0!==(t=rV(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&void 0!==n&&n;let u=function(){let e=rV("GOOGLE_API_KEY"),t=rV("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t||void 0}(),c=rV("GOOGLE_CLOUD_PROJECT"),d=rV("GOOGLE_CLOUD_LOCATION");if(this.apiKey=null!==(r=e.apiKey)&&void 0!==r?r:u,this.project=null!==(i=e.project)&&void 0!==i?i:c,this.location=null!==(o=e.location)&&void 0!==o?o:d,!this.vertexai&&!this.apiKey)throw Error("API key must be set when using the Gemini API.");!e.vertexai||((null===(l=e.googleAuthOptions)||void 0===l?void 0:l.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(c||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&u?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(c||d)&&u&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),this.location||this.apiKey||(this.location="global"));let p=function(e,t,n,r){var i,o;if(!(null==e?void 0:e.baseUrl)){let e={geminiUrl:s,vertexUrl:a};return t?null!==(i=e.vertexUrl)&&void 0!==i?i:n:null!==(o=e.geminiUrl)&&void 0!==o?o:r}return e.baseUrl}(e.httpOptions,e.vertexai,rV("GOOGLE_VERTEX_BASE_URL"),rV("GOOGLE_GEMINI_BASE_URL"));p&&(e.httpOptions?e.httpOptions.baseUrl=p:e.httpOptions={baseUrl:p}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let h=new rO({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new ne({auth:h,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new rq,downloader:new rI}),this.models=new nm(this.apiClient),this.live=new nu(this.apiClient,h,new rR),this.batches=new tP(this.apiClient),this.chats=new tq(this.models,this.apiClient),this.caches=new tU(this.apiClient),this.files=new rH(this.apiClient),this.operations=new ny(this.apiClient),this.authTokens=new nv(this.apiClient),this.tunings=new rU(this.apiClient),this.fileSearchStores=new n_(this.apiClient)}}function rV(e){var t,n,r;return null!==(r=null===(n=null===(t=null==process?void 0:process.env)||void 0===t?void 0:t[e])||void 0===n?void 0:n.trim())&&void 0!==r?r:void 0}let r$=ey.z.string().transform(e=>{let t=e?.trim?.()??"";return/optimal|excellent|strong|good/i.test(t)?"Optimal":/critical|poor|weak|bad/i.test(t)?"Critical":"Average"}).pipe(ey.z.enum(["Critical","Optimal","Average"])),rJ=ey.z.string().transform(e=>{let t=(e?.trim?.()??"").toLowerCase();return"pass"===t||/optimal|excellent|good|strong|yes/i.test(t)?"Pass":"fail"===t||/critical|poor|bad|no/i.test(t)?"Fail":"Warning"}).pipe(ey.z.enum(["Pass","Fail","Warning"])),rK=ey.z.string().transform(e=>{let t=(e?.trim?.()??"").toLowerCase();return/high|strong|active/i.test(t)?"High":/none|absent|n\/a/i.test(t)?"None":/low|minimal|weak/i.test(t)?"Low":"Medium"}).pipe(ey.z.enum(["High","Medium","Low","None"])),rz=ey.z.string().transform(e=>{let t=(e?.trim?.()??"").toLowerCase();return/high|critical|severe/i.test(t)?"High":/low|minimal/i.test(t)?"Low":"Medium"}).pipe(ey.z.enum(["Low","Medium","High"])),rW=ey.z.string().transform(e=>{let t=(e?.trim?.()??"").toLowerCase();return/high|critical|urgent/i.test(t)?"High":/low|minor/i.test(t)?"Low":"Medium"}).pipe(ey.z.enum(["High","Medium","Low"])),rY=ey.z.string().transform(e=>{let t=(e?.trim?.()??"").toLowerCase();return/yes|full|complete|true/i.test(t)?"Yes":/no|none|false/i.test(t)?"No":"Partial"}).pipe(ey.z.enum(["Yes","Partial","No"])),rX=ey.z.object({score:ey.z.coerce.number(),status:r$,summary:ey.z.string()}),rQ=ey.z.object({name:ey.z.string(),visibilityScore:ey.z.coerce.number(),recommendationLikelihood:ey.z.coerce.number(),brandAuthority:ey.z.coerce.number(),citationCount:ey.z.coerce.number(),sentiment:ey.z.string(),keyTakeaway:ey.z.string()}),rZ=ey.z.object({name:ey.z.string(),visibilityScore:ey.z.coerce.number(),primaryStrength:ey.z.string(),threatLevel:rz}),r0=ey.z.object({title:ey.z.string(),evaluation:ey.z.string(),score:ey.z.coerce.number()}),r1=ey.z.object({point:ey.z.string(),status:rJ,observation:ey.z.string()}),r2=ey.z.object({platform:ey.z.string(),presence:rK,sentiment:ey.z.string(),observation:ey.z.string()}),r4=ey.z.object({engine:ey.z.string(),rank:ey.z.string(),status:r$}),r3=ey.z.object({title:ey.z.string(),action:ey.z.string(),priority:rW,timeline:ey.z.string()}),r6=ey.z.object({title:ey.z.string(),uri:ey.z.string()}),r9=rX.extend({entityConfidence:ey.z.coerce.number(),napConsistency:ey.z.string(),schemaValidation:ey.z.string(),knowledgeGraph:rY}),r5=rX.extend({coreWebVitals:ey.z.string(),pageSpeed:ey.z.coerce.number(),mobileHealth:ey.z.string()}),r8=rX.extend({referringDomains:ey.z.coerce.number(),sentimentScore:ey.z.coerce.number(),trustSignals:ey.z.array(ey.z.string())}),r7=ey.z.object({overallScore:ey.z.coerce.number(),searchVisibilityIndex:ey.z.coerce.number(),aiVisibilityIndex:ey.z.coerce.number(),hallucinationRisk:ey.z.coerce.number(),logicIntegrity:ey.z.coerce.number(),foundation:r9,technical:r5,authority:r8,aiBreakdown:ey.z.array(rQ),pillarAnalysis:ey.z.array(r0),technicalChecklist:ey.z.array(r1),socialFootprint:ey.z.array(r2),traditionalRankings:ey.z.array(r4).optional().default([]),competitors:ey.z.array(rZ).optional().default([]),globalRecommendations:ey.z.array(r3),sources:ey.z.array(r6).optional().default([])}),ie=process.env.GEMINI_MODEL??"gemini-2.5-flash",it=process.env.GEMINI_FALLBACK_MODEL??"gemini-1.5-flash";async function ir(e,t){let n;let r=process.env.GEMINI_API_KEY;if(!r)throw Error("GEMINI_API_KEY is not configured.");let{brandName:i,industry:o,websiteUrl:s,keywords:a,location:l,serviceCategories:u}=e,c=`Perform a high-precision digital visibility and AIEO (Artificial Intelligence Engine Optimization) audit for "${i}". 
    
    AIEO FRAMEWORK CONTEXT:
    1. Crawl Layer (SEO Foundation): Indexable architecture, schema, speed.
    2. Answer Layer (AEO Structure): Q&A formatting, entity definitions, extractable data.
    3. AI Knowledge Layer (AIO Signals): Topical authority, brand mentions, E-E-A-T.

    CRITICAL REQUIREMENTS:
    - You must return ONLY raw, valid JSON matching the requested schema. Do not include markdown formatting like \`\`\`json. Ensure all quotes are escaped properly.
    - Return a single, valid JSON object following the requested schema.
    - Provide a professional executive analysis in 'foundation.summary' focusing on why AI engines might or might not prioritize this brand.
    - Engine Breakdown: Exactly 3 platforms (ChatGPT, Gemini, Perplexity).
    - Technical Checklist: Provide a list of exactly 22 technical checkpoints.
    - Visibility Factors (pillarAnalysis): 5 items (Crawl, Answer, AI Knowledge, Brand Authority, Trust).
    - Social Footprint: Analyze brand presence across 6 major platforms.
    - Action Plan: 3 prioritized recommendations.

    ENTITY: ${i} (${s}), ${o} in ${l}.
    KEYWORDS: ${a}.
    SERVICES: ${u}.

CRITICAL INSTRUCTION: You MUST return a raw JSON object. Do not wrap it in markdown. The JSON MUST strictly adhere to this exact TypeScript structure. Do not omit any keys.

{
  "overallScore": number (0-100),
  "searchVisibilityIndex": number (0-100),
  "aiVisibilityIndex": number (0-100),
  "hallucinationRisk": number (0-100),
  "logicIntegrity": number (0-100),
  "foundation": {
    "score": number,
    "status": "Critical" | "Optimal" | "Average",
    "summary": string,
    "entityConfidence": number,
    "napConsistency": string,
    "schemaValidation": string,
    "knowledgeGraph": "Yes" | "Partial" | "No"
  },
  "technical": {
    "score": number,
    "status": "Critical" | "Optimal" | "Average",
    "summary": string,
    "coreWebVitals": string,
    "pageSpeed": number,
    "mobileHealth": string
  },
  "aiBreakdown": [
    {
      "name": string,
      "visibilityScore": number,
      "recommendationLikelihood": number,
      "brandAuthority": number,
      "citationCount": number,
      "sentiment": string,
      "keyTakeaway": string
    }
  ],
  "pillarAnalysis": [
    {
      "title": string,
      "evaluation": string,
      "score": number
    }
  ],
  "technicalChecklist": [
    {
      "point": string,
      "status": "Pass" | "Fail" | "Warning" (ONLY use these 3 exact strings),
      "observation": string
    }
  ],
  "socialFootprint": [
    {
      "platform": string,
      "presence": "High" | "Medium" | "Low" | "None" (ONLY use these 4 exact strings),
      "sentiment": string,
      "observation": string
    }
  ],
  "authority": {
    "score": number,
    "status": "Critical" | "Optimal" | "Average",
    "summary": string,
    "referringDomains": number,
    "sentimentScore": number,
    "trustSignals": array of strings
  },
  "traditionalRankings": [
    {
      "engine": string,
      "rank": string,
      "status": "Critical" | "Optimal" | "Average"
    }
  ],
  "competitors": [
    {
      "name": string,
      "visibilityScore": number,
      "primaryStrength": string,
      "threatLevel": "Low" | "Medium" | "High"
    }
  ],
  "globalRecommendations": [
    {
      "title": string,
      "action": string,
      "priority": "High" | "Medium" | "Low",
      "timeline": string
    }
  ]
}`,d=new rB({apiKey:r}),p={model:t,contents:c,config:{tools:[{googleSearch:{}}]}};for(let e=0;e<3;e++)try{let e=await d.models.generateContent(p),t=e.text??"",n=function(e){if(!e?.trim())throw Error("Received empty response from the AI engine.");let t=e.trim();try{return JSON.parse(t)}catch{let e=t.match(/```(?:json)?\s*([\s\S]*?)\s*```/);if(e?.[1])try{return JSON.parse(e[1].trim())}catch{}let n=t.indexOf("{"),r=t.lastIndexOf("}");if(-1!==n&&r>n)try{return JSON.parse(t.substring(n,r+1))}catch{}}throw Error("The report data is formatted incorrectly. Please try again.")}(t),r=(e.candidates?.[0]?.groundingMetadata?.groundingChunks??[]).filter(e=>!!e.web).map(e=>({title:e.web.title??"",uri:e.web.uri??""}));return function(e,t=[]){let n=r7.safeParse(e);if(!n.success){let e=n.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join("; ");throw Error(`Audit response validation failed: ${e}`)}return{...n.data,sources:t}}(n,r)}catch(t){if(n=t,e<2&&function(e){let t=String(e instanceof Error?e.message:e);return t.includes("429")||t.includes("RESOURCE_EXHAUSTED")||t.includes("exhausted")||t.includes("rate limit")}(t)){let t=2e3*Math.pow(2,e);console.warn(`Gemini rate limit (429), retrying in ${t}ms (attempt ${e+1}/3)`),await function(e){return new Promise(t=>setTimeout(t,e))}(t)}else throw t}throw n}async function ii(e){try{return await ir(e,ie)}catch(t){if(function(e){let t=String(e instanceof Error?e.message:e);return t.includes("429")||t.includes("503")||t.includes("RESOURCE_EXHAUSTED")||t.includes("SERVICE_UNAVAILABLE")||t.includes("rate limit")}(t))return console.warn(`Primary model ${ie} failed. Falling back to ${it}.`),await ir(e,it);throw t}}var io=n(52534);async function is(e){try{let t=await e.json(),n=ev.safeParse(t);if(!n.success)return em.NextResponse.json({error:"Invalid audit inputs",details:n.error.flatten()},{status:400});let r=n.data,i=await ii(r),o=await (0,io.a5)(r,i);return em.NextResponse.json({success:!0,reportId:o,result:i})}catch(e){return console.error("Audit Error:",e),em.NextResponse.json({success:!1,error:"The audit service is temporarily unavailable or formatting failed. Please try again."},{status:500})}}let ia=new eh.AppRouteRouteModule({definition:{kind:ef.RouteKind.APP_ROUTE,page:"/api/audit/route",pathname:"/api/audit",filename:"route",bundlePath:"app/api/audit/route"},resolvedPagePath:"/home/riteshsharma/Desktop/prsnl-work/AISEO_GIG/aieo-by-getnifty/app/api/audit/route.ts",nextConfigOutput:"",userland:ep}),{workAsyncStorage:il,workUnitAsyncStorage:iu,serverHooks:ic}=ia;function id(){return(0,eg.patchFetch)({workAsyncStorage:il,workUnitAsyncStorage:iu})}},96487:()=>{},78335:()=>{},52534:(e,t,n)=>{"use strict";n.d(t,{$G:()=>l,a5:()=>u,ly:()=>c});var r=n(84324);let i="https://jmdnapdpsormcbijinwy.supabase.co",o=process.env.NEXT_PRIVATE_SERVICE_ROLE_API_KEY??process.env.SUPABASE_SERVICE_ROLE_KEY,s=null;function a(){if(!i||!o)throw Error("Supabase environment variables are missing.");return s||(s=(0,r.UU)(i,o,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})),s}function l(){return!!(i&&o)}async function u(e,t){let n=a(),{data:r,error:i}=await n.from("reports").insert({inputs:e,result:t}).select("report_id").single();if(i)throw Error(`Supabase Insert Failed: ${i.message}`);if(!r?.report_id)throw Error("Supabase Insert Failed: no report_id returned.");return r.report_id}async function c(e){let t=a(),{data:n,error:r}=await t.from("reports").select("inputs, result").eq("report_id",e).single();return r||!n?null:{inputs:n.inputs,result:n.result}}},26826:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,o=l(e),s=o[0],a=o[1],u=new i((s+a)*3/4-a),c=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[c++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(function(e,t,r){for(var i,o=[],s=t;s<r;s+=3)o.push(n[(i=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}(e,s,s+16383>a?a:s+16383));return 1===i?o.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&o.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),o.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)n[s]=o[s],r[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},47286:function(e,t,n){var r;!function(i){"use strict";var o,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,l=Math.floor,u="[BigNumber Error] ",c=u+"Number primitive has more than 15 significant digits: ",d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function p(e){var t=0|e;return e>0||e===t?t:t-1}function h(e){for(var t,n,r=1,i=e.length,o=e[0]+"";r<i;){for(n=14-(t=e[r++]+"").length;n--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function f(e,t){var n,r,i=e.c,o=t.c,s=e.s,a=t.s,l=e.e,u=t.e;if(!s||!a)return null;if(n=i&&!i[0],r=o&&!o[0],n||r)return n?r?0:-a:s;if(s!=a)return s;if(n=s<0,r=l==u,!i||!o)return r?0:!i^n?1:-1;if(!r)return l>u^n?1:-1;for(s=0,a=(l=i.length)<(u=o.length)?l:u;s<a;s++)if(i[s]!=o[s])return i[s]>o[s]^n?1:-1;return l==u?0:l>u^n?1:-1}function g(e,t,n,r){if(e<t||e>n||e!==l(e))throw Error(u+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function m(e){var t=e.c.length-1;return p(e.e/14)==t&&e.c[t]%2!=0}function y(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(r=e.length,++t>r){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}(o=function e(t){var n,r,i,o,E,_,A,T,S,b=L.prototype={constructor:L,toString:null,valueOf:null},C=new L(1),O=20,I=4,w=-7,R=21,N=-1e7,k=1e7,P=!1,x=1,U=0,D={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},M="0123456789abcdefghijklmnopqrstuvwxyz",j=!0;function L(e,t){var n,r,i,o,a,u,d,p,h=this;if(!(h instanceof L))return new L(e,t);if(null==t){if(e&&!0===e._isBigNumber){h.s=e.s,!e.c||e.e>k?h.c=h.e=null:e.e<N?h.c=[h.e=0]:(h.e=e.e,h.c=e.c.slice());return}if((u="number"==typeof e)&&0*e==0){if(h.s=1/e<0?(e=-e,-1):1,e===~~e){for(o=0,a=e;a>=10;a/=10,o++);o>k?h.c=h.e=null:(h.e=o,h.c=[e]);return}p=String(e)}else{if(!s.test(p=String(e)))return S(h,p,u);h.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(o=p.indexOf("."))>-1&&(p=p.replace(".","")),(a=p.search(/e/i))>0?(o<0&&(o=a),o+=+p.slice(a+1),p=p.substring(0,a)):o<0&&(o=p.length)}else{if(g(t,2,M.length,"Base"),10==t&&j)return H(h=new L(e),O+h.e+1,I);if(p=String(e),u="number"==typeof e){if(0*e!=0)return S(h,p,u,t);if(h.s=1/e<0?(p=p.slice(1),-1):1,L.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(c+e)}else h.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(n=M.slice(0,t),o=a=0,d=p.length;a<d;a++)if(0>n.indexOf(r=p.charAt(a))){if("."==r){if(a>o){o=d;continue}}else if(!i&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){i=!0,a=-1,o=0;continue}return S(h,String(e),u,t)}u=!1,(o=(p=T(p,t,10,h.s)).indexOf("."))>-1?p=p.replace(".",""):o=p.length}for(a=0;48===p.charCodeAt(a);a++);for(d=p.length;48===p.charCodeAt(--d););if(p=p.slice(a,++d)){if(d-=a,u&&L.DEBUG&&d>15&&(e>0x1fffffffffffff||e!==l(e)))throw Error(c+h.s*e);if((o=o-a-1)>k)h.c=h.e=null;else if(o<N)h.c=[h.e=0];else{if(h.e=o,h.c=[],a=(o+1)%14,o<0&&(a+=14),a<d){for(a&&h.c.push(+p.slice(0,a)),d-=14;a<d;)h.c.push(+p.slice(a,a+=14));a=14-(p=p.slice(a)).length}else a-=d;for(;a--;p+="0");h.c.push(+p)}}else h.c=[h.e=0]}function G(e,t,n,r){var i,o,s,a,l;if(null==n?n=I:g(n,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)l=h(e.c),l=1==r||2==r&&(s<=w||s>=R)?y(l,s):v(l,s,"0");else if(o=(e=H(new L(e),t,n)).e,a=(l=h(e.c)).length,1==r||2==r&&(t<=o||o<=w)){for(;a<t;l+="0",a++);l=y(l,o)}else if(t-=s+(2===r&&o>s),l=v(l,o,"0"),o+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=o-a)>0)for(o+1==a&&(l+=".");t--;l+="0");return e.s<0&&i?"-"+l:l}function F(e,t){for(var n,r,i=1,o=new L(e[0]);i<e.length;i++)(r=new L(e[i])).s&&(n=f(o,r))!==t&&(0!==n||o.s!==t)||(o=r);return o}function q(e,t,n){for(var r=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,r++);return(n=r+14*n-1)>k?e.c=e.e=null:n<N?e.c=[e.e=0]:(e.e=n,e.c=t),e}function H(e,t,n,r){var i,o,s,u,c,p,h,f=e.c;if(f){e:{for(i=1,u=f[0];u>=10;u/=10,i++);if((o=t-i)<0)o+=14,s=t,h=l((c=f[p=0])/d[i-s-1]%10);else if((p=a((o+1)/14))>=f.length){if(r){for(;f.length<=p;f.push(0));c=h=0,i=1,o%=14,s=o-14+1}else break e}else{for(i=1,c=u=f[p];u>=10;u/=10,i++);o%=14,h=(s=o-14+i)<0?0:l(c/d[i-s-1]%10)}if(r=r||t<0||null!=f[p+1]||(s<0?c:c%d[i-s-1]),r=n<4?(h||r)&&(0==n||n==(e.s<0?3:2)):h>5||5==h&&(4==n||r||6==n&&(o>0?s>0?c/d[i-s]:0:f[p-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,r?(t-=e.e+1,f[0]=d[(14-t%14)%14],e.e=-t||0):f[0]=e.e=0,e;if(0==o?(f.length=p,u=1,p--):(f.length=p+1,u=d[14-o],f[p]=s>0?l(c/d[i-s]%d[s])*u:0),r)for(;;){if(0==p){for(o=1,s=f[0];s>=10;s/=10,o++);for(s=f[0]+=u,u=1;s>=10;s/=10,u++);o!=u&&(e.e++,1e14==f[0]&&(f[0]=1));break}if(f[p]+=u,1e14!=f[p])break;f[p--]=0,u=1}for(o=f.length;0===f[--o];f.pop());}e.e>k?e.c=e.e=null:e.e<N&&(e.c=[e.e=0])}return e}function B(e){var t,n=e.e;return null===n?e.toString():(t=h(e.c),t=n<=w||n>=R?y(t,n):v(t,n,"0"),e.s<0?"-"+t:t)}return L.clone=e,L.ROUND_UP=0,L.ROUND_DOWN=1,L.ROUND_CEIL=2,L.ROUND_FLOOR=3,L.ROUND_HALF_UP=4,L.ROUND_HALF_DOWN=5,L.ROUND_HALF_EVEN=6,L.ROUND_HALF_CEIL=7,L.ROUND_HALF_FLOOR=8,L.EUCLID=9,L.config=L.set=function(e){var t,n;if(null!=e){if("object"==typeof e){if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(g(n=e[t],0,1e9,t),O=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(g(n=e[t],0,8,t),I=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(g(n[0],-1e9,0,t),g(n[1],0,1e9,t),w=n[0],R=n[1]):(g(n,-1e9,1e9,t),w=-(R=n<0?-n:n))),e.hasOwnProperty(t="RANGE")){if((n=e[t])&&n.pop)g(n[0],-1e9,-1,t),g(n[1],1,1e9,t),N=n[0],k=n[1];else if(g(n,-1e9,1e9,t),n)N=-(k=n<0?-n:n);else throw Error(u+t+" cannot be zero: "+n)}if(e.hasOwnProperty(t="CRYPTO")){if(!!(n=e[t])===n){if(n){if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))P=n;else throw P=!n,Error(u+"crypto unavailable")}else P=n}else throw Error(u+t+" not true or false: "+n)}if(e.hasOwnProperty(t="MODULO_MODE")&&(g(n=e[t],0,9,t),x=n),e.hasOwnProperty(t="POW_PRECISION")&&(g(n=e[t],0,1e9,t),U=n),e.hasOwnProperty(t="FORMAT")){if("object"==typeof(n=e[t]))D=n;else throw Error(u+t+" not an object: "+n)}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(u+t+" invalid: "+n);j="0123456789"==n.slice(0,10),M=n}}else throw Error(u+"Object expected: "+e)}return{DECIMAL_PLACES:O,ROUNDING_MODE:I,EXPONENTIAL_AT:[w,R],RANGE:[N,k],CRYPTO:P,MODULO_MODE:x,POW_PRECISION:U,FORMAT:D,ALPHABET:M}},L.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!L.DEBUG)return!0;var t,n,r=e.c,i=e.e,o=e.s;e:if("[object Array]"==({}).toString.call(r)){if((1===o||-1===o)&&i>=-1e9&&i<=1e9&&i===l(i)){if(0===r[0]){if(0===i&&1===r.length)return!0;break e}if((t=(i+1)%14)<1&&(t+=14),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=1e14||n!==l(n))break e;if(0!==n)return!0}}}else if(null===r&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(u+"Invalid BigNumber: "+e)},L.maximum=L.max=function(){return F(arguments,-1)},L.minimum=L.min=function(){return F(arguments,1)},L.random=(n=0x20000000000000*Math.random()&2097151?function(){return l(0x20000000000000*Math.random())}:function(){return(0x40000000*Math.random()|0)*8388608+(8388608*Math.random()|0)},function(e){var t,r,i,o,s,c=0,p=[],h=new L(C);if(null==e?e=O:g(e,0,1e9),o=a(e/14),P){if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));c<o;)(s=131072*t[c]+(t[c+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[c]=r[0],t[c+1]=r[1]):(p.push(s%1e14),c+=2);c=o/2}else if(crypto.randomBytes){for(t=crypto.randomBytes(o*=7);c<o;)(s=(31&t[c])*0x1000000000000+0x10000000000*t[c+1]+0x100000000*t[c+2]+0x1000000*t[c+3]+(t[c+4]<<16)+(t[c+5]<<8)+t[c+6])>=9e15?crypto.randomBytes(7).copy(t,c):(p.push(s%1e14),c+=7);c=o/7}else throw P=!1,Error(u+"crypto unavailable")}if(!P)for(;c<o;)(s=n())<9e15&&(p[c++]=s%1e14);for(o=p[--c],e%=14,o&&e&&(s=d[14-e],p[c]=l(o/s)*s);0===p[c];p.pop(),c--);if(c<0)p=[i=0];else{for(i=-1;0===p[0];p.splice(0,1),i-=14);for(c=1,s=p[0];s>=10;s/=10,c++);c<14&&(i-=14-c)}return h.e=i,h.c=p,h}),L.sum=function(){for(var e=1,t=arguments,n=new L(t[0]);e<t.length;)n=n.plus(t[e++]);return n},T=function(){var e="0123456789";function t(e,t,n,r){for(var i,o,s=[0],a=0,l=e.length;a<l;){for(o=s.length;o--;s[o]*=t);for(s[0]+=r.indexOf(e.charAt(a++)),i=0;i<s.length;i++)s[i]>n-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/n|0,s[i]%=n)}return s.reverse()}return function(n,r,i,o,s){var a,l,u,c,d,p,f,g,m=n.indexOf("."),y=O,E=I;for(m>=0&&(c=U,U=0,n=n.replace(".",""),p=(g=new L(r)).pow(n.length-m),U=c,g.c=t(v(h(p.c),p.e,"0"),10,i,e),g.e=g.c.length),u=c=(f=t(n,r,i,s?(a=M,e):(a=e,M))).length;0==f[--c];f.pop());if(!f[0])return a.charAt(0);if(m<0?--u:(p.c=f,p.e=u,p.s=o,f=(p=A(p,g,y,E,i)).c,d=p.r,u=p.e),m=f[l=u+y+1],c=i/2,d=d||l<0||null!=f[l+1],d=E<4?(null!=m||d)&&(0==E||E==(p.s<0?3:2)):m>c||m==c&&(4==E||d||6==E&&1&f[l-1]||E==(p.s<0?8:7)),l<1||!f[0])n=d?v(a.charAt(1),-y,a.charAt(0)):a.charAt(0);else{if(f.length=l,d)for(--i;++f[--l]>i;)f[l]=0,l||(++u,f=[1].concat(f));for(c=f.length;!f[--c];);for(m=0,n="";m<=c;n+=a.charAt(f[m++]));n=v(n,u,a.charAt(0))}return n}}(),A=function(){function e(e,t,n){var r,i,o,s,a=0,l=e.length,u=t%1e7,c=t/1e7|0;for(e=e.slice();l--;)r=c*(o=e[l]%1e7)+(s=e[l]/1e7|0)*u,a=((i=u*o+r%1e7*1e7+a)/n|0)+(r/1e7|0)+c*s,e[l]=i%n;return a&&(e=[a].concat(e)),e}function t(e,t,n,r){var i,o;if(n!=r)o=n>r?1:-1;else for(i=o=0;i<n;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,i,o,s,a){var u,c,d,h,f,g,m,y,v,E,_,A,T,S,b,C,O,I=r.s==i.s?1:-1,w=r.c,R=i.c;if(!w||!w[0]||!R||!R[0])return new L(r.s&&i.s&&(w?!R||w[0]!=R[0]:R)?w&&0==w[0]||!R?0*I:I/0:NaN);for(v=(y=new L(I)).c=[],I=o+(c=r.e-i.e)+1,a||(a=1e14,c=p(r.e/14)-p(i.e/14),I=I/14|0),d=0;R[d]==(w[d]||0);d++);if(R[d]>(w[d]||0)&&c--,I<0)v.push(1),h=!0;else{for(S=w.length,C=R.length,d=0,I+=2,(f=l(a/(R[0]+1)))>1&&(R=e(R,f,a),w=e(w,f,a),C=R.length,S=w.length),T=C,_=(E=w.slice(0,C)).length;_<C;E[_++]=0);O=[0].concat(O=R.slice()),b=R[0],R[1]>=a/2&&b++;do{if(f=0,(u=t(R,E,C,_))<0){if(A=E[0],C!=_&&(A=A*a+(E[1]||0)),(f=l(A/b))>1)for(f>=a&&(f=a-1),m=(g=e(R,f,a)).length,_=E.length;1==t(g,E,m,_);)f--,n(g,C<m?O:R,m,a),m=g.length,u=1;else 0==f&&(u=f=1),m=(g=R.slice()).length;if(m<_&&(g=[0].concat(g)),n(E,g,_,a),_=E.length,-1==u)for(;1>t(R,E,C,_);)f++,n(E,C<_?O:R,_,a),_=E.length}else 0===u&&(f++,E=[0]);v[d++]=f,E[0]?E[_++]=w[T]||0:(E=[w[T]],_=1)}while((T++<S||null!=E[0])&&I--);h=null!=E[0],v[0]||v.splice(0,1)}if(1e14==a){for(d=1,I=v[0];I>=10;I/=10,d++);H(y,o+(y.e=d+14*c-1)+1,s,h)}else y.e=c,y.r=+h;return y}}(),r=/^(-?)0([xbo])(?=\w[\w.]*$)/i,i=/^([^.]+)\.$/,o=/^\.([^.]+)$/,E=/^-?(Infinity|NaN)$/,_=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,n,s){var a,l=n?t:t.replace(_,"");if(E.test(l))e.s=isNaN(l)?null:l<0?-1:1;else{if(!n&&(l=l.replace(r,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,s&&s!=a?e:t}),s&&(a=s,l=l.replace(i,"$1").replace(o,"0.$1")),t!=l))return new L(l,a);if(L.DEBUG)throw Error(u+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},b.absoluteValue=b.abs=function(){var e=new L(this);return e.s<0&&(e.s=1),e},b.comparedTo=function(e,t){return f(this,new L(e,t))},b.decimalPlaces=b.dp=function(e,t){var n,r,i;if(null!=e)return g(e,0,1e9),null==t?t=I:g(t,0,8),H(new L(this),e+this.e+1,t);if(!(n=this.c))return null;if(r=((i=n.length-1)-p(this.e/14))*14,i=n[i])for(;i%10==0;i/=10,r--);return r<0&&(r=0),r},b.dividedBy=b.div=function(e,t){return A(this,new L(e,t),O,I)},b.dividedToIntegerBy=b.idiv=function(e,t){return A(this,new L(e,t),0,1)},b.exponentiatedBy=b.pow=function(e,t){var n,r,i,o,s,c,d,p,h,f=this;if((e=new L(e)).c&&!e.isInteger())throw Error(u+"Exponent not an integer: "+B(e));if(null!=t&&(t=new L(t)),c=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return h=new L(Math.pow(+B(f),c?e.s*(2-m(e)):+B(e))),t?h.mod(t):h;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new L(NaN);(r=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||c&&f.c[1]>=24e7:f.c[0]<8e13||c&&f.c[0]<=9999975e7)))return o=f.s<0&&m(e)?-0:0,f.e>-1&&(o=1/o),new L(d?1/o:o);U&&(o=a(U/14+2))}for(c?(n=new L(.5),d&&(e.s=1),p=m(e)):p=(i=Math.abs(+B(e)))%2,h=new L(C);;){if(p){if(!(h=h.times(f)).c)break;o?h.c.length>o&&(h.c.length=o):r&&(h=h.mod(t))}if(i){if(0===(i=l(i/2)))break;p=i%2}else if(H(e=e.times(n),e.e+1,1),e.e>14)p=m(e);else{if(0==(i=+B(e)))break;p=i%2}f=f.times(f),o?f.c&&f.c.length>o&&(f.c.length=o):r&&(f=f.mod(t))}return r?h:(d&&(h=C.div(h)),t?h.mod(t):o?H(h,U,I,s):h)},b.integerValue=function(e){var t=new L(this);return null==e?e=I:g(e,0,8),H(t,t.e+1,e)},b.isEqualTo=b.eq=function(e,t){return 0===f(this,new L(e,t))},b.isFinite=function(){return!!this.c},b.isGreaterThan=b.gt=function(e,t){return f(this,new L(e,t))>0},b.isGreaterThanOrEqualTo=b.gte=function(e,t){return 1===(t=f(this,new L(e,t)))||0===t},b.isInteger=function(){return!!this.c&&p(this.e/14)>this.c.length-2},b.isLessThan=b.lt=function(e,t){return 0>f(this,new L(e,t))},b.isLessThanOrEqualTo=b.lte=function(e,t){return -1===(t=f(this,new L(e,t)))||0===t},b.isNaN=function(){return!this.s},b.isNegative=function(){return this.s<0},b.isPositive=function(){return this.s>0},b.isZero=function(){return!!this.c&&0==this.c[0]},b.minus=function(e,t){var n,r,i,o,s=this.s;if(t=(e=new L(e,t)).s,!s||!t)return new L(NaN);if(s!=t)return e.s=-t,this.plus(e);var a=this.e/14,l=e.e/14,u=this.c,c=e.c;if(!a||!l){if(!u||!c)return u?(e.s=-t,e):new L(c?this:NaN);if(!u[0]||!c[0])return c[0]?(e.s=-t,e):new L(u[0]?this:3==I?-0:0)}if(a=p(a),l=p(l),u=u.slice(),s=a-l){for((o=s<0)?(s=-s,i=u):(l=a,i=c),i.reverse(),t=s;t--;i.push(0));i.reverse()}else for(r=(o=(s=u.length)<(t=c.length))?s:t,s=t=0;t<r;t++)if(u[t]!=c[t]){o=u[t]<c[t];break}if(o&&(i=u,u=c,c=i,e.s=-e.s),(t=(r=c.length)-(n=u.length))>0)for(;t--;u[n++]=0);for(t=1e14-1;r>s;){if(u[--r]<c[r]){for(n=r;n&&!u[--n];u[n]=t);--u[n],u[r]+=1e14}u[r]-=c[r]}for(;0==u[0];u.splice(0,1),--l);return u[0]?q(e,u,l):(e.s=3==I?-1:1,e.c=[e.e=0],e)},b.modulo=b.mod=function(e,t){var n,r;return(e=new L(e,t),this.c&&e.s&&(!e.c||e.c[0]))?e.c&&(!this.c||this.c[0])?(9==x?(r=e.s,e.s=1,n=A(this,e,0,3),e.s=r,n.s*=r):n=A(this,e,0,x),(e=this.minus(n.times(e))).c[0]||1!=x||(e.s=this.s),e):new L(this):new L(NaN)},b.multipliedBy=b.times=function(e,t){var n,r,i,o,s,a,l,u,c,d,h,f,g,m=this.c,y=(e=new L(e,t)).c;if(!m||!y||!m[0]||!y[0])return this.s&&e.s&&(!m||m[0]||y)&&(!y||y[0]||m)?(e.s*=this.s,m&&y?(e.c=[0],e.e=0):e.c=e.e=null):e.c=e.e=e.s=null,e;for(r=p(this.e/14)+p(e.e/14),e.s*=this.s,(l=m.length)<(d=y.length)&&(g=m,m=y,y=g,i=l,l=d,d=i),i=l+d,g=[];i--;g.push(0));for(i=d;--i>=0;){for(n=0,h=y[i]%1e7,f=y[i]/1e7|0,o=i+(s=l);o>i;)a=f*(u=m[--s]%1e7)+(c=m[s]/1e7|0)*h,n=((u=h*u+a%1e7*1e7+g[o]+n)/1e14|0)+(a/1e7|0)+f*c,g[o--]=u%1e14;g[o]=n}return n?++r:g.splice(0,1),q(e,g,r)},b.negated=function(){var e=new L(this);return e.s=-e.s||null,e},b.plus=function(e,t){var n,r=this.s;if(t=(e=new L(e,t)).s,!r||!t)return new L(NaN);if(r!=t)return e.s=-t,this.minus(e);var i=this.e/14,o=e.e/14,s=this.c,a=e.c;if(!i||!o){if(!s||!a)return new L(r/0);if(!s[0]||!a[0])return a[0]?e:new L(s[0]?this:0*r)}if(i=p(i),o=p(o),s=s.slice(),r=i-o){for(r>0?(o=i,n=a):(r=-r,n=s),n.reverse();r--;n.push(0));n.reverse()}for((r=s.length)-(t=a.length)<0&&(n=a,a=s,s=n,t=r),r=0;t;)r=(s[--t]=s[t]+a[t]+r)/1e14|0,s[t]=1e14===s[t]?0:s[t]%1e14;return r&&(s=[r].concat(s),++o),q(e,s,o)},b.precision=b.sd=function(e,t){var n,r,i;if(null!=e&&!!e!==e)return g(e,1,1e9),null==t?t=I:g(t,0,8),H(new L(this),e,t);if(!(n=this.c))return null;if(r=14*(i=n.length-1)+1,i=n[i]){for(;i%10==0;i/=10,r--);for(i=n[0];i>=10;i/=10,r++);}return e&&this.e+1>r&&(r=this.e+1),r},b.shiftedBy=function(e){return g(e,-0x1fffffffffffff,0x1fffffffffffff),this.times("1e"+e)},b.squareRoot=b.sqrt=function(){var e,t,n,r,i,o=this.c,s=this.s,a=this.e,l=O+4,u=new L("0.5");if(1!==s||!o||!o[0])return new L(!s||s<0&&(!o||o[0])?NaN:o?this:1/0);if(0==(s=Math.sqrt(+B(this)))||s==1/0?(((t=h(o)).length+a)%2==0&&(t+="0"),s=Math.sqrt(+t),a=p((a+1)/2)-(a<0||a%2),n=new L(t=s==1/0?"5e"+a:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+a)):n=new L(s+""),n.c[0]){for((s=(a=n.e)+l)<3&&(s=0);;)if(i=n,n=u.times(i.plus(A(this,i,l,1))),h(i.c).slice(0,s)===(t=h(n.c)).slice(0,s)){if(n.e<a&&--s,"9999"!=(t=t.slice(s-3,s+1))&&(r||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(H(n,n.e+O+2,1),e=!n.times(n).eq(this));break}if(!r&&(H(i,i.e+O+2,0),i.times(i).eq(this))){n=i;break}l+=4,s+=4,r=1}}return H(n,n.e+O+1,I,e)},b.toExponential=function(e,t){return null!=e&&(g(e,0,1e9),e++),G(this,e,t,1)},b.toFixed=function(e,t){return null!=e&&(g(e,0,1e9),e=e+this.e+1),G(this,e,t)},b.toFormat=function(e,t,n){var r;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=D;else if("object"!=typeof n)throw Error(u+"Argument not an object: "+n);if(r=this.toFixed(e,t),this.c){var i,o=r.split("."),s=+n.groupSize,a=+n.secondaryGroupSize,l=n.groupSeparator||"",c=o[0],d=o[1],p=this.s<0,h=p?c.slice(1):c,f=h.length;if(a&&(i=s,s=a,a=i,f-=i),s>0&&f>0){for(i=f%s||s,c=h.substr(0,i);i<f;i+=s)c+=l+h.substr(i,s);a>0&&(c+=l+h.slice(i)),p&&(c="-"+c)}r=d?c+(n.decimalSeparator||"")+((a=+n.fractionGroupSize)?d.replace(RegExp("\\d{"+a+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):d):c}return(n.prefix||"")+r+(n.suffix||"")},b.toFraction=function(e){var t,n,r,i,o,s,a,l,c,p,f,g,m=this.c;if(null!=e&&(!(a=new L(e)).isInteger()&&(a.c||1!==a.s)||a.lt(C)))throw Error(u+"Argument "+(a.isInteger()?"out of range: ":"not an integer: ")+B(a));if(!m)return new L(this);for(t=new L(C),c=n=new L(C),r=l=new L(C),g=h(m),o=t.e=g.length-this.e-1,t.c[0]=d[(s=o%14)<0?14+s:s],e=!e||a.comparedTo(t)>0?o>0?t:c:a,s=k,k=1/0,a=new L(g),l.c[0]=0;p=A(a,t,0,1),1!=(i=n.plus(p.times(r))).comparedTo(e);)n=r,r=i,c=l.plus(p.times(i=c)),l=i,t=a.minus(p.times(i=t)),a=i;return i=A(e.minus(n),r,0,1),l=l.plus(i.times(c)),n=n.plus(i.times(r)),l.s=c.s=this.s,o*=2,f=1>A(c,r,o,I).minus(this).abs().comparedTo(A(l,n,o,I).minus(this).abs())?[c,r]:[l,n],k=s,f},b.toNumber=function(){return+B(this)},b.toPrecision=function(e,t){return null!=e&&g(e,1,1e9),G(this,e,t,2)},b.toString=function(e){var t,n=this,r=n.s,i=n.e;return null===i?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=i<=w||i>=R?y(h(n.c),i):v(h(n.c),i,"0"):10===e&&j?t=v(h((n=H(new L(n),O+i+1,I)).c),n.e,"0"):(g(e,2,M.length,"Base"),t=T(v(h(n.c),i,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},b.valueOf=b.toJSON=function(){return B(this)},b._isBigNumber=!0,null!=t&&L.set(t),L}()).default=o.BigNumber=o,void 0!==(r=(function(){return o}).call(t,n,t,e))&&(e.exports=r)}(0)},24653:(e,t,n)=>{"use strict";var r=n(79428).Buffer,i=n(79428).SlowBuffer;function o(e,t){if(!r.isBuffer(e)||!r.isBuffer(t)||e.length!==t.length)return!1;for(var n=0,i=0;i<e.length;i++)n|=e[i]^t[i];return 0===n}e.exports=o,o.install=function(){r.prototype.equal=i.prototype.equal=function(e){return o(this,e)}};var s=r.prototype.equal,a=i.prototype.equal;o.restore=function(){r.prototype.equal=s,i.prototype.equal=a}},37846:(e,t,n)=>{"use strict";var r=n(95957).Buffer,i=n(82371);function o(e){if(r.isBuffer(e))return e;if("string"==typeof e)return r.from(e,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function s(e,t,n){for(var r=0;t+r<n&&0===e[t+r];)++r;return e[t+r]>=128&&--r,r}e.exports={derToJose:function(e,t){e=o(e);var n=i(t),s=n+1,a=e.length,l=0;if(48!==e[l++])throw Error('Could not find expected "seq"');var u=e[l++];if(129===u&&(u=e[l++]),a-l<u)throw Error('"seq" specified length of "'+u+'", only "'+(a-l)+'" remaining');if(2!==e[l++])throw Error('Could not find expected "int" for "r"');var c=e[l++];if(a-l-2<c)throw Error('"r" specified length of "'+c+'", only "'+(a-l-2)+'" available');if(s<c)throw Error('"r" specified length of "'+c+'", max of "'+s+'" is acceptable');var d=l;if(l+=c,2!==e[l++])throw Error('Could not find expected "int" for "s"');var p=e[l++];if(a-l!==p)throw Error('"s" specified length of "'+p+'", expected "'+(a-l)+'"');if(s<p)throw Error('"s" specified length of "'+p+'", max of "'+s+'" is acceptable');var h=l;if((l+=p)!==a)throw Error('Expected to consume entire buffer, but "'+(a-l)+'" bytes remain');var f=n-c,g=n-p,m=r.allocUnsafe(f+c+g+p);for(l=0;l<f;++l)m[l]=0;e.copy(m,l,d+Math.max(-f,0),d+c),l=n;for(var y=l;l<y+g;++l)m[l]=0;return e.copy(m,l,h+Math.max(-g,0),h+p),m=(m=m.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=o(e);var n=i(t),a=e.length;if(a!==2*n)throw TypeError('"'+t+'" signatures must be "'+2*n+'" bytes, saw "'+a+'"');var l=s(e,0,n),u=s(e,n,e.length),c=n-l,d=n-u,p=2+c+1+1+d,h=p<128,f=r.allocUnsafe((h?2:3)+p),g=0;return f[g++]=48,h?f[g++]=p:(f[g++]=129,f[g++]=255&p),f[g++]=2,f[g++]=c,l<0?(f[g++]=0,g+=e.copy(f,g,0,n)):g+=e.copy(f,g,l,n),f[g++]=2,f[g++]=d,u<0?(f[g++]=0,e.copy(f,g,n)):e.copy(f,g,n+u),f}}},82371:e=>{"use strict";function t(e){return(e/8|0)+(e%8==0?0:1)}var n={ES256:t(256),ES384:t(384),ES512:t(521)};e.exports=function(e){var t=n[e];if(t)return t;throw Error('Unknown algorithm "'+e+'"')}},72449:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},s=function(e){if(!e||"[object Object]"!==n.call(e))return!1;var r,i=t.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!i&&!o)return!1;for(r in e);return void 0===r||t.call(e,r)},a=function(e,t){r&&"__proto__"===t.name?r(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,n){if("__proto__"===n){if(!t.call(e,n))return;if(i)return i(e,n).value}return e[n]};e.exports=function e(){var t,n,r,i,u,c,d=arguments[0],p=1,h=arguments.length,f=!1;for("boolean"==typeof d&&(f=d,d=arguments[1]||{},p=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});p<h;++p)if(t=arguments[p],null!=t)for(n in t)r=l(d,n),d!==(i=l(t,n))&&(f&&i&&(s(i)||(u=o(i)))?(u?(u=!1,c=r&&o(r)?r:[]):c=r&&s(r)?r:{},a(d,{name:n,newValue:e(f,c,i)})):void 0!==i&&a(d,{name:n,newValue:i}));return d}},12462:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosError=t.GAXIOS_ERROR_SYMBOL=void 0,t.defaultErrorRedactor=function e(t){let n="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function r(e){e&&e.forEach((t,r)=>{(/^authentication$/i.test(r)||/^authorization$/i.test(r)||/secret/i.test(r))&&e.set(r,n)})}function i(e,t){if("object"==typeof e&&null!==e&&"string"==typeof e[t]){let r=e[t];(/grant_type=/i.test(r)||/assertion=/i.test(r)||/secret/i.test(r))&&(e[t]=n)}}function o(e){e&&"object"==typeof e&&(e instanceof FormData||e instanceof URLSearchParams||"forEach"in e&&"set"in e?e.forEach((t,r)=>{(["grant_type","assertion"].includes(r)||/secret/.test(r))&&e.set(r,n)}):("grant_type"in e&&(e.grant_type=n),"assertion"in e&&(e.assertion=n),"client_secret"in e&&(e.client_secret=n)))}return t.config&&(r(t.config.headers),i(t.config,"data"),o(t.config.data),i(t.config,"body"),o(t.config.body),t.config.url.searchParams.has("token")&&t.config.url.searchParams.set("token",n),t.config.url.searchParams.has("client_secret")&&t.config.url.searchParams.set("client_secret",n)),t.response&&(e({config:t.response.config}),r(t.response.headers),t.response.bodyUsed&&(i(t.response,"data"),o(t.response.data))),t};let i=r(n(72449)),o=r(n(83720)).default.pkg;t.GAXIOS_ERROR_SYMBOL=Symbol.for(`${o.name}-gaxios-error`);class s extends Error{config;response;code;status;error;[t.GAXIOS_ERROR_SYMBOL]=o.version;static[Symbol.hasInstance](e){return!!e&&"object"==typeof e&&t.GAXIOS_ERROR_SYMBOL in e&&e[t.GAXIOS_ERROR_SYMBOL]===o.version||Function.prototype[Symbol.hasInstance].call(s,e)}constructor(e,t,n,r){if(super(e,{cause:r}),this.config=t,this.response=n,this.error=r instanceof Error?r:void 0,this.config=(0,i.default)(!0,{},t),this.response&&(this.response.config=(0,i.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(e,t){switch(e){case"stream":default:return t;case"json":return JSON.parse(JSON.stringify(t));case"arraybuffer":return JSON.parse(Buffer.from(t).toString("utf8"));case"blob":return JSON.parse(t.text())}}(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}r instanceof DOMException?this.code=r.name:r&&"object"==typeof r&&"code"in r&&("string"==typeof r.code||"number"==typeof r.code)&&(this.code=r.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let n=t;if("string"==typeof e.data&&(n=e.data),e.data&&"object"==typeof e.data&&"error"in e.data&&e.data.error&&!e.ok){if("string"==typeof e.data.error)return{message:e.data.error,code:e.status,status:e.statusText};if("object"==typeof e.data.error){n="message"in e.data.error&&"string"==typeof e.data.error.message?e.data.error.message:n;let t="status"in e.data.error&&"string"==typeof e.data.error.status?e.data.error.status:e.statusText,r="code"in e.data.error&&"number"==typeof e.data.error.code?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let i=[];for(let t of e.data.error.errors)"object"==typeof t&&"message"in t&&"string"==typeof t.message&&i.push(t.message);return Object.assign({message:i.join("\n")||n,code:r,status:t},e.data.error)}return Object.assign({message:n,code:r,status:t},e.data.error)}}return{message:n,code:e.status,status:e.statusText}}}t.GaxiosError=s},94470:function(e,t,n){"use strict";var r,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Gaxios=void 0;let o=i(n(72449)),s=n(55591),a=n(12462),l=n(9773),u=n(27910),c=n(20592),d=async()=>globalThis.crypto?.randomUUID()||(await Promise.resolve().then(n.t.bind(n,55511,23))).randomUUID();class p{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new c.GaxiosInterceptorManager,response:new c.GaxiosInterceptorManager}}fetch(...e){let t;let n=e[0],i=e[1],o=new Headers;return("string"==typeof n?t=new URL(n):n instanceof URL?t=n:n&&n.url&&(t=new URL(n.url)),n&&"object"==typeof n&&"headers"in n&&r.mergeHeaders(o,n.headers),i&&r.mergeHeaders(o,new Headers(i.headers)),"object"!=typeof n||n instanceof URL)?this.request({...i,headers:o,url:t}):this.request({...i,...n,headers:o,url:t})}async request(e={}){let t=await this.#e(e);return t=await this.#t(t),this.#n(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await r.#r(),n={...e};delete n.data;let i=await t(e.url,n),o=await this.getResponseData(e,i);return Object.getOwnPropertyDescriptor(i,"data")?.configurable||Object.defineProperties(i,{data:{configurable:!0,writable:!0,enumerable:!0,value:o}}),Object.assign(i,{config:e,data:o})}async _request(e){try{let t;if(t=e.adapter?await e.adapter(e,this._defaultAdapter.bind(this)):await this._defaultAdapter(e),!e.validateStatus(t.status)){if("stream"===e.responseType){let e=[];for await(let n of t.data)e.push(n);t.data=e.toString()}let n=a.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new a.GaxiosError(n?.message,e,t,n)}return t}catch(i){let t;t=i instanceof a.GaxiosError?i:i instanceof Error?new a.GaxiosError(i.message,e,void 0,i):new a.GaxiosError("Unexpected Gaxios Error",e,void 0,i);let{shouldRetry:n,config:r}=await (0,l.getRetryConfig)(t);if(n&&r)return t.config.retryConfig.currentRetryAttempt=r.retryConfig.currentRetryAttempt,e.retryConfig=t.config?.retryConfig,this.#i(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(t),t}}async getResponseData(e,t){if(204===t.status)return"";if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new a.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":{let e=await t.text();try{return JSON.parse(e)}catch{return e}}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#o(e,t=[]){let n=new URL(e),r=[...t];for(let e of(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[])r.push(e.trim());for(let e of r)if(e instanceof RegExp){if(e.test(n.toString()))return!1}else if(e instanceof URL){if(e.origin===n.origin)return!1}else if(e.startsWith("*.")||e.startsWith(".")){let t=e.replace(/^\*\./,".");if(n.hostname.endsWith(t))return!1}else if(e===n.origin||e===n.hostname||e===n.href)return!1;return!0}async #t(e){let t=Promise.resolve(e);for(let e of this.interceptors.request.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #n(e){let t=Promise.resolve(e);for(let e of this.interceptors.response.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #e(e){let t=new Headers(this.defaults.headers);r.mergeHeaders(t,e.headers);let n=(0,o.default)(!0,{},this.defaults,e);if(!n.url)throw Error("URL is required.");if(n.baseURL&&(n.url=new URL(n.url,n.baseURL)),n.url=new URL(n.url),n.params){if(n.paramsSerializer){let e=n.paramsSerializer(n.params);e.startsWith("?")&&(e=e.slice(1));let t=n.url.toString().includes("?")?"&":"?";n.url=n.url+t+e}else{let e=n.url instanceof URL?n.url:new URL(n.url);for(let[t,r]of new URLSearchParams(n.params))e.searchParams.append(t,r);n.url=e}}"number"==typeof e.maxContentLength&&(n.size=e.maxContentLength),"number"==typeof e.maxRedirects&&(n.follow=e.maxRedirects);let i="string"==typeof n.data||n.data instanceof ArrayBuffer||n.data instanceof Blob||globalThis.File&&n.data instanceof File||n.data instanceof FormData||n.data instanceof u.Readable||n.data instanceof ReadableStream||n.data instanceof String||n.data instanceof URLSearchParams||ArrayBuffer.isView(n.data)||["Blob","File","FormData"].includes(n.data?.constructor?.name||"");if(n.multipart?.length){let e=await d();t.set("content-type",`multipart/related; boundary=${e}`),n.body=u.Readable.from(this.getMultipartRequest(n.multipart,e))}else i?n.body=n.data:"object"==typeof n.data?"application/x-www-form-urlencoded"===t.get("Content-Type")?n.body=n.paramsSerializer?n.paramsSerializer(n.data):new URLSearchParams(n.data):(t.has("content-type")||t.set("content-type","application/json"),n.body=JSON.stringify(n.data)):n.data&&(n.body=n.data);n.validateStatus=n.validateStatus||this.validateStatus,n.responseType=n.responseType||"unknown",t.has("accept")||"json"!==n.responseType||t.set("accept","application/json");let l=n.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(n.agent);else if(l&&this.#o(n.url,n.noProxy)){let e=await r.#s();this.agentCache.has(l)?n.agent=this.agentCache.get(l):(n.agent=new e(l,{cert:n.cert,key:n.key}),this.agentCache.set(l,n.agent))}else n.cert&&n.key&&(this.agentCache.has(n.key)?n.agent=this.agentCache.get(n.key):(n.agent=new s.Agent({cert:n.cert,key:n.key}),this.agentCache.set(n.key,n.agent)));return"function"!=typeof n.errorRedactor&&!1!==n.errorRedactor&&(n.errorRedactor=a.defaultErrorRedactor),!n.body||"duplex"in n||(n.duplex="half"),this.#i(n),Object.assign(n,{headers:t,url:n.url instanceof URL?n.url:new URL(n.url)})}#i(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(null===t)return e.text();if((t=t.toLowerCase()).includes("application/json")){let t=await e.text();try{t=JSON.parse(t)}catch{}return t}return t.match(/^text\//)?e.text():e.blob()}async *getMultipartRequest(e,t){let n=`--${t}--`;for(let n of e){let e=n.headers.get("Content-Type")||"application/octet-stream",r=`--${t}\r
Content-Type: ${e}\r
\r
`;yield r,"string"==typeof n.content?yield n.content:yield*n.content,yield"\r\n"}yield n}static #a;static #l;static async #s(){return this.#a||=(await n.e(784).then(n.t.bind(n,47784,23))).HttpsProxyAgent,this.#a}static async #r(){let e="undefined"!=typeof window&&!!window;return this.#l||=e?window.fetch:(await n.e(302).then(n.bind(n,90302))).default,this.#l}static mergeHeaders(e,...t){for(let n of(e=e instanceof Headers?e:new Headers(e),t))(n instanceof Headers?n:new Headers(n)).forEach((t,n)=>{"set-cookie"===n?e.append(n,t):e.set(n,t)});return e}}t.Gaxios=p,r=p},69919:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.instance=t.Gaxios=t.GaxiosError=void 0,t.request=a;let o=n(94470);Object.defineProperty(t,"Gaxios",{enumerable:!0,get:function(){return o.Gaxios}});var s=n(12462);async function a(e){return t.instance.request(e)}Object.defineProperty(t,"GaxiosError",{enumerable:!0,get:function(){return s.GaxiosError}}),i(n(20592),t),t.instance=new o.Gaxios},20592:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosInterceptorManager=void 0;class n extends Set{}t.GaxiosInterceptorManager=n},9773:(e,t)=>{"use strict";async function n(e){var t;let n=i(e);if(!e||!e.config||!n&&!e.config.retry)return{shouldRetry:!1};(n=n||{}).currentRetryAttempt=n.currentRetryAttempt||0,n.retry=void 0===n.retry||null===n.retry?3:n.retry,n.httpMethodsToRetry=n.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],n.noResponseRetries=void 0===n.noResponseRetries||null===n.noResponseRetries?2:n.noResponseRetries,n.retryDelayMultiplier=n.retryDelayMultiplier?n.retryDelayMultiplier:2,n.timeOfFirstRequest=n.timeOfFirstRequest?n.timeOfFirstRequest:Date.now(),n.totalTimeout=n.totalTimeout?n.totalTimeout:Number.MAX_SAFE_INTEGER,n.maxRetryDelay=n.maxRetryDelay?n.maxRetryDelay:Number.MAX_SAFE_INTEGER,n.statusCodesToRetry=n.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],e.config.retryConfig=n;let o=n.shouldRetry||r;if(!await o(e))return{shouldRetry:!1,config:e.config};let s=Math.min(((t=n).currentRetryAttempt?0:t.retryDelay??100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,t.totalTimeout-(Date.now()-t.timeOfFirstRequest),t.maxRetryDelay);e.config.retryConfig.currentRetryAttempt+=1;let a=n.retryBackoff?n.retryBackoff(e,s):new Promise(e=>{setTimeout(e,s)});return n.onRetryAttempt&&await n.onRetryAttempt(e),await a,{shouldRetry:!0,config:e.config}}function r(e){let t=i(e);if(e.config.signal?.aborted&&"TimeoutError"!==e.code||"AbortError"===e.code||!t||0===t.retry||!e.response&&(t.currentRetryAttempt||0)>=t.noResponseRetries||!t.httpMethodsToRetry||!t.httpMethodsToRetry.includes(e.config.method?.toUpperCase()||"GET"))return!1;if(e.response&&e.response.status){let n=!1;for(let[r,i]of t.statusCodesToRetry){let t=e.response.status;if(t>=r&&t<=i){n=!0;break}}if(!n)return!1}return t.currentRetryAttempt=t.currentRetryAttempt||0,!(t.currentRetryAttempt>=t.retry)}function i(e){if(e&&e.config&&e.config.retryConfig)return e.config.retryConfig}Object.defineProperty(t,"__esModule",{value:!0}),t.getRetryConfig=n},39321:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthClient=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=t.DEFAULT_UNIVERSE=void 0;let r=n(94735),i=n(69919),o=n(92647),s=n(58592),a=n(56759);t.DEFAULT_UNIVERSE="googleapis.com",t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class l extends r.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=t.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let n=(0,o.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=n.get("project_id")??null,this.quotaProjectId=n.get("quota_project_id"),this.credentials=n.get("credentials")??{},this.universeDomain=n.get("universe_domain")??t.DEFAULT_UNIVERSE,this.transporter=e.transporter??new i.Gaxios(e.transporterOptions),!1!==n.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(l.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(l.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t;let n=e[0],r=e[1],o=new Headers;return("string"==typeof n?t=new URL(n):n instanceof URL?t=n:n&&n.url&&(t=new URL(n.url)),n&&"object"==typeof n&&"headers"in n&&i.Gaxios.mergeHeaders(o,n.headers),r&&i.Gaxios.mergeHeaders(o,new Headers(r.headers)),"object"!=typeof n||n instanceof URL)?this.request({...r,headers:o,url:t}):this.request({...r,...n,headers:o,url:t})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let n=t.get("x-goog-user-project"),r=t.get("authorization");return n&&e.set("x-goog-user-project",n),r&&e.set("authorization",r),e}static log=(0,s.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let t=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${t}`)}let t=e.headers.get("User-Agent");t?t.includes(`${a.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${a.USER_AGENT}`):e.headers.set("User-Agent",a.USER_AGENT);try{let t=e[l.RequestMethodNameSymbol],n=`${Math.floor(1e3*Math.random())}`;e[l.RequestLogIdSymbol]=n;let r={url:e.url,headers:e.headers};t?l.log.info("%s [%s] request %j",t,n,r):l.log.info("[%s] request %j",n,r)}catch(e){}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,n=t[l.RequestMethodNameSymbol],r=t[l.RequestLogIdSymbol];n?l.log.info("%s [%s] response %j",n,r,e.data):l.log.info("[%s] response %j",r,e.data)}catch(e){}return e},rejected:async e=>{try{let t=e.config,n=t[l.RequestMethodNameSymbol],r=t[l.RequestLogIdSymbol];n?l.log.info("%s [%s] error %j",n,r,e.response?.data):l.log.error("[%s] error %j",r,e.response?.data)}catch(e){}throw e}};static setMethodName(e,t){try{e[l.RequestMethodNameSymbol]=t}catch(e){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.AuthClient=l},65892:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsClient=void 0;let r=n(85772),i=n(64489),o=n(26008),s=n(92647),a=n(69919);class l extends i.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #u="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let t=(0,s.originalOrCamelOptions)(e),n=t.get("credential_source"),r=t.get("aws_security_credentials_supplier");if(!n&&!r)throw Error("A credential source or AWS security credentials supplier must be specified.");if(n&&r)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(r)this.awsSecurityCredentialsSupplier=r,this.regionalCredVerificationUrl=l.#u,this.credentialSourceType="programmatic";else{let e=(0,s.originalOrCamelOptions)(n);this.environmentId=e.get("environment_id");let t=e.get("region_url"),r=e.get("url"),i=e.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new o.DefaultAwsSecurityCredentialsSupplier({regionUrl:t,securityCredentialsUrl:r,imdsV2SessionTokenUrl:i}),this.regionalCredVerificationUrl=e.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(e&&this.regionalCredVerificationUrl){if(1!==parseInt(e[2],10))throw Error(`aws version "${e[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new r.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...l.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return a.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((e,n)=>t.push({key:n,value:e})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}}t.AwsClient=l},85772:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsRequestSigner=void 0;let r=n(69919),i=n(7164),o="AWS4-HMAC-SHA256";class s{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,i.createCrypto)()}async getRequestOptions(e){if(!e.url)throw RangeError('"url" is required in "amzOptions"');let t="object"==typeof e.data?JSON.stringify(e.data):e.data,n=e.url,i=e.method||"GET",o=e.body||t,s=e.headers,a=await this.getCredentials(),l=new URL(n);if("string"!=typeof o&&void 0!==o)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${o}`);let c=await u({crypto:this.crypto,host:l.host,canonicalUri:l.pathname,canonicalQuerystring:l.search.slice(1),method:i,region:this.region,securityCredentials:a,requestPayload:o,additionalAmzHeaders:s}),d=r.Gaxios.mergeHeaders(c.amzDate?{"x-amz-date":c.amzDate}:{},{authorization:c.authorizationHeader,host:l.host},s||{});a.token&&r.Gaxios.mergeHeaders(d,{"x-amz-security-token":a.token});let p={url:n,method:i,headers:d};return void 0!==o&&(p.body=o),p}}async function a(e,t,n){return await e.signWithHmacSha256(t,n)}async function l(e,t,n,r,i){let o=await a(e,`AWS4${t}`,n),s=await a(e,o,r),l=await a(e,s,i);return await a(e,l,"aws4_request")}async function u(e){let t=r.Gaxios.mergeHeaders(e.additionalAmzHeaders),n=e.requestPayload||"",s=e.host.split(".")[0],u=new Date,c=u.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),d=u.toISOString().replace(/[-]/g,"").replace(/T.*/,"");e.securityCredentials.token&&t.set("x-amz-security-token",e.securityCredentials.token);let p=r.Gaxios.mergeHeaders({host:e.host},t.has("date")?{}:{"x-amz-date":c},t),h="",f=[...p.keys()].sort();f.forEach(e=>{h+=`${e}:${p.get(e)}
`});let g=f.join(";"),m=await e.crypto.sha256DigestHex(n),y=`${e.method.toUpperCase()}
${e.canonicalUri}
${e.canonicalQuerystring}
${h}
${g}
${m}`,v=`${d}/${e.region}/${s}/aws4_request`,E=`${o}
${c}
${v}
`+await e.crypto.sha256DigestHex(y),_=await l(e.crypto,e.securityCredentials.secretAccessKey,d,e.region,s),A=await a(e.crypto,_,E),T=`${o} Credential=${e.securityCredentials.accessKeyId}/${v}, SignedHeaders=${g}, Signature=${(0,i.fromArrayBufferToHex)(A)}`;return{amzDate:t.has("date")?void 0:c,authorizationHeader:T,canonicalQuerystring:e.canonicalQuerystring}}t.AwsRequestSigner=s},64489:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExternalAccountClient=t.CLOUD_RESOURCE_MANAGER=t.EXTERNAL_ACCOUNT_TYPE=t.EXPIRATION_TIME_OFFSET=void 0;let r=n(69919),i=n(27910),o=n(39321),s=n(69534),a=n(92647),l=n(56759),u="https://www.googleapis.com/auth/cloud-platform";t.EXPIRATION_TIME_OFFSET=3e5,t.EXTERNAL_ACCOUNT_TYPE="external_account",t.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class c extends o.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#c=null;constructor(e){super(e);let n=(0,a.originalOrCamelOptions)(e),r=n.get("type");if(r&&r!==t.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${t.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let i=n.get("client_id"),o=n.get("client_secret");this.tokenUrl=n.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);let l=n.get("subject_token_type"),c=n.get("workforce_pool_user_project"),d=n.get("service_account_impersonation_url"),p=n.get("service_account_impersonation"),h=(0,a.originalOrCamelOptions)(p).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(n.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),i&&(this.clientAuth={confidentialClientType:"basic",clientId:i,clientSecret:o}),this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=n.get("scopes")||[u],this.cachedAccessToken=null,this.audience=n.get("audience"),this.subjectTokenType=l,this.workforcePoolUserProject=c;let f=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(f))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=h,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let e=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return e?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),n={...c.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};o.AuthClient.setMethodName(n,"getProjectId");let r=await this.transporter.request(n);return this.projectId=r.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=r.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,o=n.config.data instanceof i.Readable;if(!t&&(401===r||403===r)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){this.#c=this.#c||this.#d();try{return await this.#c}finally{this.#c=null}}async #d(){let e=await this.retrieveSubjectToken(),t={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[u]:this.getScopesArray()},n=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,r=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),i=await this.stsCredential.exchangeToken(t,r,n);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(i.access_token):i.expires_in?this.cachedAccessToken={access_token:i.access_token,expiry_date:new Date().getTime()+1e3*i.expires_in,res:i.res}:this.cachedAccessToken={access_token:i.access_token,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...c.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};o.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let n=await this.transporter.request(t),r=n.data;return{access_token:r.accessToken,expiry_date:new Date(r.expireTime).getTime(),res:n}}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[u]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=void 0!==this.serviceAccountImpersonationUrl,n=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${l.pkg.version} google-byoid-sdk source/${n} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}t.BaseExternalAccountClient=c},31268:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CertificateSubjectTokenSupplier=t.InvalidConfigurationError=t.CertificateSourceUnavailableError=t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let r=n(92647),i=n(29021),o=n(55511),s=n(55591);t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class a extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}}t.CertificateSourceUnavailableError=a;class l extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}}t.InvalidConfigurationError=l;class u{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new l("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new l("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new l("Cannot create mTLS Agent with missing certificate or key");return new s.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#p();let{certPath:e,keyPath:t}=await this.#h();return{cert:this.cert,key:this.key}=await this.#f(e,t),await this.#g(this.cert)}async #p(){let e=this.certificateConfigPath;if(e){if(await (0,r.isValidFile)(e))return e;throw new a(`Provided certificate config path is invalid: ${e}`)}let n=process.env[t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(n){if(await (0,r.isValidFile)(n))return n;throw new a(`Path from environment variable "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${n}`)}let i=(0,r.getWellKnownCertificateConfigFileLocation)();if(await (0,r.isValidFile)(i))return i;throw new a(`Could not find certificate configuration file. Searched override path, the "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${i}).`)}async #h(){let e;let t=this.certificateConfigPath;try{e=await i.promises.readFile(t,"utf8")}catch(e){throw new a(`Failed to read certificate config file at: ${t}`)}try{let n=JSON.parse(e),r=n?.cert_configs?.workload?.cert_path,i=n?.cert_configs?.workload?.key_path;if(!r||!i)throw new l(`Certificate config file (${t}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:r,keyPath:i}}catch(e){if(e instanceof l)throw e;throw new l(`Failed to parse certificate config from ${t}: ${e.message}`)}}async #f(e,t){let n,r;try{n=await i.promises.readFile(e),new o.X509Certificate(n)}catch(n){let t=n instanceof Error?n.message:String(n);throw new a(`Failed to read certificate file at ${e}: ${t}`)}try{r=await i.promises.readFile(t),(0,o.createPrivateKey)(r)}catch(n){let e=n instanceof Error?n.message:String(n);throw new a(`Failed to read private key file at ${t}: ${e}`)}return{cert:n,key:r}}async #g(e){let t=new o.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let e;let n=((await i.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((e,t)=>{try{return new o.X509Certificate(e)}catch(n){let e=n instanceof Error?n.message:String(n);throw new l(`Failed to parse certificate at index ${t} in trust chain file ${this.trustChainPath}: ${e}`)}}),r=n.findIndex(e=>t.raw.equals(e.raw));if(-1===r)e=[t,...n];else if(0===r)e=n;else throw new l(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${r}).`);return JSON.stringify(e.map(e=>e.raw.toString("base64")))}catch(t){if(t instanceof l)throw t;let e=t instanceof Error?t.message:String(t);throw new a(`Failed to process certificate chain from ${this.trustChainPath}: ${e}`)}}}t.CertificateSubjectTokenSupplier=u},73040:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Compute=void 0;let r=n(69919),i=n(63263),o=n(84700);class s extends o.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e;let t=`service-accounts/${this.serviceAccountEmail}/token`;try{let n={property:t};this.scopes.length>0&&(n.params={scopes:this.scopes.join(",")}),e=await i.instance(n)}catch(e){throw e instanceof r.GaxiosError&&(e.message=`Could not refresh access token: ${e.message}`,this.wrapError(e)),e}let n=e;return e&&e.expires_in&&(n.expiry_date=new Date().getTime()+1e3*e.expires_in,delete n.expires_in),this.emit("tokens",n),{tokens:n,res:null}}async fetchIdToken(e){let t;let n=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`;try{t=await i.instance({property:n})}catch(e){throw e instanceof Error&&(e.message=`Could not fetch ID token: ${e.message}`),e}return t}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,403===t.status?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:404===t.status&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}}t.Compute=s},26008:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultAwsSecurityCredentialsSupplier=void 0;let r=n(39321);class i{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#m)return this.#m;let t=new Headers;if(!this.#m&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let n={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};r.AuthClient.setMethodName(n,"getAwsRegion");let i=await e.transporter.request(n);return i.data.substr(0,i.data.length-1)}async getAwsSecurityCredentials(e){if(this.#v)return this.#v;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter));let n=await this.#E(t,e.transporter),r=await this.#_(n,t,e.transporter);return{accessKeyId:r.AccessKeyId,secretAccessKey:r.SecretAccessKey,token:r.Token}}async #y(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return r.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async #E(e,t){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let n={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return r.AuthClient.setMethodName(n,"#getAwsRoleName"),(await t.request(n)).data}async #_(e,t,n){let i={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return r.AuthClient.setMethodName(i,"#retrieveAwsSecurityCredentials"),(await n.request(i)).data}get #m(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #v(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}t.DefaultAwsSecurityCredentialsSupplier=i},41111:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownscopedClient=t.EXPIRATION_TIME_OFFSET=t.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let r=n(69919),i=n(27910),o=n(39321),s=n(69534);t.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,t.EXPIRATION_TIME_OFFSET=3e5;class a extends o.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,n={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof o.AuthClient?{}:e),e instanceof o.AuthClient?(this.authClient=e,this.credentialAccessBoundary=n):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>t.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${t.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let e of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===e.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=r.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,o=n.config.data instanceof i.Readable;if(!t&&(401===r||403===r)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),n=this.authClient.credentials?.expiry_date||null,r=t.expires_in?new Date().getTime()+1e3*t.expires_in:n;return this.cachedDownscopedAccessToken={access_token:t.access_token,expiry_date:r,res:t.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.DownscopedClient=a},94102:(e,t,n)=>{"use strict";var r;let i;Object.defineProperty(t,"__esModule",{value:!0}),t.GCPEnv=void 0,t.clear=function(){i=void 0},t.getEnv=s;let o=n(63263);async function s(){return i||(i=a())}async function a(){return r.NONE,process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?r.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?r.CLOUD_FUNCTIONS:await u()?await l()?r.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?r.CLOUD_RUN:process.env.CLOUD_RUN_JOB?r.CLOUD_RUN_JOBS:r.COMPUTE_ENGINE:r.NONE}async function l(){try{return await o.instance("attributes/cluster-name"),!0}catch(e){return!1}}async function u(){return o.isAvailable()}!function(e){e.APP_ENGINE="APP_ENGINE",e.KUBERNETES_ENGINE="KUBERNETES_ENGINE",e.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",e.COMPUTE_ENGINE="COMPUTE_ENGINE",e.CLOUD_RUN="CLOUD_RUN",e.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",e.NONE="NONE"}(r||(t.GCPEnv=r={}))},79082:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidSubjectTokenError=t.InvalidMessageFieldError=t.InvalidCodeFieldError=t.InvalidTokenTypeFieldError=t.InvalidExpirationTimeFieldError=t.InvalidSuccessFieldError=t.InvalidVersionFieldError=t.ExecutableResponseError=t.ExecutableResponse=void 0;let n="urn:ietf:params:oauth:token-type:saml2",r="urn:ietf:params:oauth:token-type:id_token",i="urn:ietf:params:oauth:token-type:jwt";class o{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new a("Executable response must contain a 'version' field.");if(void 0===e.success)throw new l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==n&&this.tokenType!==r&&this.tokenType!==i)throw new c(`Executable response must contain a 'token_type' field when successful and it must be one of ${r}, ${i}, or ${n}.`);if(this.tokenType===n){if(!e.saml_response)throw new h(`Executable response must contain a 'saml_response' field when token_type=${n}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new h(`Executable response must contain a 'id_token' field when token_type=${r} or ${i}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new d("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new p("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}}t.ExecutableResponse=o;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableResponseError=s;class a extends s{}t.InvalidVersionFieldError=a;class l extends s{}t.InvalidSuccessFieldError=l;class u extends s{}t.InvalidExpirationTimeFieldError=u;class c extends s{}t.InvalidTokenTypeFieldError=c;class d extends s{}t.InvalidCodeFieldError=d;class p extends s{}t.InvalidMessageFieldError=p;class h extends s{}t.InvalidSubjectTokenError=h},25337:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountAuthorizedUserClient=t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let r=n(39321),i=n(84070),o=n(69919),s=n(27910),a=n(64489);t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class l extends i.OAuthClientAuthHandler{#A;constructor(e){super(e),this.#A=e.tokenRefreshEndpoint}async refreshToken(e,t){let n={...l.RETRY_CONFIG,url:this.#A,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};r.AuthClient.setMethodName(n,"refreshToken"),this.applyClientAuthenticationOptions(n);try{let e=await this.transporter.request(n),t=e.data;return t.res=e,t}catch(e){if(e instanceof o.GaxiosError&&e.response)throw(0,i.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}class u extends r.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new l({tokenRefreshEndpoint:e.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,"number"!=typeof e?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=a.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=o.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,i=n.config.data instanceof s.Readable;if(!t&&(401===r||403===r)&&!i&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res},void 0!==e.refresh_token&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.ExternalAccountAuthorizedUserClient=u},41212:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountClient=void 0;let r=n(64489),i=n(27727),o=n(65892),s=n(82908);class a{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===r.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new o.AwsClient(e):e.credential_source?.executable?new s.PluggableAuthClient(e):new i.IdentityPoolClient(e):null}}t.ExternalAccountClient=a},26959:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSubjectTokenSupplier=void 0;let r=n(28354),i=n(29021),o=(0,r.promisify)(i.readFile??(()=>{})),s=(0,r.promisify)(i.realpath??(()=>{})),a=(0,r.promisify)(i.lstat??(()=>{}));class l{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e,t=this.filePath;try{if(t=await s(t),!(await a(t)).isFile())throw Error()}catch(e){throw e instanceof Error&&(e.message=`The file at ${t} does not exist, or it is not a file. ${e.message}`),e}let n=await o(t,{encoding:"utf8"});if("text"===this.formatType?e=n:"json"===this.formatType&&this.subjectTokenFieldName&&(e=JSON.parse(n)[this.subjectTokenFieldName]),!e)throw Error("Unable to parse the subject_token from the credential_source file");return e}}t.FileSubjectTokenSupplier=l},35109:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleAuth=t.GoogleAuthExceptionMessages=void 0;let r=n(79646),i=n(29021),o=n(69919),s=n(63263),a=n(21820),l=n(33873),u=n(7164),c=n(73040),d=n(51647),p=n(94102),h=n(88780),f=n(72114),g=n(49483),m=n(41212),y=n(64489),v=n(39321),E=n(25337),_=n(92647);t.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"};class A{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#T=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(t.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(!e)return this.getProjectIdAsync();this.getProjectIdAsync().then(t=>e(null,t),e)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=e,e;throw Error(t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await s.universe("universe-domain"),e||=v.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=v.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,_.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=v.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let n;if("function"==typeof e?t=e:n=e,!t)return this.getApplicationDefaultAsync(n);this.getApplicationDefaultAsync(n).then(e=>t(null,e.credential,e.projectId),t)}async getApplicationDefaultAsync(e={}){let n;if(this.cachedCredential)return await this.#S(this.cachedCredential,null);if((n=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e))||(n=await this._tryGetApplicationCredentialsFromWellKnownFile(e)))return n instanceof h.JWT?n.scopes=this.scopes:n instanceof y.BaseExternalAccountClient&&(n.scopes=this.getAnyScopes()),await this.#S(n);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#S(new c.Compute(e));throw Error(t.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #S(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let n=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:n}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=s.getGCPResidency()||await s.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||0===t.length)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(e){throw e instanceof Error&&(e.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${e.message}`),e}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let e=process.env.HOME;e&&(t=l.join(e,".config"))}return(t&&(t=l.join(t,"gcloud","application_default_credentials.json"),i.existsSync(t)||(t=null)),t)?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||0===e.length)throw Error("The file path is invalid.");try{if(e=i.realpathSync(e),!i.lstatSync(e).isFile())throw Error()}catch(t){throw t instanceof Error&&(t.message=`The file at ${e} does not exist, or it is not a file. ${t.message}`),t}let n=i.createReadStream(e);return this.fromStream(n,t)}fromImpersonatedJSON(e){if(!e)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==g.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${g.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let n=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!n)throw RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let r=(this.scopes||e.scopes||this.defaultScopes)??[];return new g.Impersonated({...e,sourceClient:t,targetPrincipal:n,targetScopes:Array.isArray(r)?r:[r]})}fromJSON(e,t={}){let n;let r=(0,_.originalOrCamelOptions)(t).get("universe_domain");return e.type===f.USER_REFRESH_ACCOUNT_TYPE?(n=new f.UserRefreshClient(t)).fromJSON(e):e.type===g.IMPERSONATED_ACCOUNT_TYPE?n=this.fromImpersonatedJSON(e):e.type===y.EXTERNAL_ACCOUNT_TYPE?(n=m.ExternalAccountClient.fromJSON({...e,...t})).scopes=this.getAnyScopes():e.type===E.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?n=new E.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,n=new h.JWT(t),this.setGapicJWTValues(n),n.fromJSON(e)),r&&(n.universeDomain=r),n}_cacheClientFromJSON(e,t){let n=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=n,n}fromStream(e,t={},n){let r={};if("function"==typeof t?n=t:r=t,!n)return this.fromStreamAsync(e,r);this.fromStreamAsync(e,r).then(e=>n(null,e),n)}fromStreamAsync(e,t){return new Promise((n,r)=>{if(!e)throw Error("Must pass in a stream containing the Google auth settings.");let i=[];e.setEncoding("utf8").on("error",r).on("data",e=>i.push(e)).on("end",()=>{try{try{let e=JSON.parse(i.join("")),r=this._cacheClientFromJSON(e,t);return n(r)}catch(t){if(!this.keyFilename)throw t;let e=new h.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=e,this.setGapicJWTValues(e),n(e)}}catch(e){return r(e)}})})}fromAPIKey(e,t={}){return new h.JWT({...t,apiKey:e})}_isWindows(){let e=a.platform();return!!e&&e.length>=3&&"win"===e.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(e=>{(0,r.exec)("gcloud config config-helper --format json",(t,n)=>{if(!t&&n)try{let t=JSON.parse(n).configuration.properties.core.project;e(t);return}catch(e){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let e=await this.getClient();if(e&&e.projectId)return e.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==y.EXTERNAL_ACCOUNT_TYPE)return null;let e=await this.getClient();return await e.getProjectId()}async getGCEProjectId(){try{return await s.project("project-id")}catch(e){return null}}getCredentials(e){if(!e)return this.getCredentialsAsync();this.getCredentialsAsync().then(t=>e(null,t),e)}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof g.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof y.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[e,t]=await Promise.all([s.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:e,universe_domain:t}}throw Error(t.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#T=this.#T||this.#b();try{return await this.#T}finally{this.#T=null}}async #b(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=l.resolve(this.keyFilename),t=i.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#S(e);return t}{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new d.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){let e=await this.getClient();return(await e.getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,n=await this.getClient(),r=await n.getRequestHeaders(t);return e.headers=o.Gaxios.mergeHeaders(e.headers,r),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,p.getEnv)()}async sign(e,t){let n=await this.getClient(),r=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${r}/v1/projects/-/serviceAccounts/`,n instanceof g.Impersonated)return(await n.sign(e)).signedBlob;let i=(0,u.createCrypto)();if(n instanceof h.JWT&&n.key)return await i.sign(n.key,e);let o=await this.getCredentials();if(!o.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(i,o.client_email,e,t)}async signBlob(e,t,n,r){let i=new URL(r+`${t}:signBlob`);return(await this.request({method:"POST",url:i.href,data:{payload:e.encodeBase64StringUtf8(n)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}t.GoogleAuth=A},35699:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IAMAuth=void 0;class n{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}t.IAMAuth=n},27727:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityPoolClient=void 0;let r=n(64489),i=n(92647),o=n(26959),s=n(6058),a=n(31268),l=n(69534),u=n(69919);class c extends r.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let t=(0,i.originalOrCamelOptions)(e),n=t.get("credential_source"),r=t.get("subject_token_supplier");if(!n&&!r)throw Error("A credential source or subject token supplier must be specified.");if(n&&r)throw Error("Only one of credential source or subject token supplier can be specified.");if(r)this.subjectTokenSupplier=r,this.credentialSourceType="programmatic";else{let e=(0,i.originalOrCamelOptions)(n),t=(0,i.originalOrCamelOptions)(e.get("format")),r=t.get("type")||"text",l=t.get("subject_token_field_name");if("json"!==r&&"text"!==r)throw Error(`Invalid credential_source format "${r}"`);if("json"===r&&!l)throw Error("Missing subject_token_field_name for JSON credential_source format");let u=e.get("file"),d=e.get("url"),p=e.get("certificate"),h=e.get("headers");if(u&&d||d&&p||u&&p)throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(u)this.credentialSourceType="file",this.subjectTokenSupplier=new o.FileSubjectTokenSupplier({filePath:u,formatType:r,subjectTokenFieldName:l});else if(d)this.credentialSourceType="url",this.subjectTokenSupplier=new s.UrlSubjectTokenSupplier({url:d,formatType:r,subjectTokenFieldName:l,headers:h,additionalGaxiosOptions:c.RETRY_CONFIG});else if(p){this.credentialSourceType="certificate";let e=new a.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:p.use_default_certificate_config,certificateConfigLocation:p.certificate_config_location,trustChainPath:p.trust_chain_path});this.subjectTokenSupplier=e}else throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof a.CertificateSubjectTokenSupplier){let e=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new l.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new u.Gaxios({agent:e})}),this.transporter=new u.Gaxios({...this.transporter.defaults||{},agent:e})}return e}}t.IdentityPoolClient=c},51647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdTokenClient=void 0;let r=n(84700);class i extends r.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let e=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:e,expiry_date:this.getIdTokenExpiryDate(e)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return 1e3*JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp}}t.IdTokenClient=i},49483:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Impersonated=t.IMPERSONATED_ACCOUNT_TYPE=void 0;let r=n(84700),i=n(69919),o=n(92647);t.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class s extends r.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new r.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,(0,o.originalOrCamelOptions)(e).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${t}:signBlob`,r={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:n,data:r,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,n={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},r=await this.sourceClient.request({...s.RETRY_CONFIG,url:t,data:n,method:"POST"}),i=r.data;return this.credentials.access_token=i.accessToken,this.credentials.expiry_date=Date.parse(i.expireTime),{tokens:this.credentials,res:r}}catch(n){if(!(n instanceof Error))throw n;let e=0,t="";if(n instanceof i.GaxiosError&&(e=n?.response?.data?.error?.status,t=n?.response?.data?.error?.message),e&&t)throw n.message=`${e}: unable to impersonate: ${t}`,n;throw n.message=`unable to impersonate: ${n}`,n}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let n=`projects/-/serviceAccounts/${this.targetPrincipal}`,r=`${this.endpoint}/v1/${n}:generateIdToken`,i={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:r,data:i,method:"POST"})).data.token}}t.Impersonated=s},65909:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWTAccess=void 0;let r=n(89511),i=n(92647),o={alg:"RS256",typ:"JWT"};class s{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new i.LRUCache({capacity:500,maxAge:36e5});constructor(e,t,n,r){this.email=e,this.key=t,this.keyId=n,this.eagerRefreshThresholdMillis=r??3e5}getCachedKey(e,t){let n=e;if(t&&Array.isArray(t)&&t.length?n=e?`${e}_${t.join("_")}`:`${t.join("_")}`:"string"==typeof t&&(n=e?`${e}_${t}`:t),!n)throw Error("Scopes or url must be provided");return n}getRequestHeaders(e,t,n){let i;let a=this.getCachedKey(e,n),l=this.cache.get(a),u=Date.now();if(l&&l.expiration-u>this.eagerRefreshThresholdMillis)return new Headers(l.headers);let c=Math.floor(Date.now()/1e3),d=s.getExpirationTime(c);if(Array.isArray(n)&&(n=n.join(" ")),i=n?{iss:this.email,sub:this.email,scope:n,exp:d,iat:c}:{iss:this.email,sub:this.email,aud:e,exp:d,iat:c},t){for(let e in i)if(t[e])throw Error(`The '${e}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let p=this.keyId?{...o,kid:this.keyId}:o,h=Object.assign(i,t),f=r.sign({header:p,payload:h,secret:this.key}),g=new Headers({authorization:`Bearer ${f}`});return this.cache.set(a,{expiration:1e3*d,headers:g}),g}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,n)=>{e||n(Error("Must pass in a stream containing the service account auth settings."));let r="";e.setEncoding("utf8").on("data",e=>r+=e).on("error",n).on("end",()=>{try{let e=JSON.parse(r);this.fromJSON(e),t()}catch(e){n(e)}})})}}t.JWTAccess=s},88780:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWT=void 0;let r=n(47185),i=n(65909),o=n(84700),s=n(39321);class a extends o.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new a(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==s.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==s.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${s.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t){if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:e}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${e.id_token}`}))}}{let t;this.access||(this.access=new i.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?t=this.scopes:e||(t=this.defaultScopes);let n=this.useJWTAccessWithScope||this.universeDomain!==s.DEFAULT_UNIVERSE,r=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,n?t:void 0);return{headers:this.addSharedMetadataHeaders(r)}}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new r.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&this.scopes.length>0||!!this.defaultScopes&&this.defaultScopes.length>0}authorize(e){if(!e)return this.authorizeAsync();this.authorizeAsync().then(t=>e(null,t),e)}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),t={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",t),{res:null,tokens:t}}createGToken(){return this.gtoken||(this.gtoken=new r.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,n)=>{if(!e)throw Error("Must pass in a stream containing the service account auth settings.");let r="";e.setEncoding("utf8").on("error",n).on("data",e=>r+=e).on("end",()=>{try{let e=JSON.parse(r);this.fromJSON(e),t()}catch(e){n(e)}})})}fromAPIKey(e){if("string"!=typeof e)throw Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let e=this.createGToken(),t=await e.getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}t.JWT=a},43415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginTicket=void 0;class n{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}t.LoginTicket=n},84700:(e,t,n)=>{"use strict";var r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.OAuth2Client=t.ClientAuthentication=t.CertificateFormat=t.CodeChallengeMethod=void 0;let s=n(69919),a=n(11723),l=n(27910),u=n(37846),c=n(92647),d=n(7164),p=n(39321),h=n(43415);(function(e){e.Plain="plain",e.S256="S256"})(r||(t.CodeChallengeMethod=r={})),function(e){e.PEM="PEM",e.JWK="JWK"}(i||(t.CertificateFormat=i={})),function(e){e.ClientSecretPost="ClientSecretPost",e.ClientSecretBasic="ClientSecretBasic",e.None="None"}(o||(t.ClientAuthentication=o={}));class f extends p.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=i.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,n){super("object"==typeof e?e:{}),"object"!=typeof e&&(e={clientId:e,clientSecret:t,redirectUri:n}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||o.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+a.stringify(e)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,d.createCrypto)(),t=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),n=(await e.sha256DigestBase64(t)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:t,codeChallenge:n}}getToken(e,t){let n="string"==typeof e?{code:e}:e;if(!t)return this.getTokenAsync(n);this.getTokenAsync(n).then(e=>t(null,e.tokens,e.res),e=>t(e,null,e.response))}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),n=new Headers,r={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===o.ClientSecretBasic){let e=Buffer.from(`${this._clientId}:${this._clientSecret}`);n.set("authorization",`Basic ${e.toString("base64")}`)}this.clientAuthentication===o.ClientSecretPost&&(r.client_secret=this._clientSecret);let i={...f.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,c.removeUndefinedValuesInObject)(r)),headers:n};p.AuthClient.setMethodName(i,"getTokenAsync");let s=await this.transporter.request(i),a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+1e3*s.data.expires_in,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(t=>(this.refreshTokenPromises.delete(e),t),t=>{throw this.refreshTokenPromises.delete(e),t});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){let t;if(!e)throw Error("No refresh token is set.");let n=this.endpoints.oauth2TokenUrl.toString(),r={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{let e={...f.RETRY_CONFIG,method:"POST",url:n,data:new URLSearchParams((0,c.removeUndefinedValuesInObject)(r))};p.AuthClient.setMethodName(e,"refreshTokenNoCache"),t=await this.transporter.request(e)}catch(e){throw e instanceof s.GaxiosError&&"invalid_grant"===e.message&&e.response?.data&&/ReAuth/i.test(e.response.data.error_description)&&(e.message=JSON.stringify(e.response.data)),e}let i=t.data;return t.data&&t.data.expires_in&&(i.expiry_date=new Date().getTime()+1e3*t.data.expires_in,delete i.expires_in),this.emit("tokens",i),{tokens:i,res:t}}refreshAccessToken(e){if(!e)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e)}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(!e)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token){if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token)return this.setCredentials(e),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.")}let e=await this.refreshAccessTokenAsync();if(!e.credentials||e.credentials&&!e.credentials.access_token)throw Error("Could not refresh access token.");return{token:e.credentials.access_token,res:e.res}}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let e=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(e)}}if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token){this.setCredentials(e);let t=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(t)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let n=null,r=null;try{r=(n=await this.refreshToken(t.refresh_token)).tokens}catch(e){throw e.response&&(403===e.response.status||404===e.response.status)&&(e.message=`Could not refresh access token: ${e.message}`),e}let i=this.credentials;i.token_type=i.token_type||"Bearer",r.refresh_token=i.refresh_token,this.credentials=r;let o=new Headers({authorization:i.token_type+" "+r.access_token});return{headers:this.addSharedMetadataHeaders(o),res:n.res}}static getRevokeTokenUrl(e){return new f().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let n={...f.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(p.AuthClient.setMethodName(n,"revokeToken"),!t)return this.transporter.request(n);this.transporter.request(n).then(e=>t(null,e),t)}revokeCredentials(e){if(!e)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(t=>e(null,t),e)}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw Error("No access token to revoke.")}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){try{let t=await this.getRequestMetadataAsync();return e.headers=s.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,i=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),o=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,s=n.config.data instanceof l.Readable,a=401===r||403===r;if(!t&&a&&!s&&i)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&a&&!s&&o){let t=await this.processAndValidateRefreshHandler();return t?.access_token&&this.setCredentials(t),this.requestAsync(e,!0)}}throw r}}verifyIdToken(e,t){if(t&&"function"!=typeof t)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!t)return this.verifyIdTokenAsync(e);this.verifyIdTokenAsync(e).then(e=>t(null,e),t)}async verifyIdTokenAsync(e){if(!e.idToken)throw Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...f.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),n=Object.assign({expiry_date:new Date().getTime()+1e3*t.expires_in,scopes:t.scope.split(" ")},t);return delete n.expires_in,delete n.scope,n}getFederatedSignonCerts(e){if(!e)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e)}async getFederatedSignonCertsAsync(){let e,t;let n=new Date().getTime(),r=(0,d.hasBrowserCrypto)()?i.JWK:i.PEM;if(this.certificateExpiry&&n<this.certificateExpiry.getTime()&&this.certificateCacheFormat===r)return{certs:this.certificateCache,format:r};switch(r){case i.PEM:t=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case i.JWK:t=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${r}`)}try{let n={...f.RETRY_CONFIG,url:t};p.AuthClient.setMethodName(n,"getFederatedSignonCertsAsync"),e=await this.transporter.request(n)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}let o=e?.headers.get("cache-control"),s=-1;if(o){let e=/max-age=(?<maxAge>[0-9]+)/.exec(o)?.groups?.maxAge;e&&(s=1e3*Number(e))}let a={};switch(r){case i.PEM:a=e.data;break;case i.JWK:for(let t of e.data.keys)a[t.kid]=t;break;default:throw Error(`Unsupported certificate format ${r}`)}let l=new Date;return this.certificateExpiry=-1===s?null:new Date(l.getTime()+s),this.certificateCache=a,this.certificateCacheFormat=r,{certs:a,format:r,res:e}}getIapPublicKeys(e){if(!e)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e)}async getIapPublicKeysAsync(){let e;let t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let n={...f.RETRY_CONFIG,url:t};p.AuthClient.setMethodName(n,"getIapPublicKeysAsync"),e=await this.transporter.request(n)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,n,r,i){let o,s;let a=(0,d.createCrypto)();i||(i=f.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(3!==l.length)throw Error("Wrong number of segments in token: "+e);let c=l[0]+"."+l[1],p=l[2];try{o=JSON.parse(a.decodeBase64StringUtf8(l[0]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token envelope: ${l[0]}': ${e.message}`),e}if(!o)throw Error("Can't parse token envelope: "+l[0]);try{s=JSON.parse(a.decodeBase64StringUtf8(l[1]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token payload '${l[0]}`),e}if(!s)throw Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,o.kid))throw Error("No pem found for envelope: "+JSON.stringify(o));let g=t[o.kid];if("ES256"===o.alg&&(p=u.joseToDer(p,"ES256").toString("base64")),!await a.verify(g,c,p))throw Error("Invalid token signature: "+e);if(!s.iat)throw Error("No issue time in token: "+JSON.stringify(s));if(!s.exp)throw Error("No expiration time in token: "+JSON.stringify(s));let m=Number(s.iat);if(isNaN(m))throw Error("iat field using invalid format");let y=Number(s.exp);if(isNaN(y))throw Error("exp field using invalid format");let v=new Date().getTime()/1e3;if(y>=v+i)throw Error("Expiration time too far in future: "+JSON.stringify(s));let E=m-f.CLOCK_SKEW_SECS_,_=y+f.CLOCK_SKEW_SECS_;if(v<E)throw Error("Token used too early, "+v+" < "+E+": "+JSON.stringify(s));if(v>_)throw Error("Token used too late, "+v+" > "+_+": "+JSON.stringify(s));if(r&&0>r.indexOf(s.iss))throw Error("Invalid issuer, expected one of ["+r+"], but got "+s.iss);if(null!=n){let e=s.aud;if(!(n.constructor===Array?n.indexOf(e)>-1:e===n))throw Error("Wrong recipient, payload audience != requiredAudience")}return new h.LoginTicket(o,s)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return!!e&&e<=new Date().getTime()+this.eagerRefreshThresholdMillis}}t.OAuth2Client=f},84070:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthClientAuthHandler=void 0,t.getErrorFromOAuthErrorResponse=function(e,t){let n=e.error,r=e.error_description,i=e.error_uri,o=`Error code ${n}`;void 0!==r&&(o+=`: ${r}`),void 0!==i&&(o+=` - ${i}`);let s=Error(o);if(t){let e=Object.keys(t);t.stack&&e.push("stack"),e.forEach(e=>{"message"!==e&&Object.defineProperty(s,e,{value:t[e],writable:!1,enumerable:!0})})}return s};let r=n(69919),i=n(7164),o=["PUT","POST","PATCH"];class s{#C=(0,i.createCrypto)();#O;transporter;constructor(e){e&&"clientId"in e?(this.#O=e,this.transporter=new r.Gaxios):(this.#O=e?.clientAuthentication,this.transporter=e?.transporter||new r.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=r.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=r.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#O?.confidentialClientType==="basic"){e.headers=r.Gaxios.mergeHeaders(e.headers);let t=this.#O.clientId,n=this.#O.clientSecret||"",i=this.#C.encodeBase64StringUtf8(`${t}:${n}`);r.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${i}`})}}injectAuthenticatedRequestBody(e){if(this.#O?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!o.includes(t))throw Error(`${t} HTTP method does not support ${this.#O.confidentialClientType} client authentication`);let n=new Headers(e.headers).get("content-type");if(n?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let t=new URLSearchParams(e.data??"");t.append("client_id",this.#O.clientId),t.append("client_secret",this.#O.clientSecret||""),e.data=t}else if(n?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#O.clientId,client_secret:this.#O.clientSecret||""});else throw Error(`${n} content-types are not supported with ${this.#O.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.OAuthClientAuthHandler=s},40436:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassThroughClient=void 0;let r=n(39321);class i extends r.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}}t.PassThroughClient=i},82908:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthClient=t.ExecutableError=void 0;let r=n(64489),i=n(79082),o=n(87167);var s=n(87167);Object.defineProperty(t,"ExecutableError",{enumerable:!0,get:function(){return s.ExecutableError}});class a extends r.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable||(this.command=e.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===e.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=e.credential_source.executable.output_file,this.handler=new o.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let e;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let n=this.getServiceAccountEmail();n&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",n),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!e.success)throw new o.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new i.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw Error("Executable response is expired.");return e.subjectToken}}t.PluggableAuthClient=a},87167:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthHandler=t.ExecutableError=void 0;let r=n(79082),i=n(79646),o=n(29021);class s extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableError=s;class a{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw Error("No command provided.");if(this.commandComponents=a.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,n)=>{let o=i.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";o.stdout.on("data",e=>{a+=e}),o.stderr.on("data",e=>{a+=e});let l=setTimeout(()=>(o.removeAllListeners(),o.kill(),n(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);o.on("close",e=>{if(clearTimeout(l),0!==e)return n(new s(a,e.toString()));try{let e=JSON.parse(a),n=new r.ExecutableResponse(e);return t(n)}catch(e){if(e instanceof r.ExecutableResponseError)return n(e);return n(new r.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}})})}async retrieveCachedResponse(){let e;if(!this.outputFile||0===this.outputFile.length)return;try{e=await o.promises.realpath(this.outputFile)}catch{return}if(!(await o.promises.lstat(e)).isFile())return;let t=await o.promises.readFile(e,{encoding:"utf8"});if(""!==t)try{let e=JSON.parse(t);if(new r.ExecutableResponse(e).isValid())return new r.ExecutableResponse(e);return}catch(e){if(e instanceof r.ExecutableResponseError)throw e;throw new r.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw Error(`Provided command: "${e}" could not be parsed.`);for(let e=0;e<t.length;e++)'"'===t[e][0]&&'"'===t[e].slice(-1)&&(t[e]=t[e].slice(1,-1));return t}}t.PluggableAuthHandler=a},72114:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRefreshClient=t.USER_REFRESH_ACCOUNT_TYPE=void 0;let r=n(84700),i=n(39321);t.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class o extends r.OAuth2Client{_refreshToken;constructor(e,t,n,r,i){let o=e&&"object"==typeof e?e:{clientId:e,clientSecret:t,refreshToken:n,eagerRefreshThresholdMillis:r,forceRefreshOnFailure:i};super(o),this._refreshToken=o.refreshToken,this.credentials.refresh_token=o.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...o.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return i.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==e.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}async fromStreamAsync(e){return new Promise((t,n)=>{if(!e)return n(Error("Must pass in a stream containing the user refresh token."));let r="";e.setEncoding("utf8").on("error",n).on("data",e=>r+=e).on("end",()=>{try{let e=JSON.parse(r);return this.fromJSON(e),t()}catch(e){return n(e)}})})}static fromJSON(e){let t=new o;return t.fromJSON(e),t}}t.UserRefreshClient=o},69534:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StsCredentials=void 0;let r=n(69919),i=n(39321),o=n(84070),s=n(92647);class a extends o.OAuthClientAuthHandler{#I;constructor(e={tokenExchangeEndpoint:""},t){("object"!=typeof e||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#I=e.tokenExchangeEndpoint}async exchangeToken(e,t,n){let l={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:n&&JSON.stringify(n)},u={...a.RETRY_CONFIG,url:this.#I.toString(),method:"POST",headers:t,data:new URLSearchParams((0,s.removeUndefinedValuesInObject)(l))};i.AuthClient.setMethodName(u,"exchangeToken"),this.applyClientAuthenticationOptions(u);try{let e=await this.transporter.request(u),t=e.data;return t.res=e,t}catch(e){if(e instanceof r.GaxiosError&&e.response)throw(0,o.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}t.StsCredentials=a},6058:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlSubjectTokenSupplier=void 0;let r=n(39321);class i{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t;let n={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};if(r.AuthClient.setMethodName(n,"getSubjectToken"),"text"===this.formatType?t=(await e.transporter.request(n)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(t=(await e.transporter.request(n)).data[this.subjectTokenFieldName]),!t)throw Error("Unable to parse the subject_token from the credential_source URL");return t}}t.UrlSubjectTokenSupplier=i},41141:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserCrypto=void 0;let r=n(26826),i=n(98340);class o{constructor(){if("undefined"==typeof window||void 0===window.crypto||void 0===window.crypto.subtle)throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return r.fromByteArray(new Uint8Array(n))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),r.fromByteArray(t)}static padBase64(e){for(;e.length%4!=0;)e+="=";return e}async verify(e,t,n){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),a=r.toByteArray(o.padBase64(n)),l=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,l,a,s)}async sign(e,t){let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(t),o=await window.crypto.subtle.importKey("jwk",e,n,!0,["sign"]),s=await window.crypto.subtle.sign(n,o,i);return r.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let t=r.toByteArray(o.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return r.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return(0,i.fromArrayBufferToHex)(n)}async signWithHmacSha256(e,t){let n="string"==typeof e?e:String.fromCharCode(...new Uint16Array(e)),r=new TextEncoder,i=await window.crypto.subtle.importKey("raw",r.encode(n),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",i,r.encode(t))}}t.BrowserCrypto=o},7164:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.createCrypto=function(){return a()?new o.BrowserCrypto:new s.NodeCrypto},t.hasBrowserCrypto=a;let o=n(41141),s=n(99389);function a(){return"undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle}i(n(98340),t)},99389:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeCrypto=void 0;let r=n(55511);class i{async sha256DigestBase64(e){return r.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return r.randomBytes(e).toString("base64")}async verify(e,t,n){let i=r.createVerify("RSA-SHA256");return i.update(t),i.end(),i.verify(e,n,"base64")}async sign(e,t){let n=r.createSign("RSA-SHA256");return n.update(t),n.end(),n.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return r.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){var n;let i="string"==typeof e?e:Buffer.from(e);return(n=r.createHmac("sha256",i).update(t).digest()).buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}}t.NodeCrypto=i},98340:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromArrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}},70671:(e,t,n)=>{"use strict";t.kF=void 0;let r=n(35109);Object.defineProperty(t,"kF",{enumerable:!0,get:function(){return r.GoogleAuth}}),n(63263),n(69919),n(39321),n(73040),n(94102),n(35699),n(51647),n(65909),n(88780),n(49483),n(84700),n(43415),n(72114),n(65892),n(85772),n(27727),n(41212),n(64489),n(41111),n(82908),n(25337),n(40436),new r.GoogleAuth},92647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0,t.snakeToCamel=a,t.originalOrCamelOptions=function(e){return{get:function(t){let n=e||{};return n[t]??n[a(t)]}}},t.removeUndefinedValuesInObject=function(e){return Object.entries(e).forEach(([t,n])=>{(void 0===n||"undefined"===n)&&delete e[t]}),e},t.isValidFile=u,t.getWellKnownCertificateConfigFileLocation=function(){let e=process.env.CLOUDSDK_CONFIG||(i.platform().startsWith("win")?o.join(process.env.APPDATA||"",s):o.join(process.env.HOME||"",".config",s));return o.join(e,"certificate_config.json")};let r=n(29021),i=n(21820),o=n(33873),s="gcloud";function a(e){return e.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}class l{capacity;#w=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#R(e,t){this.#w.delete(e),this.#w.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#R(e,t),this.#N()}get(e){let t=this.#w.get(e);if(t)return this.#R(e,t.value),this.#N(),t.value}#N(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#w.entries().next();for(;!t.done&&(this.#w.size>this.capacity||t.value[1].lastAccessed<e);)this.#w.delete(t.value[0]),t=this.#w.entries().next()}}async function u(e){try{return(await r.promises.lstat(e)).isFile()}catch(e){return!1}}t.LRUCache=l},96981:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Colours=void 0;class n{static isEnabled(e){return e&&e.isTTY&&("function"!=typeof e.getColorDepth||e.getColorDepth()>2)}static refresh(){n.enabled=n.isEnabled(null==process?void 0:process.stderr),this.enabled?(n.reset="\x1b[0m",n.bright="\x1b[1m",n.dim="\x1b[2m",n.red="\x1b[31m",n.green="\x1b[32m",n.yellow="\x1b[33m",n.blue="\x1b[34m",n.magenta="\x1b[35m",n.cyan="\x1b[36m",n.white="\x1b[37m",n.grey="\x1b[90m"):(n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="")}}t.Colours=n,n.enabled=!1,n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="",n.refresh()},58592:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(99805),t)},99805:function(e,t,n){"use strict";let r;var i,o,s,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=i(e),r=0;r<n.length;r++)"default"!==n[r]&&a(t,e,n[r]);return l(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.env=t.DebugLogBackendBase=t.placeholder=t.AdhocDebugLogger=t.LogSeverity=void 0,t.getNodeBackend=y,t.getDebugBackend=function(e){return new v(e)},t.getStructuredBackend=function(e){return new E(e)},t.setBackend=function(e){r=e,_.clear()},t.log=A;let c=n(94735),d=u(n(19771)),p=u(n(28354)),h=n(96981);(o=s||(t.LogSeverity=s={})).DEFAULT="DEFAULT",o.DEBUG="DEBUG",o.INFO="INFO",o.WARNING="WARNING",o.ERROR="ERROR";class f extends c.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(e,t)=>this.on(e,t)}),this.func.debug=(...e)=>this.invokeSeverity(s.DEBUG,...e),this.func.info=(...e)=>this.invokeSeverity(s.INFO,...e),this.func.warn=(...e)=>this.invokeSeverity(s.WARNING,...e),this.func.error=(...e)=>this.invokeSeverity(s.ERROR,...e),this.func.sublog=e=>A(e,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch(e){}try{this.emit("log",e,t)}catch(e){}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}}t.AdhocDebugLogger=f,t.placeholder=new f("",()=>{}).func;class g{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let n=null!==(e=d.env[t.env.nodeEnables])&&void 0!==e?e:"*";"all"===n&&(n="*"),this.filters=n.split(",")}log(e,t,...n){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let r=this.cached.get(e);r||(r=this.makeLogger(e),this.cached.set(e,r)),r(t,...n)}catch(e){console.error(e)}}}t.DebugLogBackendBase=g;class m extends g{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...n)=>{var r;let i;let o=`${h.Colours.green}${e}${h.Colours.reset}`,a=`${h.Colours.yellow}${d.pid}${h.Colours.reset}`;switch(t.severity){case s.ERROR:i=`${h.Colours.red}${t.severity}${h.Colours.reset}`;break;case s.INFO:i=`${h.Colours.magenta}${t.severity}${h.Colours.reset}`;break;case s.WARNING:i=`${h.Colours.yellow}${t.severity}${h.Colours.reset}`;break;default:i=null!==(r=t.severity)&&void 0!==r?r:s.DEFAULT}let l=p.formatWithOptions({colors:h.Colours.enabled},...n),u=Object.assign({},t);delete u.severity;let c=Object.getOwnPropertyNames(u).length?JSON.stringify(u):"",f=c?`${h.Colours.grey}${c}${h.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",a,o,i,l,c?` ${f}`:"")}:()=>{}}setFilters(){let e=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${e}$`,"i")}}function y(){return new m}class v extends g{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(e,...n)=>{t(n[0],...n.slice(1))}}setFilters(){var e;let t=null!==(e=d.env.NODE_DEBUG)&&void 0!==e?e:"";d.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}}class E extends g{constructor(e){super(),this.upstream=null!=e?e:void 0}makeLogger(e){var t;let n=null===(t=this.upstream)||void 0===t?void 0:t.makeLogger(e);return(e,...t)=>{var r;let i=JSON.stringify(Object.assign({severity:null!==(r=e.severity)&&void 0!==r?r:s.INFO,message:p.format(...t)},e));n?n(e,i):console.log("%s",i)}}setFilters(){var e;null===(e=this.upstream)||void 0===e||e.setFilters()}}t.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let _=new Map;function A(e,n){let i;if(!r&&!d.env[t.env.nodeEnables]||!e)return t.placeholder;n&&(e=`${n.instance.namespace}:${e}`);let o=_.get(e);if(o)return o.func;if(null===r)return t.placeholder;void 0===r&&(r=y());let s=new f(e,(t,...n)=>{if(i!==r){if(null===r)return;void 0===r&&(r=y()),i=r}null==r||r.log(e,t,...n)});return _.set(e,s),s.func}},54685:(e,t,n)=>{var r=n(87836).stringify,i=n(63278);e.exports=function(e){return{parse:i(e),stringify:r}},e.exports.parse=i(),e.exports.stringify=r},63278:(e,t,n)=>{var r=null;let i=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,o=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;e.exports=function(e){"use strict";var t={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=e){if(!0===e.strict&&(t.strict=!0),!0===e.storeAsString&&(t.storeAsString=!0),t.alwaysParseAsBig=!0===e.alwaysParseAsBig&&e.alwaysParseAsBig,t.useNativeBigInt=!0===e.useNativeBigInt&&e.useNativeBigInt,void 0!==e.constructorAction){if("error"===e.constructorAction||"ignore"===e.constructorAction||"preserve"===e.constructorAction)t.constructorAction=e.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${e.constructorAction}`)}if(void 0!==e.protoAction){if("error"===e.protoAction||"ignore"===e.protoAction||"preserve"===e.protoAction)t.protoAction=e.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${e.protoAction}`)}}var s,a,l,u,c={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},d=function(e){throw{name:"SyntaxError",message:e,at:s,text:l}},p=function(e){return e&&e!==a&&d("Expected '"+e+"' instead of '"+a+"'"),a=l.charAt(s),s+=1,a},h=function(){var e,i="";for("-"===a&&(i="-",p("-"));a>="0"&&a<="9";)i+=a,p();if("."===a)for(i+=".";p()&&a>="0"&&a<="9";)i+=a;if("e"===a||"E"===a)for(i+=a,p(),("-"===a||"+"===a)&&(i+=a,p());a>="0"&&a<="9";)i+=a,p();if(isFinite(e=+i))return(null==r&&(r=n(47286)),i.length>15)?t.storeAsString?i:t.useNativeBigInt?BigInt(i):new r(i):t.alwaysParseAsBig?t.useNativeBigInt?BigInt(e):new r(e):e;d("Bad number")},f=function(){var e,t,n,r="";if('"'===a)for(var i=s;p();){if('"'===a)return s-1>i&&(r+=l.substring(i,s-1)),p(),r;if("\\"===a){if(s-1>i&&(r+=l.substring(i,s-1)),p(),"u"===a){for(t=0,n=0;t<4&&isFinite(e=parseInt(p(),16));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else if("string"==typeof c[a])r+=c[a];else break;i=s}}d("Bad string")},g=function(){for(;a&&a<=" ";)p()},m=function(){switch(a){case"t":return p("t"),p("r"),p("u"),p("e"),!0;case"f":return p("f"),p("a"),p("l"),p("s"),p("e"),!1;case"n":return p("n"),p("u"),p("l"),p("l"),null}d("Unexpected '"+a+"'")},y=function(){var e=[];if("["===a){if(p("["),g(),"]"===a)return p("]"),e;for(;a;){if(e.push(u()),g(),"]"===a)return p("]"),e;p(","),g()}}d("Bad array")},v=function(){var e,n=Object.create(null);if("{"===a){if(p("{"),g(),"}"===a)return p("}"),n;for(;a;){if(e=f(),g(),p(":"),!0===t.strict&&Object.hasOwnProperty.call(n,e)&&d('Duplicate key "'+e+'"'),!0===i.test(e)?"error"===t.protoAction?d("Object contains forbidden prototype property"):"ignore"===t.protoAction?u():n[e]=u():!0===o.test(e)?"error"===t.constructorAction?d("Object contains forbidden constructor property"):"ignore"===t.constructorAction?u():n[e]=u():n[e]=u(),g(),"}"===a)return p("}"),n;p(","),g()}}d("Bad object")};return u=function(){switch(g(),a){case"{":return v();case"[":return y();case'"':return f();case"-":return h();default:return a>="0"&&a<="9"?h():m()}},function(e,t){var n;return l=e+"",s=0,a=" ",n=u(),g(),a&&d("Syntax error"),"function"==typeof t?function e(n,r){var i,o=n[r];return o&&"object"==typeof o&&Object.keys(o).forEach(function(t){void 0!==(i=e(o,t))?o[t]=i:delete o[t]}),t.call(n,r,o)}({"":n},""):n}}},87836:(e,t,n)=>{var r=n(47286),i=e.exports;!function(){"use strict";var e,t,n,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof i.stringify&&(i.stringify=function(i,o,s){var l;if(e="",t="","number"==typeof s)for(l=0;l<s;l+=1)t+=" ";else"string"==typeof s&&(t=s);if(n=o,o&&"function"!=typeof o&&("object"!=typeof o||"number"!=typeof o.length))throw Error("JSON.stringify");return function i(o,s){var l,u,c,d,p,h=e,f=s[o],g=null!=f&&(f instanceof r||r.isBigNumber(f));switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(o)),"function"==typeof n&&(f=n.call(s,o,f)),typeof f){case"string":if(g)return f;return a(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":case"bigint":return String(f);case"object":if(!f)return"null";if(e+=t,p=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=0,d=f.length;l<d;l+=1)p[l]=i(l,f)||"null";return c=0===p.length?"[]":e?"[\n"+e+p.join(",\n"+e)+"\n"+h+"]":"["+p.join(",")+"]",e=h,c}if(n&&"object"==typeof n)for(l=0,d=n.length;l<d;l+=1)"string"==typeof n[l]&&(c=i(u=n[l],f))&&p.push(a(u)+(e?": ":":")+c);else Object.keys(f).forEach(function(t){var n=i(t,f);n&&p.push(a(t)+(e?": ":":")+n)});return c=0===p.length?"{}":e?"{\n"+e+p.join(",\n"+e)+"\n"+h+"}":"{"+p.join(",")+"}",e=h,c}}("",{"":i})})}()},60525:(e,t,n)=>{var r,i=n(95957).Buffer,o=n(55511),s=n(37846),a=n(28354),l="secret must be a string or buffer",u="key must be a string or a buffer",c="function"==typeof o.createPublicKey;function d(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!c||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw g(u)}function p(e){if(!i.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw g("key must be a string, a buffer or an object")}function h(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var n=0;n<t;++n)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function g(e){var t=[].slice.call(arguments,1);return TypeError(a.format.bind(a,e).apply(null,t))}function m(e){var t;return t=e,i.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function y(e){return function(t,n){(function(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!c||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export))throw g(l)})(n),t=m(t);var r=o.createHmac("sha"+e,n);return h((r.update(t),r.digest("base64")))}}c&&(u+=" or a KeyObject",l+="or a KeyObject");var v="timingSafeEqual"in o?function(e,t){return e.byteLength===t.byteLength&&o.timingSafeEqual(e,t)}:function(e,t){return r||(r=n(24653)),r(e,t)};function E(e){return function(t,n,r){var o=y(e)(t,r);return v(i.from(n),i.from(o))}}function _(e){return function(t,n){p(n),t=m(t);var r=o.createSign("RSA-SHA"+e);return h((r.update(t),r.sign(n,"base64")))}}function A(e){return function(t,n,r){d(r),t=m(t),n=f(n);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify(r,n,"base64")}}function T(e){return function(t,n){p(n),t=m(t);var r=o.createSign("RSA-SHA"+e);return h((r.update(t),r.sign({key:n,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function S(e){return function(t,n,r){d(r),t=m(t),n=f(n);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:r,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function b(e){var t=_(e);return function(){var n=t.apply(null,arguments);return s.derToJose(n,"ES"+e)}}function C(e){var t=A(e);return function(n,r,i){return t(n,r=s.joseToDer(r,"ES"+e).toString("base64"),i)}}function O(){return function(){return""}}function I(){return function(e,t){return""===t}}e.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!t)throw g('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var n=(t[1]||t[3]).toLowerCase(),r=t[2];return{sign:({hs:y,rs:_,ps:T,es:b,none:O})[n](r),verify:({hs:E,rs:A,ps:S,es:C,none:I})[n](r)}}},89511:(e,t,n)=>{var r=n(60719),i=n(63259);t.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],t.sign=r.sign,t.verify=i.verify,t.decode=i.decode,t.isValid=i.isValid,t.createSign=function(e){return new r(e)},t.createVerify=function(e){return new i(e)}},96676:(e,t,n)=>{var r=n(95957).Buffer,i=n(27910);function o(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=r.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=r.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}n(28354).inherits(o,i),o.prototype.write=function(e){this.buffer=r.concat([this.buffer,r.from(e)]),this.emit("data",e)},o.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},e.exports=o},60719:(e,t,n)=>{var r=n(95957).Buffer,i=n(96676),o=n(60525),s=n(27910),a=n(37911),l=n(28354);function u(e,t){return r.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function c(e){var t,n,r,i=e.header,s=e.payload,c=e.secret||e.privateKey,d=e.encoding,p=o(i.alg),h=(t=(t=d)||"utf8",n=u(a(i),"binary"),r=u(a(s),t),l.format("%s.%s",n,r)),f=p.sign(h,c);return l.format("%s.%s",h,f)}function d(e){var t=e.secret;if(t=null==(t=null==t?e.privateKey:t)?e.key:t,!0===/^hs/i.test(e.header.alg)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var n=new i(t);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=n,this.payload=new i(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}l.inherits(d,s),d.prototype.sign=function(){try{var e=c({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},d.sign=c,e.exports=d},37911:(e,t,n)=>{var r=n(79428).Buffer;e.exports=function(e){return"string"==typeof e?e:"number"==typeof e||r.isBuffer(e)?e.toString():JSON.stringify(e)}},63259:(e,t,n)=>{var r=n(95957).Buffer,i=n(96676),o=n(60525),s=n(27910),a=n(37911),l=n(28354),u=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function c(e){var t=e.split(".",1)[0];return function(e){if("[object Object]"===Object.prototype.toString.call(e))return e;try{return JSON.parse(e)}catch(e){return}}(r.from(t,"base64").toString("binary"))}function d(e){return e.split(".")[2]}function p(e){return u.test(e)&&!!c(e)}function h(e,t,n){if(!t){var r=Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}var i=d(e=a(e)),s=e.split(".",2).join(".");return o(t).verify(s,i,n)}function f(e,t){if(t=t||{},!p(e=a(e)))return null;var n,i,o=c(e);if(!o)return null;var s=(n=n||"utf8",i=e.split(".")[1],r.from(i,"base64").toString(n));return("JWT"===o.typ||t.json)&&(s=JSON.parse(s,t.encoding)),{header:o,payload:s,signature:d(e)}}function g(e){var t=(e=e||{}).secret;if(t=null==(t=null==t?e.publicKey:t)?e.key:t,!0===/^hs/i.test(e.algorithm)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var n=new i(t);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=n,this.signature=new i(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}l.inherits(g,s),g.prototype.verify=function(){try{var e=h(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},g.decode=f,g.isValid=p,g.verify=h,e.exports=g},95957:(e,t,n)=>{var r=n(79428),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r.SlowBuffer(e)}},83720:(e,t,n)=>{"use strict";let r=n(36547);e.exports={pkg:r}},76088:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GCE_LINUX_BIOS_PATHS=void 0,t.isGoogleCloudServerless=s,t.isGoogleComputeEngineLinux=a,t.isGoogleComputeEngineMACAddress=l,t.isGoogleComputeEngine=u,t.detectGCPResidency=function(){return s()||u()};let r=n(29021),i=n(21820);t.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let o=/^42:01/;function s(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function a(){if("linux"!==(0,i.platform)())return!1;try{(0,r.statSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let e=(0,r.readFileSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(e)}catch{return!1}}function l(){for(let e of Object.values((0,i.networkInterfaces)()))if(e){for(let{mac:t}of e)if(o.test(t))return!0}return!1}function u(){return a()||l()}},63263:function(e,t,n){"use strict";let r;var i,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=i(e),r=0;r<n.length;r++)"default"!==n[r]&&o(t,e,n[r]);return s(t,e),t}),l=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.gcpResidencyCache=t.METADATA_SERVER_DETECTION=t.HEADERS=t.HEADER_VALUE=t.HEADER_NAME=t.SECONDARY_HOST_ADDRESS=t.HOST_ADDRESS=t.BASE_PATH=void 0,t.instance=function(e){return g("instance",e)},t.project=function(e){return g("project",e)},t.universe=function(e){return g("universe",e)},t.bulk=y,t.isAvailable=v,t.resetIsAvailableCache=function(){r=void 0},t.getGCPResidency=E,t.setGCPResidency=_,t.requestTimeout=A;let u=n(69919),c=n(54685),d=n(76088),p=a(n(58592));t.BASE_PATH="/computeMetadata/v1",t.HOST_ADDRESS="http://169.254.169.254",t.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",t.HEADER_NAME="Metadata-Flavor",t.HEADER_VALUE="Google",t.HEADERS=Object.freeze({[t.HEADER_NAME]:t.HEADER_VALUE});let h=p.log("gcp-metadata");function f(e){return e||(e=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||t.HOST_ADDRESS),/^https?:\/\//.test(e)||(e=`http://${e}`),new URL(t.BASE_PATH,e).href}async function g(e,n={},r=3,i=!1){let o=new Headers(t.HEADERS),s="",a={};"object"==typeof e?(new Headers(e.headers).forEach((e,t)=>o.set(t,e)),s=e.metadataKey,a=e.params||a,r=e.noResponseRetries||r,i=e.fastFail||i):s=e,"string"==typeof n?s+=`/${n}`:(function(e){Object.keys(e).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${e}' is not a valid configuration option.`)}})}(n),n.property&&(s+=`/${n.property}`),new Headers(n.headers).forEach((e,t)=>o.set(t,e)),a=n.params||a);let l=i?m:u.request,d={url:`${f()}/${s}`,headers:o,retryConfig:{noResponseRetries:r},params:a,responseType:"text",timeout:A()};h.info("instance request %j",d);let p=await l(d);h.info("instance metadata is %s",p.data);let y=p.headers.get(t.HEADER_NAME);if(y!==t.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${t.HEADER_NAME} header. Expected '${t.HEADER_VALUE}', got ${y?`'${y}'`:"no header"}`);if("string"==typeof p.data)try{return c.parse(p.data)}catch{}return p.data}async function m(e){let n={...e,url:e.url?.toString().replace(f(),f(t.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,u.request)(e),(0,u.request)(n)])}async function y(e){let t={};return await Promise.all(e.map(e=>(async()=>{let n=await g(e);t[e.metadataKey]=n})())),t}async function v(){if(process.env.METADATA_SERVER_DETECTION){let e=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(e in t.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${e}\`, but it should be \`${Object.keys(t.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(e){case"assume-present":return!0;case"none":return!1;case"bios-only":return E()}}try{return void 0===r&&(r=g("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await r,!0}catch(e){if(process.env.DEBUG_AUTH&&console.info(e),"request-timeout"===e.type||e.response&&404===e.response.status)return!1;if(!(e.response&&404===e.response.status)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function E(){return null===t.gcpResidencyCache&&_(),t.gcpResidencyCache}function _(e=null){t.gcpResidencyCache=null!==e?e:(0,d.detectGCPResidency)()}function A(){return E()?0:3e3}t.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),t.gcpResidencyCache=null,l(n(76088),t)},56759:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USER_AGENT=t.PRODUCT_NAME=t.pkg=void 0;let r=n(90630);t.pkg=r;let i="google-api-nodejs-client";t.PRODUCT_NAME=i;let o=`${i}/${r.version}`;t.USER_AGENT=o},47185:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleToken=void 0;var r=l(n(29021)),i=n(69919),o=l(n(89511)),s=l(n(33873)),a=n(28354);function l(e,t){if("function"==typeof WeakMap)var n=new WeakMap,r=new WeakMap;return(l=function(e,t){if(!t&&e&&e.__esModule)return e;var i,o,s={__proto__:null,default:e};if(null===e||"object"!=u(e)&&"function"!=typeof e)return s;if(i=t?r:n){if(i.has(e))return i.get(e);i.set(e,s)}for(var a in e)"default"!==a&&({}).hasOwnProperty.call(e,a)&&((o=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,a))&&(o.get||o.set)?i(s,a,o):s[a]=e[a]);return s})(e,t)}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function d(e,t,n){return e.set(p(e,t),n),n}function p(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw TypeError("Private element is not present on this object")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,A(r.key),r)}}function f(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function m(e){var t="function"==typeof Map?new Map:void 0;return(m=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(y())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&v(i,n.prototype),i}(e,arguments,E(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),v(n,e)})(e)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,n){return(t=A(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=u(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}function T(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var l=Object.create((r&&r.prototype instanceof a?r:a).prototype);return S(l,"_invoke",function(n,r,i){var o,a,l,u=0,c=i||[],d=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return o=t,a=0,l=e,p.n=n,s}};function h(n,r){for(a=n,l=r,t=0;!d&&u&&!i&&t<c.length;t++){var i,o=c[t],h=p.p,f=o[2];n>3?(i=f===r)&&(l=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=h&&((i=n<2&&h<o[1])?(a=0,p.v=r,p.n=o[1]):h<f&&(i=n<3||o[0]>r||r>f)&&(o[4]=n,o[5]=r,p.n=f,a=0))}if(i||n>1)return s;throw d=!0,r}return function(i,c,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&h(c,f),a=c,l=f;(t=a<2?e:l)||!d;){o||(a?a<3?(a>1&&(p.n=-1),h(a,l)):p.n=l:p.v=l);try{if(u=2,o){if(a||(i="next"),t=o[i]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,a<2&&(a=0)}else 1===a&&(t=o.return)&&t.call(o),a<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==s)break}catch(t){o=e,a=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,i,o),!0),l}var s={};function a(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(S(t={},r,function(){return this}),t),d=u.prototype=a.prototype=Object.create(c);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,S(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,S(d,"constructor",u),S(u,"constructor",l),l.displayName="GeneratorFunction",S(u,i,"GeneratorFunction"),S(d),S(d,i,"Generator"),S(d,r,function(){return this}),S(d,"toString",function(){return"[object Generator]"}),(T=function(){return{w:o,m:p}})()}function S(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(S=function(e,t,n,r){if(t)i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var o=function(t,n){S(e,t,function(e){return this._invoke(t,n,e)})};o("next",0),o("throw",1),o("return",2)}})(e,t,n,r)}function b(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function C(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){b(o,r,i,s,a,"next",e)}function a(e){b(o,r,i,s,a,"throw",e)}s(void 0)})}}var O=r.readFile?(0,a.promisify)(r.readFile):C(T().m(function e(){return T().w(function(e){for(;;)switch(e.n){case 0:throw new w("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},e)})),I="https://oauth2.googleapis.com/token",w=function(e){function t(e,n){var r,i,o;return g(this,t),i=t,o=[e],i=E(i),_(r=function(e,t){if(t&&("object"==u(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,y()?Reflect.construct(i,o||[],E(this).constructor):i.apply(this,o)),"code",void 0),r.code=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(t,e),f(t)}(m(Error)),R=new WeakMap,N=new WeakSet;function k(e){return P.apply(this,arguments)}function P(){return(P=C(T().m(function e(t){return T().w(function(e){for(;;)switch(e.n){case 0:if(!R.get(p(R,this))||t.forceRefresh){e.n=1;break}return e.a(2,R.get(p(R,this)));case 1:return e.p=1,e.n=2,d(R,this,p(N,this,x).call(this,t));case 2:return e.a(2,e.v);case 3:return e.p=3,d(R,this,void 0),e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])}))).apply(this,arguments)}function x(e){return U.apply(this,arguments)}function U(){return(U=C(T().m(function e(t){var n;return T().w(function(e){for(;;)switch(e.n){case 0:if(!(!1===this.isTokenExpiring()&&!1===t.forceRefresh)){e.n=1;break}return e.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){e.n=2;break}throw Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){e.n=4;break}return e.n=3,this.getCredentials(this.keyFile);case 3:n=e.v,this.key=n.privateKey,this.iss=n.clientEmail||this.iss,n.clientEmail||p(N,this,D).call(this);case 4:return e.a(2,p(N,this,G).call(this))}},e,this)}))).apply(this,arguments)}function D(){if(!this.iss)throw new w("email is required.","MISSING_CREDENTIALS")}function M(){return j.apply(this,arguments)}function j(){return(j=C(T().m(function e(){var t;return T().w(function(e){for(;;)switch(e.n){case 0:if(this.accessToken){e.n=1;break}throw Error("No token to revoke.");case 1:return t="https://oauth2.googleapis.com/revoke?token="+this.accessToken,e.n=2,this.transporter.request({url:t,retry:!0});case 2:p(N,this,L).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return e.a(2)}},e,this)}))).apply(this,arguments)}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keyFile=e.keyFile,this.key=e.key,this.rawToken=void 0,this.iss=e.email||e.iss,this.sub=e.sub,this.additionalClaims=e.additionalClaims,"object"===u(e.scope)?this.scope=e.scope.join(" "):this.scope=e.scope,this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,e.transporter&&(this.transporter=e.transporter)}function G(){return F.apply(this,arguments)}function F(){return(F=C(T().m(function e(){var t,n,r,i,s,a,l,u,c,d;return T().w(function(e){for(;;)switch(e.n){case 0:return t=Math.floor(new Date().getTime()/1e3),n=this.additionalClaims||{},r=Object.assign({iss:this.iss,scope:this.scope,aud:I,exp:t+3600,iat:t,sub:this.sub},n),i=o.sign({header:{alg:"RS256"},payload:r,secret:this.key}),e.p=1,e.n=2,this.transporter.request({method:"POST",url:I,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return s=e.v,this.rawToken=s.data,this.expiresAt=null===s.data.expires_in||void 0===s.data.expires_in?void 0:(t+s.data.expires_in)*1e3,e.a(2,this.rawToken);case 3:throw e.p=3,d=e.v,this.rawToken=void 0,this.tokenExpires=void 0,(u=d.response&&null!==(a=d.response)&&void 0!==a&&a.data?null===(l=d.response)||void 0===l?void 0:l.data:{}).error&&(c=u.error_description?": ".concat(u.error_description):"",d.message="".concat(u.error).concat(c)),d;case 4:return e.a(2)}},e,this,[[1,3]])}))).apply(this,arguments)}t.GoogleToken=function(){var e;return f(function e(t){var n;g(this,e),c(this,N),N.add(this),_(this,"expiresAt",void 0),_(this,"key",void 0),_(this,"keyFile",void 0),_(this,"iss",void 0),_(this,"sub",void 0),_(this,"scope",void 0),_(this,"rawToken",void 0),_(this,"tokenExpires",void 0),_(this,"email",void 0),_(this,"additionalClaims",void 0),_(this,"eagerRefreshThresholdMillis",void 0),_(this,"transporter",{request:function(e){return(0,i.request)(e)}}),n=void 0,c(this,R),R.set(this,n),p(N,this,L).call(this,t)},[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var e=new Date().getTime();return!this.rawToken||!this.expiresAt||e>=this.expiresAt}},{key:"isTokenExpiring",value:function(){var e,t=new Date().getTime(),n=null!==(e=this.eagerRefreshThresholdMillis)&&void 0!==e?e:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=t+n}},{key:"getToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"===u(e)&&(t=e,e=void 0),t=Object.assign({forceRefresh:!1},t),e){var n=e;p(N,this,k).call(this,t).then(function(e){return n(null,e)},e);return}return p(N,this,k).call(this,t)}},{key:"getCredentials",value:(e=C(T().m(function e(t){var n,r,i,o,a;return T().w(function(e){for(;;)switch(e.n){case 0:a=s.extname(t),e.n=".json"===a?1:".der"===a?4:".crt"===a?4:".pem"===a?4:".p12"===a?6:".pfx"===a?6:7;break;case 1:return e.n=2,O(t,"utf8");case 2:if(r=(n=JSON.parse(e.v)).private_key,i=n.client_email,!(!r||!i)){e.n=3;break}throw new w("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return e.a(2,{privateKey:r,clientEmail:i});case 4:return e.n=5,O(t,"utf8");case 5:return o=e.v,e.a(2,{privateKey:o});case 6:throw new w("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new w("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return e.a(2)}},e)})),function(t){return e.apply(this,arguments)})},{key:"revokeToken",value:function(e){if(e){p(N,this,M).call(this).then(function(){return e()},e);return}return p(N,this,M).call(this)}}])}()},36547:e=>{"use strict";e.exports=JSON.parse('{"name":"gaxios","version":"7.1.3","description":"A simple common HTTP client specifically for Google APIs and services.","main":"build/cjs/src/index.js","types":"build/cjs/src/index.d.ts","files":["build/"],"exports":{".":{"import":{"types":"./build/esm/src/index.d.ts","default":"./build/esm/src/index.js"},"require":{"types":"./build/cjs/src/index.d.ts","default":"./build/cjs/src/index.js"}}},"scripts":{"lint":"gts check --no-inline-config","test":"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000","compile":"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs","fix":"gts fix","prepare":"npm run compile","pretest":"npm run compile","webpack":"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js","docs":"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","prelint":"cd samples; npm link ../; npm install","clean":"gts clean"},"repository":{"type":"git","directory":"packages/gaxios","url":"https://github.com/googleapis/google-cloud-node-core.git"},"keywords":["google"],"engines":{"node":">=18"},"author":"Google, LLC","license":"Apache-2.0","devDependencies":{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6","assert":"^2.0.0","browserify":"^17.0.0","c8":"^10.0.0","cors":"^2.8.5","express":"^5.0.0","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","linkinator":"^6.1.2","mocha":"^11.1.0","multiparty":"^4.2.1","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","stream-browserify":"^3.0.0","tmp":"0.2.5","ts-loader":"^9.5.2","typescript":"^5.8.3","webpack":"^5.35.0","webpack-cli":"^6.0.1"},"dependencies":{"extend":"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2","rimraf":"^5.0.1"},"homepage":"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}')},90630:e=>{"use strict";e.exports=JSON.parse('{"name":"google-auth-library","version":"10.5.0","author":"Google Inc.","description":"Google APIs Authentication Client Library for Node.js","engines":{"node":">=18"},"main":"./build/src/index.js","types":"./build/src/index.d.ts","repository":"googleapis/google-auth-library-nodejs.git","keywords":["google","api","google apis","client","client library"],"dependencies":{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11","gaxios":"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0","gtoken":"^8.0.0","jws":"^4.0.0"},"devDependencies":{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0","c8":"^10.0.0","codecov":"^3.0.2","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","keypair":"^1.0.4","mocha":"^11.1.0","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.5","null-loader":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","ts-loader":"^8.0.0","typescript":"5.8.2","webpack":"^5.21.2","webpack-cli":"^4.0.0"},"files":["build/src","!build/src/**/*.map"],"scripts":{"test":"c8 mocha build/test","clean":"gts clean","prepare":"npm run compile","lint":"gts check --no-inline-config","compile":"tsc -p .","fix":"gts fix","pretest":"npm run compile -- --sourceMap","docs":"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap","webpack":"webpack","browser-test":"karma start","docs-test":"echo \'disabled until linkinator is fixed\'","predocs-test":"npm run docs","prelint":"cd samples; npm link ../; npm install"},"license":"Apache-2.0"}')}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[989,452,324,379,97],()=>n(33489));module.exports=r})();